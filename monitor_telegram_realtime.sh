#!/bin/bash

echo "ðŸ” ========== ÐœÐžÐÐ˜Ð¢ÐžÐ Ð˜ÐÐ“ TELEGRAM ÐÐ’Ð¢ÐžÐ Ð˜Ð—ÐÐ¦Ð˜Ð˜ (REALTIME) =========="
echo "ðŸ’¡ Ð”Ð»Ñ Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ Ð½Ð°Ð¶Ð¼Ð¸Ñ‚Ðµ Ctrl+C"
echo ""
echo "ðŸŽ¯ ÐžÑ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°ÐµÐ¼Ñ‹Ðµ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ:"
echo "   â€¢ [INIT]    - Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ð¸ (Ð²Ð²Ð¾Ð´ Ð½Ð¾Ð¼ÐµÑ€Ð°)"
echo "   â€¢ [WEBHOOK] - ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð¾Ñ‚ Telegram"
echo "   â€¢ [START]   - ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ /start"
echo "   â€¢ [UPSERT]  - ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð² Ð‘Ð”"
echo "   â€¢ [POLLING] - ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑ‚Ð°Ñ‚ÑƒÑÐ° Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ð¸ (ÐºÐ°Ð¶Ð´Ñ‹Ðµ 2 ÑÐµÐº)"
echo "   â€¢ ERROR     - Ð›ÑŽÐ±Ñ‹Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸"
echo ""
echo "ðŸ“Š ÐÐ°Ñ‡Ð¸Ð½Ð°ÑŽ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³..."
echo "=========================================="
echo ""

# ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡Ð°ÐµÐ¼ÑÑ Ðº ÑÐµÑ€Ð²ÐµÑ€Ñƒ Ð¸ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ Ð»Ð¾Ð³Ð¸ Ð² Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾Ð¼ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸
# --tail 0 Ð¾Ð·Ð½Ð°Ñ‡Ð°ÐµÑ‚ "Ð½Ðµ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°Ñ‚ÑŒ ÑÑ‚Ð°Ñ€Ñ‹Ðµ Ð»Ð¾Ð³Ð¸, Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð½Ð¾Ð²Ñ‹Ðµ"
# -f Ð¾Ð·Ð½Ð°Ñ‡Ð°ÐµÑ‚ "ÑÐ»ÐµÐ´Ð¸Ñ‚ÑŒ Ð·Ð° Ð½Ð¾Ð²Ñ‹Ð¼Ð¸ Ð»Ð¾Ð³Ð°Ð¼Ð¸"
# grep --line-buffered Ð¾Ð±ÐµÑÐ¿ÐµÑ‡Ð¸Ð²Ð°ÐµÑ‚ Ð¼Ð³Ð½Ð¾Ð²ÐµÐ½Ð½Ñ‹Ð¹ Ð²Ñ‹Ð²Ð¾Ð´ ÑÑ‚Ñ€Ð¾Ðº
ssh titotr.ru "docker logs -f --tail 0 timetotravel_backend 2>&1" | \
  grep --line-buffered -E '\[INIT\]|\[WEBHOOK\]|\[START\]|\[UPSERT\]|\[POLLING\]|ERROR|CRITICAL'
