# üîç –ê–Ω–∞–ª–∏–∑ –∫—Ä–∞—à–∞ SearchSuggestSessionSuggestListener

**–î–∞—Ç–∞:** 24 –æ–∫—Ç—è–±—Ä—è 2025 –≥.  
**–°—Ç–∞—Ç—É—Å:** ‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê - Listener –≤—ã–∑—ã–≤–∞–µ—Ç segfault

## üö® –°—É—Ç—å –ø—Ä–æ–±–ª–µ–º—ã

–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —Å–æ–∑–¥–∞—Ç—å `SearchSuggestSessionSuggestListener` –≤ –≤–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç **–Ω–∞—Ç–∏–≤–Ω—ã–π –∫—Ä–∞—à** (SIGSEGV) –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ `libmaps-mobile.so`.

```
F/libc: Fatal signal 11 (SIGSEGV), code -6 (SI_TKILL)
backtrace:
  #06 pc yandex_flutter_search_SuggestSession_SearchSuggestSessionSuggestListener_new+28
```

## üìã –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### –ü–æ–ø—ã—Ç–∫–∞ 1: –°–æ–∑–¥–∞–Ω–∏–µ listener –∫–∞–∫ –ª–æ–∫–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
```dart
final listener = SearchSuggestSessionSuggestListener(...);
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚ùå –ö–†–ê–®

### –ü–æ–ø—ã—Ç–∫–∞ 2: –°–æ–∑–¥–∞–Ω–∏–µ listener –∫–∞–∫ `late final` –ø–æ–ª—è –∫–ª–∞—Å—Å–∞ –≤ –º–µ—Ç–æ–¥–µ `initialize()`
```dart
class YandexSuggestService {
  late final SearchSuggestSessionSuggestListener _suggestListener;
  
  void initialize() {
    _suggestListener = SearchSuggestSessionSuggestListener(...); // –ö–†–ê–®
  }
}
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚ùå –ö–†–ê–®

### –ü–æ–ø—ã—Ç–∫–∞ 3: –°–æ–∑–¥–∞–Ω–∏–µ listener –Ω–∞ —É—Ä–æ–≤–Ω–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –ø–æ–ª—è (–∫–∞–∫ –≤ –ø—Ä–∏–º–µ—Ä–µ –Ø–Ω–¥–µ–∫—Å–∞)
```dart
class YandexSuggestService {
  late final _suggestListener = SearchSuggestSessionSuggestListener(
    onResponse: _onSuggestResponse,
    onError: _onSuggestError,
  ); // –ö–†–ê–®
}
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚ùå –ö–†–ê–®

### –ü–æ–ø—ã—Ç–∫–∞ 4: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `final` –≤–º–µ—Å—Ç–æ `late final` –¥–ª—è `_searchManager`
```dart
class YandexSuggestService {
  final _searchManager = SearchFactory.instance.createSearchManager(SearchManagerType.Combined);
  late final _suggestSession = _searchManager.createSuggestSession();
  late final _suggestListener = SearchSuggestSessionSuggestListener(...); // –ö–†–ê–®
}
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚ùå –ö–†–ê–®

## üî¨ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### Stacktrace –∫—Ä–∞—à–∞
```
#00 pc 0000000000000000  <unknown>
#01 pc 0000000000f76118  libmaps-mobile.so (BuildId: 0974c7c9930295e1)
#02 pc 00000000010c3518  libmaps-mobile.so
#03 pc 0000000001a88b28  libmaps-mobile.so
#04 pc 0000000001a88ac4  libmaps-mobile.so
#05 pc 0000000001a882e8  libmaps-mobile.so
#06 pc 0000000001a8828c  libmaps-mobile.so (yandex_flutter_search_SuggestSession_SearchSuggestSessionSuggestListener_new+28)
#07 pc 0000000000058e90  [anon:dart-code]
```

### –í–µ—Ä—Å–∏–∏
- `yandex_maps_mapkit: ^4.17.2` (–≤ –≤–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ)
- API –∫–ª—é—á: `2f1d6a75-b751-4077-b305-c6abaea0b542`
- MapKit –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –≤ `MainApplication.kt` —á–µ—Ä–µ–∑ `MapKitFactory.initialize(this)`

### –õ–æ–≥–∏ –ø–µ—Ä–µ–¥ –∫—Ä–∞—à–µ–º
```
I/flutter: ‚úÖ [Step 1.4] SuggestSession —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ
I/flutter: üîµ [Step 1.5] Listener —É–∂–µ —Å–æ–∑–¥–∞–Ω –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–ª–∞—Å—Å–∞
F/libc: Fatal signal 11 (SIGSEGV)  <-- –ö–†–ê–® –ó–î–ï–°–¨
```

## üéØ –¢–µ–∫—É—â–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

### –ó–∞–ø—É—Å–∫–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä –Ø–Ω–¥–µ–∫—Å–∞

–ß—Ç–æ–±—ã –∏—Å–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É –≤ –≤–∞—à–µ–º –∫–æ–¥–µ, –º—ã:

1. ‚úÖ –í–∑—è–ª–∏ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä –∏–∑ `mapkit-flutter-demo-master/mapkit-samples/map_search`
2. ‚úÖ –î–æ–±–∞–≤–∏–ª–∏ –≤–∞—à API –∫–ª—é—á: `2f1d6a75-b751-4077-b305-c6abaea0b542`
3. ‚úÖ –û–±–Ω–æ–≤–∏–ª–∏ –≤–µ—Ä—Å–∏—é Gradle —Å 8.1.0 –¥–æ 8.7.3
4. üîÑ –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–∞ —Ç–æ–º –∂–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ (`sdk gphone16k arm64`)

**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ `SearchSuggestSessionSuggestListener` –≤ —á–∏—Å—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ –Ø–Ω–¥–µ–∫—Å–∞.

### –í–æ–∑–º–æ–∂–Ω—ã–µ –∏—Å—Ö–æ–¥—ã

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ü—Ä–∏–º–µ—Ä –Ø–Ω–¥–µ–∫—Å–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ
**–í—ã–≤–æ–¥—ã:**
- –ü—Ä–æ–±–ª–µ–º–∞ –≤ –≤–∞—à–µ–º –∫–æ–¥–µ/–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞
- –ù—É–∂–Ω–æ –∏—Å–∫–∞—Ç—å —Ä–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É –ø—Ä–∏–º–µ—Ä–æ–º –∏ –≤–∞—à–∏–º –ø—Ä–æ–µ–∫—Ç–æ–º

**–î–µ–π—Å—Ç–≤–∏—è:**
- –°—Ä–∞–≤–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Gradle
- –°—Ä–∞–≤–Ω–∏—Ç—å —Å–ø–æ—Å–æ–± –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ MapKit
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—á–∏–π –∫–æ–¥ –∏–∑ –ø—Ä–∏–º–µ—Ä–∞

#### –í–∞—Ä–∏–∞–Ω—Ç B: –ü—Ä–∏–º–µ—Ä –Ø–Ω–¥–µ–∫—Å–∞ —Ç–æ–∂–µ –∫—Ä–∞—à–∏—Ç—Å—è ‚ùå
**–í—ã–≤–æ–¥—ã:**
- –ü—Ä–æ–±–ª–µ–º–∞ –≤ SDK `yandex_maps_mapkit: ^4.17.2`
- –í–æ–∑–º–æ–∂–Ω–æ, –±–∞–≥ –≤ –Ω–∞—Ç–∏–≤–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–µ `libmaps-mobile.so`
- –ü—Ä–æ–±–ª–µ–º–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞ –¥–ª—è —ç–º—É–ª—è—Ç–æ—Ä–∞ `sdk gphone16k arm64`

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
2. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –¥—Ä—É–≥—É—é –≤–µ—Ä—Å–∏—é SDK (–Ω–∞–ø—Ä–∏–º–µ—Ä, `^4.16.0`)
3. –ù–∞–ø–∏—Å–∞—Ç—å –±–∞–≥—Ä–µ–ø–æ—Ä—Ç –≤ –Ø–Ω–¥–µ–∫—Å —Å stacktrace
4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (HTTP Geocoder API)

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ
- [x] –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–º–µ—Ä –Ø–Ω–¥–µ–∫—Å–∞ —Å –≤–∞—à–∏–º API –∫–ª—é—á–æ–º
- [ ] –î–æ–∂–¥–∞—Ç—å—Å—è —Å–±–æ—Ä–∫–∏ Gradle –∏ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ –ø—Ä–∏–º–µ—Ä–µ
- [ ] –ó–∞–ø–∏—Å–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç (—Ä–∞–±–æ—Ç–∞–µ—Ç/–∫—Ä–∞—à–∏—Ç—Å—è)

### –ï—Å–ª–∏ –ø—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–æ—á–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–æ–¥–∞ –∏–∑ –ø—Ä–∏–º–µ—Ä–∞
- [ ] –°–æ–∑–¥–∞—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω –≤ –≤–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ
- [ ] –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### –ï—Å–ª–∏ –ø—Ä–∏–º–µ—Ä –∫—Ä–∞—à–∏—Ç—Å—è
- [ ] –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
- [ ] –û—Ç–∫–∞—Ç–∏—Ç—å—Å—è –Ω–∞ `yandex_maps_mapkit: ^4.16.0`
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å –±–∞–≥—Ä–µ–ø–æ—Ä—Ç –≤ –Ø–Ω–¥–µ–∫—Å
- [ ] –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: –í–∞—à –∫–æ–¥ vs –ü—Ä–∏–º–µ—Ä –Ø–Ω–¥–µ–∫—Å–∞

| –ê—Å–ø–µ–∫—Ç | –í–∞—à –ø—Ä–æ–µ–∫—Ç | –ü—Ä–∏–º–µ—Ä –Ø–Ω–¥–µ–∫—Å–∞ |
|--------|-----------|----------------|
| –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è MapKit | `MainApplication.kt` | `main.dart` —á–µ—Ä–µ–∑ `init.initMapkit()` |
| –ú–µ—Ç–æ–¥ | `MapKitFactory.initialize(this)` | `await init.initMapkit(apiKey: "...")` |
| –°–æ–∑–¥–∞–Ω–∏–µ SearchManager | `late final` / `final` | `final` (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ä–∞–∑—É) |
| –°–æ–∑–¥–∞–Ω–∏–µ SuggestSession | `late final` | `late final` |
| –°–æ–∑–¥–∞–Ω–∏–µ Listener | `late final` | `late final` |
| –í–µ—Ä—Å–∏—è SDK | `^4.17.2` | –í–µ—Ä–æ—è—Ç–Ω–æ —Ç–∞ –∂–µ |
| Gradle –≤–µ—Ä—Å–∏—è | 8.7.3 | 8.1.0 ‚Üí 8.7.3 (–æ–±–Ω–æ–≤–∏–ª–∏) |

## üí° –ì–∏–ø–æ—Ç–µ–∑—ã

### –ì–∏–ø–æ—Ç–µ–∑–∞ 1: –†–∞–∑–Ω–∏—Ü–∞ –≤ —Å–ø–æ—Å–æ–±–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ MapKit
**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** üü° –°—Ä–µ–¥–Ω—è—è

–í –≤–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ MapKit –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –≤ `MainApplication.kt` (Android-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ), –∞ –≤ –ø—Ä–∏–º–µ—Ä–µ –Ø–Ω–¥–µ–∫—Å–∞ —á–µ—Ä–µ–∑ `init.initMapkit()` –≤ `main.dart` (–∫—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ).

**–¢–µ—Å—Ç:** –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–º–µ—Ä –Ø–Ω–¥–µ–∫—Å–∞ –ø–æ–∫–∞–∂–µ—Ç, –∏–º–µ–µ—Ç –ª–∏ —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ.

### –ì–∏–ø–æ—Ç–µ–∑–∞ 2: –ë–∞–≥ –≤ SDK –≤–µ—Ä—Å–∏–∏ 4.17.2
**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** üü† –ù–∏–∑–∫–∞—è

–ï—Å–ª–∏ –¥–∞–∂–µ –ø—Ä–∏–º–µ—Ä –Ø–Ω–¥–µ–∫—Å–∞ –∫—Ä–∞—à–∏—Ç—Å—è, —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–∞–≥ –≤ –Ω–∞—Ç–∏–≤–Ω–æ–π —á–∞—Å—Ç–∏ SDK.

**–¢–µ—Å—Ç:** –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–º–µ—Ä –Ø–Ω–¥–µ–∫—Å–∞ + –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –¥—Ä—É–≥—É—é –≤–µ—Ä—Å–∏—é SDK.

### –ì–∏–ø–æ—Ç–µ–∑–∞ 3: –ü—Ä–æ–±–ª–µ–º–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞ –¥–ª—è —ç–º—É–ª—è—Ç–æ—Ä–∞
**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** üü¢ –í—ã—Å–æ–∫–∞—è

`sdk gphone16k arm64` - —ç—Ç–æ —ç–º—É–ª—è—Ç–æ—Ä. –í–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–æ–±–ª–µ–º–∞ —Å–≤—è–∑–∞–Ω–∞ —Å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π ARM64 —ç–º—É–ª—è—Ç–æ—Ä–∞ –∏–ª–∏ —Å –≤–µ—Ä—Å–∏–µ–π Android (16).

**–¢–µ—Å—Ç:** –ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.

### –ì–∏–ø–æ—Ç–µ–∑–∞ 4: –ö–æ–Ω—Ñ–ª–∏–∫—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** üü° –°—Ä–µ–¥–Ω—è—è

–í –≤–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ –º–Ω–æ–≥–æ –¥—Ä—É–≥–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (Firebase, Geolocator, –∏ —Ç.–¥.), –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å MapKit.

**–¢–µ—Å—Ç:** –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç —Ç–æ–ª—å–∫–æ —Å MapKit.

## üìù –õ–æ–≥–∏ –¥–ª—è –Ø–Ω–¥–µ–∫—Å–∞ (–µ—Å–ª–∏ –±—É–¥–µ—Ç –±–∞–≥—Ä–µ–ø–æ—Ä—Ç)

```
**–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ:** Android Emulator sdk gphone16k arm64
**OS:** Android 16 (API level 35)
**Flutter:** (–≤–∞—à–∞ –≤–µ—Ä—Å–∏—è)
**SDK:** yandex_maps_mapkit: ^4.17.2
**API Key:** 2f1d6a75-b751-4077-b305-c6abaea0b542

**Crash:**
```
F/libc: Fatal signal 11 (SIGSEGV), code -6 (SI_TKILL) in tid 24579
backtrace:
  #06 pc 0000000001a8828c libmaps-mobile.so (yandex_flutter_search_SuggestSession_SearchSuggestSessionSuggestListener_new+28)
```

**–ö–æ–¥:**
```dart
late final _suggestListener = SearchSuggestSessionSuggestListener(
  onResponse: (response) { ... },
  onError: (error) { ... },
); // <-- CRASH HERE
```

**–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:**
```kotlin
// MainApplication.kt
class MainApplication : FlutterApplication() {
    override fun onCreate() {
        super.onCreate()
        MapKitFactory.setApiKey("2f1d6a75-b751-4077-b305-c6abaea0b542")
        MapKitFactory.initialize(this)
    }
}
```
```

---

**–û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–æ –º–µ—Ä–µ –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö...**
