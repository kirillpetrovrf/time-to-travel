# –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∂–∞—Ç–∏—é "–ù–∞–π—Ç–∏" –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ

## –ü—Ä–æ–±–ª–µ–º–∞
–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏–ª –∞–¥—Ä–µ—Å –≤—Ä—É—á–Ω—É—é (–Ω–∞–ø—Ä–∏–º–µ—Ä "–∫—É–Ω–≥—É—Ä –ª–µ–Ω–∏–Ω–∞ 66") –∏ –Ω–∞–∂–∏–º–∞–ª –∫–Ω–æ–ø–∫—É "–ù–∞–π—Ç–∏" –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ, —Å–∏—Å—Ç–µ–º–∞ **–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–ª–∞ –ø–æ–∏—Å–∫** —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º:
```
‚ö†Ô∏è Ignoring search result - not waiting for suggestion result
```

### –ü—Ä–∏—á–∏–Ω–∞
- –§–ª–∞–≥ `_waitingForSuggestionResult` –ù–ï —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª—Å—è –≤ `true` –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–ù–∞–π—Ç–∏" 
- –°–∏—Å—Ç–µ–º–∞ –¥—É–º–∞–ª–∞ —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ù–ï –∂–¥–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–∏—Å–∫–∞
- –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–∏—Å–∫–∞ –æ—Ç–±—Ä–∞—Å—ã–≤–∞–ª—Å—è –≤ `onAddressSelected` callback

## –†–µ—à–µ–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ü–µ–ø–æ—á–∫–∞ callbacks –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞–∂–∞—Ç–∏—è "–ù–∞–π—Ç–∏":

### 1. SearchFieldWithSuggestions (–≤–∏–¥–∂–µ—Ç –ø–æ–ª—è)
- –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `onSubmitted: ValueChanged<String>?`
- –í TextField –¥–æ–±–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `onSubmitted`:
  ```dart
  onSubmitted: (value) {
    if (value.isNotEmpty) {
      _focusNode.unfocus(); // –°–∫—Ä—ã–≤–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
      widget.onSubmitted?.call(value);
    }
  }
  ```
- **–í–∞–∂–Ω–æ**: –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `unfocus()` —á—Ç–æ–±—ã —Å–∫—Ä—ã—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –∏ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–∞–ª—å–Ω–µ–π—à–∏–µ –∞–≤—Ç–æ–ø–æ–∏—Å–∫–∏

### 2. –î–æ–±–∞–≤–ª–µ–Ω—ã callbacks –≤ SearchFieldsPanel
**–§–∞–π–ª**: `lib/widgets_taxi/search_fields_panel.dart`

- –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è `onFromSubmitted` –∏ `onToSubmitted`
- –ü–µ—Ä–µ–¥–∞–Ω—ã –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ `SearchFieldWithSuggestions` –≤–∏–¥–∂–µ—Ç—ã

### 3. –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤ main_screen.dart
**–§–∞–π–ª**: `lib/features/main_screen.dart`

–î–æ–±–∞–≤–ª–µ–Ω—ã –¥–≤–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞:

```dart
onFromSubmitted: (text) {
  print('‚å®Ô∏è FROM field submitted with text: "$text"');
  if (text.isNotEmpty) {
    _lastSearchFieldType = RoutePointType.from;
    _waitingForSuggestionResult = true;  // ‚úÖ –ñ–¥–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç!
    print('üîç Starting search via keyboard for FROM: $text');
    _mapManager.startSearch(text);
  }
},
onToSubmitted: (text) {
  print('‚å®Ô∏è TO field submitted with text: "$text"');
  if (text.isNotEmpty) {
    _lastSearchFieldType = RoutePointType.to;
    _waitingForSuggestionResult = true;  // ‚úÖ –ñ–¥–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç!
    print('üîç Starting search via keyboard for TO: $text');
    _mapManager.startSearch(text);
  }
},
```

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç**: "–∫—É–Ω–≥—É—Ä –ª–µ–Ω–∏–Ω–∞ 66"
2. **–ù–∞–∂–∏–º–∞–µ—Ç "–ù–∞–π—Ç–∏"** –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ
3. **–°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç** `onSubmitted` ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑ main_screen
4. **–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Ñ–ª–∞–≥**: `_waitingForSuggestionResult = true`
5. **–ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ–∏—Å–∫**: `_mapManager.startSearch(text)`
6. **–ü—Ä–∏—Ö–æ–¥–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç** ‚Üí –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ `onAddressSelected`
7. **–¢–æ—á–∫–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è** –Ω–∞ –∫–∞—Ä—Ç–µ ‚úÖ

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: "–∫—É–Ω–≥—É—Ä –ø—Ä–æ—Å–≤–µ—â–µ–Ω–∏—è 17"
1. –í –ø–æ–ª–µ "–û–¢" –≤–≤–µ—Å—Ç–∏: "–∫—É–Ω–≥—É—Ä"
2. –ù–∞–∂–∞—Ç—å "–ù–∞–π—Ç–∏" ‚Üí –∫–∞—Ä—Ç–∞ –ø–æ–∫–∞–∂–µ—Ç –≥–æ—Ä–æ–¥
3. –í–≤–µ—Å—Ç–∏: "–ø—Ä–æ—Å–≤–µ—â–µ–Ω–∏—è"
4. –ù–∞–∂–∞—Ç—å "–ù–∞–π—Ç–∏" ‚Üí –∫–∞—Ä—Ç–∞ –ø–æ–∫–∞–∂–µ—Ç —É–ª–∏—Ü—É
5. –í–≤–µ—Å—Ç–∏: "17"
6. –ù–∞–∂–∞—Ç—å "–ù–∞–π—Ç–∏" ‚Üí **–∫–∞—Ä—Ç–∞ –ø–æ–∫–∞–∂–µ—Ç —Ç–æ—á–Ω—ã–π –∞–¥—Ä–µ—Å** (–Ω–µ —Ü–µ–Ω—Ç—Ä –≥–æ—Ä–æ–¥–∞)

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: "–∫—É–Ω–≥—É—Ä –ª–µ–Ω–∏–Ω–∞ 66"
1. –í –ø–æ–ª–µ "–î–û" –≤–≤–µ—Å—Ç–∏: "–∫—É–Ω–≥—É—Ä –ª–µ–Ω–∏–Ω–∞ 66"
2. –ù–∞–∂–∞—Ç—å "–ù–∞–π—Ç–∏" ‚Üí **—Å–∏–Ω—è—è —Ç–æ—á–∫–∞ –ø–æ—è–≤–∏—Ç—Å—è –Ω–∞ –∫–∞—Ä—Ç–µ** (–Ω–µ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è)

## –û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏ (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)

```
‚å®Ô∏è FROM field submitted with text: "–∫—É–Ω–≥—É—Ä –ø—Ä–æ—Å–≤–µ—â–µ–Ω–∏—è 17"
üîç Starting search via keyboard for FROM: –∫—É–Ω–≥—É—Ä –ø—Ä–æ—Å–≤–µ—â–µ–Ω–∏—è 17
‚úÖ Search response: 5 items
üìç ABOUT TO CALL onAddressSelected callback!
üéØ Address selected from search: –ü–µ—Ä–º—Å–∫–∏–π –∫—Ä–∞–π, –ö—É–Ω–≥—É—Ä, —É–ª–∏—Ü–∞ –ü—Ä–æ—Å–≤–µ—â–µ–Ω–∏—è, 17
üîß Waiting for suggestion result: true  ‚Üê ‚úÖ –¢–ï–ü–ï–†–¨ TRUE!
‚úÖ Point set successfully for FROM
```

## –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. `lib/widgets_taxi/search_field_with_suggestions.dart` - –¥–æ–±–∞–≤–ª–µ–Ω `onSubmitted`
2. `lib/widgets_taxi/search_fields_panel.dart` - –¥–æ–±–∞–≤–ª–µ–Ω—ã `onFromSubmitted` –∏ `onToSubmitted`
3. `lib/features/main_screen.dart` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π —Ñ–ª–∞–≥–∞

## –°—Ç–∞—Ç—É—Å
‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
‚è≥ –¢—Ä–µ–±—É–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
