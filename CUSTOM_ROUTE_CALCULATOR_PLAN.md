# üöï –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ "–°–≤–æ–±–æ–¥–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç" (–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ç–∞–∫—Å–∏)

**–î–∞—Ç–∞:** 14 –æ–∫—Ç—è–±—Ä—è 2025 –≥.  
**–ó–∞–¥–∞—á–∞:** –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–¥–µ–ª–∫–∞ —ç–∫—Ä–∞–Ω–∞ "–°–≤–æ–±–æ–¥–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç" –≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ç–∞–∫—Å–∏ —Å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–º–∏ –∞–¥—Ä–µ—Å–∞–º–∏

---

## üìã –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
1. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è
2. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
3. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Yandex Maps API –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
4. ‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ: `–±–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å + (–∫–∏–ª–æ–º–µ—Ç—Ä—ã √ó –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç)`
5. ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞: 1000‚ÇΩ
6. ‚úÖ –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ —Ü–µ–Ω—ã: –µ—Å–ª–∏ > 1000‚ÇΩ ‚Üí –æ–∫—Ä—É–≥–ª–∏—Ç—å –¥–æ —Ç—ã—Å—è—á –≤–≤–µ—Ä—Ö (21150‚ÇΩ ‚Üí 22000‚ÇΩ)
7. ‚úÖ –ê–¥–º–∏–Ω –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å —Ñ–æ—Ä–º—É–ª—É –≤ –∫–∞–±–∏–Ω–µ—Ç–µ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞

---

## üéØ –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ü–æ–¥—Ö–æ–¥:
**–ù–ï –ø–µ—Ä–µ–¥–µ–ª—ã–≤–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `route_selection_screen.dart`**, –∞ —Å–æ–∑–¥–∞—ë–º –ù–û–í–´–ô —ç–∫—Ä–∞–Ω `custom_route_calculator_screen.dart`.

**–ü—Ä–∏—á–∏–Ω—ã:**
- –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–∞–±–æ—Ç–∞—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤
- –ò–∑–±–µ–≥–∞–µ–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å —Ç–µ–∫—É—â–µ–π –ª–æ–≥–∏–∫–æ–π
- –ü—Ä–æ—â–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –æ—Ç–∫–∞—Ç—ã–≤–∞—Ç—å
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

---

## üì¶ –≠—Ç–∞–ø—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### üî∑ –≠–¢–ê–ü 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (Backend)
**–°—Ä–æ–∫:** 1 –¥–µ–Ω—å  
**–¶–µ–ª—å:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Firebase –∏ Yandex Maps API

#### 1.1. –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
**–§–∞–π–ª:** `lib/models/calculator_settings.dart`

```dart
class CalculatorSettings {
  final double baseCost;          // –ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, 500‚ÇΩ)
  final double costPerKm;         // –°—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞ –∫–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, 15‚ÇΩ)
  final double minPrice;          // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ (1000‚ÇΩ)
  final bool roundToThousands;    // –û–∫—Ä—É–≥–ª—è—Ç—å –¥–æ —Ç—ã—Å—è—á
  final DateTime updatedAt;       // –ö–æ–≥–¥–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–æ
  final String updatedBy;         // –ö—Ç–æ –æ–±–Ω–æ–≤–∏–ª (ID –∞–¥–º–∏–Ω–∞)
  
  CalculatorSettings({...});
  
  factory CalculatorSettings.fromJson(Map<String, dynamic> json);
  Map<String, dynamic> toJson();
}
```

#### 1.2. –°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
**–§–∞–π–ª:** `lib/services/calculator_settings_service.dart`

```dart
class CalculatorSettingsService {
  // –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ Firebase
  Future<CalculatorSettings> getSettings();
  
  // –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)
  Future<void> updateSettings(CalculatorSettings settings);
  
  // –õ–æ–∫–∞–ª—å–Ω—ã–π –∫–µ—à –Ω–∞—Å—Ç—Ä–æ–µ–∫
  CalculatorSettings? _cachedSettings;
}
```

#### 1.3. –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤ Firebase Firestore

```
/calculator_settings (collection)
  ‚îî‚îÄ‚îÄ /current (document)
      ‚îú‚îÄ‚îÄ baseCost: 500
      ‚îú‚îÄ‚îÄ costPerKm: 15
      ‚îú‚îÄ‚îÄ minPrice: 1000
      ‚îú‚îÄ‚îÄ roundToThousands: true
      ‚îú‚îÄ‚îÄ updatedAt: timestamp
      ‚îî‚îÄ‚îÄ updatedBy: "admin_id"
```

#### 1.4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Yandex Maps API

**–§–∞–π–ª:** `lib/services/yandex_maps_service.dart`

```dart
class YandexMapsService {
  static const String _apiKey = 'YOUR_YANDEX_API_KEY';
  
  // –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –¥–≤—É–º—è –∞–¥—Ä–µ—Å–∞–º–∏
  Future<double> getDistance(String fromAddress, String toAddress);
  
  // –ì–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–¥—Ä–µ—Å–∞ (–∞–¥—Ä–µ—Å ‚Üí –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã)
  Future<Coordinates> geocode(String address);
  
  // –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç –∏ –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
  Future<RouteInfo> buildRoute(String from, String to);
}
```

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å:**
```yaml
# pubspec.yaml
dependencies:
  http: ^1.1.0  # –î–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤
```

---

### üî∑ –≠–¢–ê–ü 2: –°–æ–∑–¥–∞–Ω–∏–µ UI –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
**–°—Ä–æ–∫:** 2 –¥–Ω—è  
**–¶–µ–ª—å:** –°–æ–∑–¥–∞—Ç—å –∫—Ä–∞—Å–∏–≤—ã–π –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

#### 2.1. –°–æ–∑–¥–∞—Ç—å –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω
**–§–∞–π–ª:** `lib/features/booking/screens/custom_route_calculator_screen.dart`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —ç–∫—Ä–∞–Ω–∞:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  ‚Üê –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ç–∞–∫—Å–∏               ‚îÇ ‚Üê CustomNavigationBar
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                     ‚îÇ
‚îÇ  üìç –û—Ç–∫—É–¥–∞                          ‚îÇ ‚Üê –¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ —Å –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ–º
‚îÇ  [–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è...]     ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ          üîÑ                          ‚îÇ ‚Üê –ö–Ω–æ–ø–∫–∞ —Å–º–µ–Ω—ã –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
‚îÇ                                     ‚îÇ
‚îÇ  üìç –ö—É–¥–∞                            ‚îÇ ‚Üê –¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ —Å –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ–º
‚îÇ  [–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è...]      ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ      ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  üöó –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ~150 –∫–º             ‚îÇ ‚Üê –ë–ª–æ–∫ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
‚îÇ  üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å: 3000 ‚ÇΩ               ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  [    –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å    ]    ‚îÇ ‚Üê –ö–Ω–æ–ø–∫–∞ —Ä–∞—Å—á—ë—Ç–∞
‚îÇ                                     ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ      ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  ‚ÑπÔ∏è –î–µ—Ç–∞–ª–∏ —Ä–∞—Å—á—ë—Ç–∞:                 ‚îÇ ‚Üê –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º—ã–π –±–ª–æ–∫
‚îÇ     –ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: 500 ‚ÇΩ        ‚îÇ
‚îÇ     –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: 150 –∫–º √ó 15 ‚ÇΩ = 2250 ‚ÇΩ
‚îÇ     –ò—Ç–æ–≥–æ: 2750 ‚ÇΩ ‚Üí 3000 ‚ÇΩ          ‚îÇ
‚îÇ     (–æ–∫—Ä—É–≥–ª–µ–Ω–æ –¥–æ —Ç—ã—Å—è—á)            ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  [      –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∑–∞–∫–∞–∑      ]    ‚îÇ ‚Üê –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è
‚îÇ                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### 2.2. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —ç–∫—Ä–∞–Ω–∞

**a) –ü–æ–ª–µ –≤–≤–æ–¥–∞ –∞–¥—Ä–µ—Å–∞ —Å –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ–º:**
```dart
Widget _buildAddressField({
  required String label,
  required TextEditingController controller,
  required bool isFrom,
  required CustomTheme theme,
}) {
  return CupertinoTextField(
    controller: controller,
    placeholder: '–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å...',
    prefix: Icon(CupertinoIcons.location, color: theme.systemRed),
    onChanged: (value) => _onAddressChanged(value, isFrom),
    // –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Yandex Suggest API
  );
}
```

**b) –ë–ª–æ–∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–∞—Ä—à—Ä—É—Ç–µ:**
```dart
Widget _buildRouteInfo(CustomTheme theme) {
  if (_routeInfo == null) return SizedBox();
  
  return Container(
    padding: EdgeInsets.all(16),
    decoration: BoxDecoration(
      color: theme.secondarySystemBackground,
      borderRadius: BorderRadius.circular(12),
    ),
    child: Column(
      children: [
        _buildInfoRow('–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ', '${_routeInfo!.distance} –∫–º'),
        _buildInfoRow('–°—Ç–æ–∏–º–æ—Å—Ç—å', '${_routeInfo!.price} ‚ÇΩ'),
      ],
    ),
  );
}
```

**c) –î–µ—Ç–∞–ª–∏ —Ä–∞—Å—á—ë—Ç–∞ (—Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º—ã–π):**
```dart
Widget _buildCalculationDetails(CustomTheme theme) {
  return CupertinoButton(
    child: Row(
      children: [
        Icon(CupertinoIcons.info_circle),
        Text('–î–µ—Ç–∞–ª–∏ —Ä–∞—Å—á—ë—Ç–∞'),
        Spacer(),
        Icon(_isDetailsExpanded ? CupertinoIcons.chevron_up : CupertinoIcons.chevron_down),
      ],
    ),
    onPressed: () {
      setState(() => _isDetailsExpanded = !_isDetailsExpanded);
    },
  );
  
  if (_isDetailsExpanded) {
    return _buildDetailsContent();
  }
}
```

---

### üî∑ –≠–¢–ê–ü 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Yandex Maps API
**–°—Ä–æ–∫:** 2 –¥–Ω—è  
**–¶–µ–ª—å:** –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –∏ –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–æ–≤

#### 3.1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ API –∫–ª—é—á–∞

**–ü–æ–ª—É—á–∏—Ç—å –∫–ª—é—á:**
1. –ó–∞–π—Ç–∏ –Ω–∞ https://developer.tech.yandex.ru/
2. –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
3. –í–∫–ª—é—á–∏—Ç—å Geocoder API –∏ Routing API
4. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å API –∫–ª—é—á

**–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–ª—é—á:**
```dart
// lib/config/api_keys.dart
class ApiKeys {
  static const String yandexMapsApiKey = 'YOUR_API_KEY_HERE';
}
```

#### 3.2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã API

**a) –ì–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ (–∞–¥—Ä–µ—Å ‚Üí –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã):**
```dart
Future<Coordinates?> geocode(String address) async {
  final url = Uri.parse(
    'https://geocode-maps.yandex.ru/1.x/?apikey=$_apiKey&geocode=$address&format=json'
  );
  
  final response = await http.get(url);
  
  if (response.statusCode == 200) {
    final json = jsonDecode(response.body);
    // –ü–∞—Ä—Å–∏–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–∑ –æ—Ç–≤–µ—Ç–∞
    return Coordinates.fromYandexJson(json);
  }
  
  return null;
}
```

**b) –†–∞—Å—á—ë—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è:**
```dart
Future<RouteInfo?> calculateRoute(String fromAddress, String toAddress) async {
  // 1. –ì–µ–æ–∫–æ–¥–∏—Ä—É–µ–º –æ–±–∞ –∞–¥—Ä–µ—Å–∞
  final fromCoords = await geocode(fromAddress);
  final toCoords = await geocode(toAddress);
  
  if (fromCoords == null || toCoords == null) {
    return null;
  }
  
  // 2. –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –º–∞—Ä—à—Ä—É—Ç
  final url = Uri.parse(
    'https://api.routing.yandex.net/v2/route?'
    'apikey=$_apiKey&'
    'waypoints=${fromCoords.lon},${fromCoords.lat}|${toCoords.lon},${toCoords.lat}&'
    'mode=driving'
  );
  
  final response = await http.get(url);
  
  if (response.statusCode == 200) {
    final json = jsonDecode(response.body);
    final distanceMeters = json['route']['distance']['value'];
    final distanceKm = distanceMeters / 1000;
    
    return RouteInfo(
      distance: distanceKm,
      duration: json['route']['duration']['value'],
      fromAddress: fromAddress,
      toAddress: toAddress,
    );
  }
  
  return null;
}
```

**c) –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–æ–≤ (Suggest):**
```dart
Future<List<String>> getSuggestions(String query) async {
  final url = Uri.parse(
    'https://suggest-maps.yandex.ru/v1/suggest?'
    'apikey=$_apiKey&'
    'text=$query&'
    'types=locality,street,house'
  );
  
  final response = await http.get(url);
  
  if (response.statusCode == 200) {
    final json = jsonDecode(response.body);
    return (json['results'] as List)
        .map((r) => r['title']['text'] as String)
        .toList();
  }
  
  return [];
}
```

---

### üî∑ –≠–¢–ê–ü 4: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏ —Ä–∞—Å—á—ë—Ç–∞ —Ü–µ–Ω—ã
**–°—Ä–æ–∫:** 1 –¥–µ–Ω—å  
**–¶–µ–ª—å:** –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Å –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ–º

#### 4.1. –°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å —Ä–∞—Å—á—ë—Ç–∞
**–§–∞–π–ª:** `lib/services/price_calculator_service.dart`

```dart
class PriceCalculatorService {
  final CalculatorSettingsService _settingsService;
  
  // –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–µ–∑–¥–∫–∏
  Future<PriceCalculation> calculatePrice(double distanceKm) async {
    final settings = await _settingsService.getSettings();
    
    // –§–æ—Ä–º—É–ª–∞: –±–∞–∑–æ–≤–∞—è + (–∫–º √ó –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç)
    double rawPrice = settings.baseCost + (distanceKm * settings.costPerKm);
    
    // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞
    if (rawPrice < settings.minPrice) {
      return PriceCalculation(
        rawPrice: rawPrice,
        finalPrice: settings.minPrice,
        distance: distanceKm,
        baseCost: settings.baseCost,
        costPerKm: settings.costPerKm,
        roundedUp: false,
        appliedMinPrice: true,
      );
    }
    
    // –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–æ —Ç—ã—Å—è—á –≤–≤–µ—Ä—Ö
    double finalPrice = rawPrice;
    bool roundedUp = false;
    
    if (settings.roundToThousands && rawPrice > settings.minPrice) {
      finalPrice = (rawPrice / 1000).ceil() * 1000;
      roundedUp = true;
    }
    
    return PriceCalculation(
      rawPrice: rawPrice,
      finalPrice: finalPrice,
      distance: distanceKm,
      baseCost: settings.baseCost,
      costPerKm: settings.costPerKm,
      roundedUp: roundedUp,
      appliedMinPrice: false,
    );
  }
}
```

#### 4.2. –ú–æ–¥–µ–ª—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Ä–∞—Å—á—ë—Ç–∞
```dart
class PriceCalculation {
  final double rawPrice;         // –°—ã—Ä–∞—è —Ü–µ–Ω–∞ (–¥–æ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è)
  final double finalPrice;       // –§–∏–Ω–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ (–ø–æ—Å–ª–µ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è)
  final double distance;         // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –≤ –∫–º
  final double baseCost;         // –ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å
  final double costPerKm;        // –°—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞ –∫–º
  final bool roundedUp;          // –ë—ã–ª–æ –ª–∏ –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ
  final bool appliedMinPrice;    // –ü—Ä–∏–º–µ–Ω–µ–Ω–∞ –ª–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞
  
  PriceCalculation({...});
  
  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–≤–æ–¥ –¥–ª—è UI
  String get explanation {
    String result = '–ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${baseCost.toInt()} ‚ÇΩ\n';
    result += '–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ${distance.toInt()} –∫–º √ó ${costPerKm.toInt()} ‚ÇΩ = ${(distance * costPerKm).toInt()} ‚ÇΩ\n';
    result += '–°—É–º–º–∞: ${rawPrice.toInt()} ‚ÇΩ\n';
    
    if (appliedMinPrice) {
      result += '‚Üí –ü—Ä–∏–º–µ–Ω–µ–Ω–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞: ${finalPrice.toInt()} ‚ÇΩ';
    } else if (roundedUp) {
      result += '‚Üí –û–∫—Ä—É–≥–ª–µ–Ω–æ –¥–æ —Ç—ã—Å—è—á: ${finalPrice.toInt()} ‚ÇΩ';
    }
    
    return result;
  }
}
```

---

### üî∑ –≠–¢–ê–ü 5: –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (–ö–∞–±–∏–Ω–µ—Ç –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞)
**–°—Ä–æ–∫:** 2 –¥–Ω—è  
**–¶–µ–ª—å:** –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞

#### 5.1. –°–æ–∑–¥–∞—Ç—å —ç–∫—Ä–∞–Ω –Ω–∞—Å—Ç—Ä–æ–µ–∫
**–§–∞–π–ª:** `lib/features/admin/screens/calculator_settings_screen.dart`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —ç–∫—Ä–∞–Ω–∞:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  ‚Üê –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                     ‚îÇ
‚îÇ  –ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å                  ‚îÇ
‚îÇ  [   500   ] ‚ÇΩ                      ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  –°—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞ –∫–∏–ª–æ–º–µ—Ç—Ä              ‚îÇ
‚îÇ  [    15   ] ‚ÇΩ/–∫–º                   ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞                   ‚îÇ
‚îÇ  [  1000   ] ‚ÇΩ                      ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  ‚òëÔ∏è –û–∫—Ä—É–≥–ª—è—Ç—å –¥–æ —Ç—ã—Å—è—á –≤–≤–µ—Ä—Ö        ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ      ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  üìä –ü—Ä–∏–º–µ—Ä—ã —Ä–∞—Å—á—ë—Ç–∞:                ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  50 –∫–º  ‚Üí 1250 ‚ÇΩ ‚Üí 2000 ‚ÇΩ          ‚îÇ
‚îÇ  100 –∫–º ‚Üí 2000 ‚ÇΩ ‚Üí 2000 ‚ÇΩ          ‚îÇ
‚îÇ  150 –∫–º ‚Üí 2750 ‚ÇΩ ‚Üí 3000 ‚ÇΩ          ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  [      –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è   ]    ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:              ‚îÇ
‚îÇ  14.10.2025 17:45 (admin@taxi.ru)  ‚îÇ
‚îÇ                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### 5.2. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

```dart
Future<void> _saveSettings() async {
  setState(() => _isLoading = true);
  
  try {
    final settings = CalculatorSettings(
      baseCost: _baseCost,
      costPerKm: _costPerKm,
      minPrice: _minPrice,
      roundToThousands: _roundToThousands,
      updatedAt: DateTime.now(),
      updatedBy: currentUser.id,
    );
    
    await CalculatorSettingsService.instance.updateSettings(settings);
    
    _showSuccess('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
  } catch (e) {
    _showError('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: $e');
  } finally {
    setState(() => _isLoading = false);
  }
}
```

#### 5.3. –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

**–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∞–≤:**
```dart
// lib/services/auth_service.dart
class AuthService {
  // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω–æ–º
  Future<bool> isAdmin(String userId) async {
    final userDoc = await FirebaseFirestore.instance
        .collection('users')
        .doc(userId)
        .get();
    
    return userDoc.data()?['role'] == 'admin';
  }
}
```

**–ó–∞—â–∏—Ç–∞ —ç–∫—Ä–∞–Ω–∞:**
```dart
@override
void initState() {
  super.initState();
  _checkAdminAccess();
}

Future<void> _checkAdminAccess() async {
  final user = await AuthService.instance.getCurrentUser();
  final isAdmin = await AuthService.instance.isAdmin(user.id);
  
  if (!isAdmin) {
    Navigator.pop(context);
    _showError('–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω');
  }
}
```

---

### üî∑ –≠–¢–ê–ü 6: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º flow
**–°—Ä–æ–∫:** 1 –¥–µ–Ω—å  
**–¶–µ–ª—å:** –ü–æ–¥–∫–ª—é—á–∏—Ç—å –Ω–æ–≤—ã–π —ç–∫—Ä–∞–Ω –∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

#### 6.1. –û–±–Ω–æ–≤–∏—Ç—å booking_screen.dart

**–ó–∞–º–µ–Ω–∏—Ç—å –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ "–°–≤–æ–±–æ–¥–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç":**

```dart
// –ë—ã–ª–æ:
CupertinoButton(
  onPressed: () {
    Navigator.push(
      context,
      CupertinoPageRoute(
        builder: (context) => RouteSelectionScreen(...),
      ),
    );
  },
  child: Text('–°–≤–æ–±–æ–¥–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç'),
)

// –°—Ç–∞–ª–æ:
CupertinoButton(
  onPressed: () {
    Navigator.push(
      context,
      CupertinoPageRoute(
        builder: (context) => CustomRouteCalculatorScreen(),
      ),
    );
  },
  child: Text('–°–≤–æ–±–æ–¥–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç'),
)
```

#### 6.2. –ü–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –¥–∞–ª—å—à–µ

**–ü–æ—Å–ª–µ —Ä–∞—Å—á—ë—Ç–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —ç–∫—Ä–∞–Ω –¥–µ—Ç–∞–ª–µ–π –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:**

```dart
// –í CustomRouteCalculatorScreen
void _proceedToBooking() {
  if (_priceCalculation == null) return;
  
  final customRoute = CustomRoute(
    fromAddress: _fromController.text,
    toAddress: _toController.text,
    distance: _priceCalculation!.distance,
    price: _priceCalculation!.finalPrice,
    priceDetails: _priceCalculation!,
  );
  
  Navigator.push(
    context,
    CupertinoPageRoute(
      builder: (context) => CustomRouteBookingScreen(
        customRoute: customRoute,
      ),
    ),
  );
}
```

---

### üî∑ –≠–¢–ê–ü 7: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
**–°—Ä–æ–∫:** 2 –¥–Ω—è  
**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

#### 7.1. Unit-—Ç–µ—Å—Ç—ã

**–§–∞–π–ª:** `test/services/price_calculator_test.dart`

```dart
void main() {
  group('PriceCalculatorService', () {
    test('–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è', () {
      final calc = PriceCalculatorService(...);
      final result = calc.calculatePrice(10); // 10 –∫–º
      
      // –û–∂–∏–¥–∞–µ–º: 500 + (10 √ó 15) = 650 ‚ÇΩ ‚Üí 1000 ‚ÇΩ (–º–∏–Ω–∏–º—É–º)
      expect(result.finalPrice, 1000);
      expect(result.appliedMinPrice, true);
    });
    
    test('–û–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–æ —Ç—ã—Å—è—á —Ä–∞–±–æ—Ç–∞–µ—Ç', () {
      final result = calc.calculatePrice(150); // 150 –∫–º
      
      // –û–∂–∏–¥–∞–µ–º: 500 + (150 √ó 15) = 2750 ‚ÇΩ ‚Üí 3000 ‚ÇΩ
      expect(result.finalPrice, 3000);
      expect(result.roundedUp, true);
    });
  });
}
```

#### 7.2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- ‚úÖ –í–≤–æ–¥ –∞–¥—Ä–µ—Å–æ–≤ –∏ –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
- ‚úÖ –†–∞—Å—á—ë—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è —á–µ—Ä–µ–∑ Yandex API
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–∞—Å—á—ë—Ç–∞ —Ü–µ–Ω—ã
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ Firebase
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ —Å–ø–∏—Å–∫–µ –∑–∞–∫–∞–∑–æ–≤

#### 7.3. E2E —Ç–µ—Å—Ç—ã (—Ä—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

**–°—Ü–µ–Ω–∞—Ä–∏–π 1: –ö–æ—Ä–æ—Ç–∫–∞—è –ø–æ–µ–∑–¥–∫–∞**
1. –û—Ç–∫—Ä—ã—Ç—å "–°–≤–æ–±–æ–¥–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç"
2. –í–≤–µ—Å—Ç–∏ "–ú–æ—Å–∫–≤–∞, –ö—Ä–∞—Å–Ω–∞—è –ø–ª–æ—â–∞–¥—å"
3. –í–≤–µ—Å—Ç–∏ "–ú–æ—Å–∫–≤–∞, –ü–∞—Ä–∫ –ì–æ—Ä—å–∫–æ–≥–æ"
4. –ù–∞–∂–∞—Ç—å "–†–∞—Å—Å—á–∏—Ç–∞—Ç—å"
5. **–û–∂–∏–¥–∞–µ–º:** ~10 –∫–º, 1000 ‚ÇΩ (–º–∏–Ω–∏–º—É–º)
6. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∑–∞–∫–∞–∑

**–°—Ü–µ–Ω–∞—Ä–∏–π 2: –î–ª–∏–Ω–Ω–∞—è –ø–æ–µ–∑–¥–∫–∞**
1. –í–≤–µ—Å—Ç–∏ "–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É"
2. –í–≤–µ—Å—Ç–∏ "–ú–æ—Å–∫–≤–∞"
3. –ù–∞–∂–∞—Ç—å "–†–∞—Å—Å—á–∏—Ç–∞—Ç—å"
4. **–û–∂–∏–¥–∞–µ–º:** ~1000 –∫–º, ~15500 ‚ÇΩ ‚Üí 16000 ‚ÇΩ
5. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∑–∞–∫–∞–∑

**–°—Ü–µ–Ω–∞—Ä–∏–π 3: –ê–¥–º–∏–Ω –º–µ–Ω—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**
1. –í–æ–π—Ç–∏ –∫–∞–∫ –∞–¥–º–∏–Ω
2. –û—Ç–∫—Ä—ã—Ç—å "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞"
3. –ò–∑–º–µ–Ω–∏—Ç—å –±–∞–∑–æ–≤—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å: 500 ‚Üí 800
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
5. –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä
6. **–û–∂–∏–¥–∞–µ–º:** –¶–µ–Ω—ã –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω—ã —Å –Ω–æ–≤–æ–π –±–∞–∑–æ–π

---

## üìä –í—Ä–µ–º–µ–Ω–Ω–∞—è –æ—Ü–µ–Ω–∫–∞

| –≠—Ç–∞–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –°—Ä–æ–∫ | –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ |
|------|----------|------|-------------|
| 1 | –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã | 1 –¥–µ–Ω—å | - |
| 2 | –°–æ–∑–¥–∞–Ω–∏–µ UI | 2 –¥–Ω—è | –≠—Ç–∞–ø 1 |
| 3 | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Yandex API | 2 –¥–Ω—è | –≠—Ç–∞–ø 1 |
| 4 | –õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á—ë—Ç–∞ —Ü–µ–Ω—ã | 1 –¥–µ–Ω—å | –≠—Ç–∞–ø 1 |
| 5 | –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å | 2 –¥–Ω—è | –≠—Ç–∞–ø 1, 4 |
| 6 | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å flow | 1 –¥–µ–Ω—å | –≠—Ç–∞–ø 2, 3, 4 |
| 7 | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | 2 –¥–Ω—è | –í—Å–µ —ç—Ç–∞–ø—ã |

**–ò—Ç–æ–≥–æ:** ~11 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π (2.5 –Ω–µ–¥–µ–ª–∏)

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
lib/
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ calculator_settings.dart          # –ú–æ–¥–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–µ–∫
‚îÇ   ‚îú‚îÄ‚îÄ custom_route.dart                 # –ú–æ–¥–µ–ª—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ price_calculation.dart            # –ú–æ–¥–µ–ª—å —Ä–∞—Å—á—ë—Ç–∞ —Ü–µ–Ω—ã
‚îÇ
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ calculator_settings_service.dart  # –°–µ—Ä–≤–∏—Å –Ω–∞—Å—Ç—Ä–æ–µ–∫
‚îÇ   ‚îú‚îÄ‚îÄ yandex_maps_service.dart          # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Yandex
‚îÇ   ‚îî‚îÄ‚îÄ price_calculator_service.dart     # –†–∞—Å—á—ë—Ç —Ü–µ–Ω—ã
‚îÇ
‚îú‚îÄ‚îÄ features/
‚îÇ   ‚îú‚îÄ‚îÄ booking/screens/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ custom_route_calculator_screen.dart    # –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ custom_route_booking_screen.dart       # –≠–∫—Ä–∞–Ω –¥–µ—Ç–∞–ª–µ–π –∑–∞–∫–∞–∑–∞
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ admin/screens/
‚îÇ       ‚îî‚îÄ‚îÄ calculator_settings_screen.dart        # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –∞–¥–º–∏–Ω–∞
‚îÇ
‚îî‚îÄ‚îÄ config/
    ‚îî‚îÄ‚îÄ api_keys.dart                     # API –∫–ª—é—á–∏
```

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å API –∫–ª—é—á–µ–π

### –í–∞–∂–Ω–æ!
**–ù–ï —Ö—Ä–∞–Ω–∏—Ç—å API –∫–ª—é—á–∏ –≤ –∫–æ–¥–µ!**

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥:**

```dart
// lib/config/api_keys.dart
class ApiKeys {
  static String get yandexMapsApiKey {
    // –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –±—Ä–∞—Ç—å –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
    const key = String.fromEnvironment('YANDEX_API_KEY');
    if (key.isEmpty) {
      // –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ - –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ (–Ω–µ –≤ git)
      return _devApiKey;
    }
    return key;
  }
  
  // –õ–æ–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—å!)
  static const String _devApiKey = 'your_dev_key';
}
```

**–î–æ–±–∞–≤–∏—Ç—å –≤ .gitignore:**
```
# API Keys
lib/config/api_keys_local.dart
```

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

### Backend:
- [ ] –ú–æ–¥–µ–ª—å `CalculatorSettings` —Å–æ–∑–¥–∞–Ω–∞
- [ ] –°–µ—Ä–≤–∏—Å `CalculatorSettingsService` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [ ] Firebase Firestore —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
- [ ] Yandex Maps API –∫–ª—é—á –ø–æ–ª—É—á–µ–Ω
- [ ] –°–µ—Ä–≤–∏—Å `YandexMapsService` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [ ] –°–µ—Ä–≤–∏—Å `PriceCalculatorService` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω

### Frontend:
- [ ] –≠–∫—Ä–∞–Ω `CustomRouteCalculatorScreen` —Å–æ–∑–¥–∞–Ω
- [ ] –ü–æ–ª—è –≤–≤–æ–¥–∞ –∞–¥—Ä–µ—Å–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–æ–≤ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ
- [ ] –†–∞—Å—á—ë—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –†–∞—Å—á—ë—Ç —Ü–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
- [ ] –ë–ª–æ–∫ –¥–µ—Ç–∞–ª–µ–π —Ä–∞—Å—á—ë—Ç–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
- [ ] –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —ç–∫—Ä–∞–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ê–¥–º–∏–Ω:
- [ ] –≠–∫—Ä–∞–Ω `CalculatorSettingsScreen` —Å–æ–∑–¥–∞–Ω
- [ ] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è
- [ ] –ü—Ä–∏–º–µ—Ä—ã —Ä–∞—Å—á—ë—Ç–∞ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:
- [ ] –ù–∞–≤–∏–≥–∞—Ü–∏—è –∏–∑ booking_screen –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- [ ] –î–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –º–µ–∂–¥—É —ç–∫—Ä–∞–Ω–∞–º–∏
- [ ] –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ó–∞–∫–∞–∑ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
- [ ] Unit-—Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã
- [ ] E2E —Ç–µ—Å—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –®–∞–≥ 1: –ù–∞—á–∞—Ç—å —Å —ç—Ç–∞–ø–∞ 1
```bash
# –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–∞–π–ª–æ–≤
mkdir -p lib/models
mkdir -p lib/services
mkdir -p lib/features/admin/screens
mkdir -p lib/config

# –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—ã–µ —Ñ–∞–π–ª—ã
touch lib/models/calculator_settings.dart
touch lib/services/calculator_settings_service.dart
touch lib/services/yandex_maps_service.dart
```

### –®–∞–≥ 2: –ü–æ–ª—É—á–∏—Ç—å Yandex API –∫–ª—é—á
1. –ó–∞–π—Ç–∏ –Ω–∞ https://developer.tech.yandex.ru/
2. –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
3. –í–∫–ª—é—á–∏—Ç—å –Ω—É–∂–Ω—ã–µ API
4. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Firebase
```bash
# –î–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏—é calculator_settings
# –°–æ–∑–¥–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç current —Å –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
```

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ Yandex Maps:
–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –ø—Ä–æ–±–ª–µ–º—ã —Å Yandex, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
- **Google Maps API** (–ø–ª–∞—Ç–Ω—ã–π, –Ω–æ –Ω–∞–¥—ë–∂–Ω—ã–π)
- **OpenStreetMap Nominatim** (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π, –Ω–æ –º–µ–¥–ª–µ–Ω–Ω—ã–π)
- **Here Maps API** (–ø–ª–∞—Ç–Ω—ã–π, —Ö–æ—Ä–æ—à–∏–π –¥–ª—è –†–æ—Å—Å–∏–∏)

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:
- –ö–µ—à–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–µ–±–∞—É–Ω—Å–∏–Ω–≥ –¥–ª—è –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è

### –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è:
- –ò—Å—Ç–æ—Ä–∏—è —Ä–∞—Å—á—ë—Ç–æ–≤
- –ò–∑–±—Ä–∞–Ω–Ω—ã–µ –∞–¥—Ä–µ—Å–∞
- –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞ –Ω–∞ –∫–∞—Ä—Ç–µ
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã (—á–µ—Ä–µ–∑ –ø–ª–∞—Ç–Ω—ã–µ –¥–æ—Ä–æ–≥–∏ / –±–µ–∑)

---

**–ì–æ—Ç–æ–≤—ã –Ω–∞—á–∏–Ω–∞—Ç—å? –î–∞–π—Ç–µ –∑–Ω–∞—Ç—å, —Å –∫–∞–∫–æ–≥–æ —ç—Ç–∞–ø–∞ –Ω–∞—á–∞—Ç—å! üöÄ**
