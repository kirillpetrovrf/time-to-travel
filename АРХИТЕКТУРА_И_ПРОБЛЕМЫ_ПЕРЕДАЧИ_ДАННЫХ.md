# üîç –ü–û–õ–ù–´–ô –ê–ù–ê–õ–ò–ó –ê–†–•–ò–¢–ï–ö–¢–£–†–´ TIME TO TRAVEL

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 26 —è–Ω–≤–∞—Ä—è 2026  
**–ê–Ω–∞–ª–∏—Ç–∏–∫:** GitHub Copilot  
**–¶–µ–ª—å:** –ò–∑—É—á–∏—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —Å—Ö–µ–º—É –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö, –ø–µ—Ä–µ–¥–∞—á—É –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç‚Üí—Å–µ—Ä–≤–µ—Ä‚Üí–¥–∏—Å–ø–µ—Ç—á–µ—Ä

---

## üìä –û–ë–©–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø

### –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    FLUTTER –ü–†–ò–õ–û–ñ–ï–ù–ò–ï                           ‚îÇ
‚îÇ                  (iOS/Android –∫–ª–∏–µ–Ω—Ç—ã)                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                 ‚îÇ
‚îÇ  üßë –ö–õ–ò–ï–ù–¢                          üë®‚Äçüíº –î–ò–°–ü–ï–¢–ß–ï–†              ‚îÇ
‚îÇ  ‚îú‚îÄ –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤                ‚îú‚îÄ –ü—Ä–æ—Å–º–æ—Ç—Ä –í–°–ï–• –∑–∞–∫–∞–∑–æ–≤   ‚îÇ
‚îÇ  ‚îú‚îÄ –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–∏—Ö –∑–∞–∫–∞–∑–æ–≤          ‚îú‚îÄ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤   ‚îÇ
‚îÇ  ‚îî‚îÄ –û–ø–ª–∞—Ç–∞                           ‚îî‚îÄ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞–º–∏    ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  üì± –õ–û–ö–ê–õ–¨–ù–û–ï –•–†–ê–ù–ò–õ–ò–©–ï (SQLite)                               ‚îÇ
‚îÇ  ‚îú‚îÄ taxi_orders.db       - –ó–∞–∫–∞–∑—ã (–æ—Ñ–ª–∞–π–Ω-–∫—ç—à)                ‚îÇ
‚îÇ  ‚îú‚îÄ predefined_routes.db - –ú–∞—Ä—à—Ä—É—Ç—ã                            ‚îÇ
‚îÇ  ‚îî‚îÄ route_groups.db      - –ì—Ä—É–ø–ø—ã –º–∞—Ä—à—Ä—É—Ç–æ–≤                    ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
                   ‚îÇ HTTPS (API)
                   ‚îÇ
                   ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              BACKEND API (Dart Frog)                            ‚îÇ
‚îÇ              https://titotr.ru                                  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                 ‚îÇ
‚îÇ  üì° API ENDPOINTS:                                              ‚îÇ
‚îÇ  ‚îú‚îÄ POST /api/orders       - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞                   ‚îÇ
‚îÇ  ‚îú‚îÄ GET  /api/orders       - –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ (—Ä–æ–ª—å-–∑–∞–≤–∏—Å–∏–º—ã–π)   ‚îÇ
‚îÇ  ‚îú‚îÄ PUT  /api/orders/:id   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞                 ‚îÇ
‚îÇ  ‚îú‚îÄ GET  /api/search       - –ü–æ–∏—Å–∫ –º–∞—Ä—à—Ä—É—Ç–æ–≤                   ‚îÇ
‚îÇ  ‚îî‚îÄ GET  /admin/stats      - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (—Ç–æ–ª—å–∫–æ –¥–∏—Å–ø–µ—Ç—á–µ—Ä)     ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
                   ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           POSTGRESQL DATABASE                                   ‚îÇ
‚îÇ           (–°–µ—Ä–≤–µ—Ä Selectel)                                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                 ‚îÇ
‚îÇ  üóÑÔ∏è –¢–ê–ë–õ–ò–¶–´:                                                   ‚îÇ
‚îÇ  ‚îú‚îÄ users              - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (—Å —Ä–æ–ª—è–º–∏)               ‚îÇ
‚îÇ  ‚îú‚îÄ orders             - –ó–∞–∫–∞–∑—ã (–≥–ª–∞–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞)              ‚îÇ
‚îÇ  ‚îú‚îÄ predefined_routes  - –ü—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã             ‚îÇ
‚îÇ  ‚îú‚îÄ route_groups       - –ì—Ä—É–ø–ø—ã –º–∞—Ä—à—Ä—É—Ç–æ–≤                      ‚îÇ
‚îÇ  ‚îú‚îÄ refresh_tokens     - JWT —Ç–æ–∫–µ–Ω—ã                            ‚îÇ
‚îÇ  ‚îî‚îÄ payments           - –ü–ª–∞—Ç–µ–∂–∏                               ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üóÑÔ∏è –ë–ê–ó–ê –î–ê–ù–ù–´–• POSTGRESQL (–û—Å–Ω–æ–≤–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ)

### –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ: 
**–°–µ—Ä–≤–µ—Ä Selectel** ‚Üí PostgreSQL –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ

### –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:

#### 1Ô∏è‚É£ **–¢–∞–±–ª–∏—Ü–∞ `users` (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)**

```sql
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    name VARCHAR(255) NOT NULL,
    phone VARCHAR(20),
    is_verified BOOLEAN DEFAULT FALSE,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

**–¢–µ—Å—Ç–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏** (–∏–∑ `02-seed.sql`):
```
admin@titotr.ru     / Test123! - –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
driver@titotr.ru    / Test123! - –í–æ–¥–∏—Ç–µ–ª—å –ò–≤–∞–Ω
client@example.com  / Test123! - –¢–µ—Å—Ç–æ–≤—ã–π –ö–ª–∏–µ–Ω—Ç
```

‚ùóÔ∏è **–í–ê–ñ–ù–û:** –í —Å—Ö–µ–º–µ –ù–ï–¢ –ø–æ–ª—è `role`! 
- –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ (SharedPreferences)
- Backend –ù–ï —Ä–∞–∑–ª–∏—á–∞–µ—Ç —Ä–æ–ª–∏ —á–µ—Ä–µ–∑ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ JWT —Ç–æ–∫–µ–Ω—ã

#### 2Ô∏è‚É£ **–¢–∞–±–ª–∏—Ü–∞ `orders` (–ó–∞–∫–∞–∑—ã) - –ö–õ–Æ–ß–ï–í–ê–Ø –¢–ê–ë–õ–ò–¶–ê**

```sql
CREATE TABLE orders (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    order_id VARCHAR(255) UNIQUE NOT NULL,  -- ORDER-2026-01-XXX
    user_id UUID REFERENCES users(id),      -- NULL –¥–ª—è –∞–Ω–æ–Ω–∏–º–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤
    
    -- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
    from_lat DECIMAL(10, 7) NOT NULL,
    from_lon DECIMAL(10, 7) NOT NULL,
    to_lat DECIMAL(10, 7) NOT NULL,
    to_lon DECIMAL(10, 7) NOT NULL,
    
    -- –ê–¥—Ä–µ—Å–∞
    from_address TEXT NOT NULL,
    to_address TEXT NOT NULL,
    
    -- –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –∏ —Ü–µ–Ω—ã
    distance_km DECIMAL(10, 2) NOT NULL,
    raw_price DECIMAL(10, 2) NOT NULL,
    final_price DECIMAL(10, 2) NOT NULL,
    base_cost DECIMAL(10, 2) NOT NULL,
    cost_per_km DECIMAL(10, 2) NOT NULL,
    
    -- –°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞
    status VARCHAR(50) NOT NULL DEFAULT 'pending',
    -- pending, confirmed, in_progress, completed, cancelled
    
    -- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∏–µ–Ω—Ç–µ
    client_name VARCHAR(255),
    client_phone VARCHAR(20),
    
    -- –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –ø–æ–µ–∑–¥–∫–∏
    departure_date DATE,
    departure_time TIME,
    
    -- JSONB –ø–æ–ª—è (–í–ê–ñ–ù–û!)
    passengers JSONB,  -- [{"name": "–ò–≤–∞–Ω", "age": 30, "type": "adult"}]
    baggage JSONB,     -- [{"size": "m", "quantity": 2}]
    pets JSONB,        -- [{"category": "upTo5kg", "breed": "–ö–æ—Ç"}]
    
    -- –ó–∞–º–µ—Ç–∫–∏
    notes TEXT,
    
    -- –ö–ª–∞—Å—Å –∞–≤—Ç–æ–º–æ–±–∏–ª—è
    vehicle_class VARCHAR(50),
    
    -- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

#### 3Ô∏è‚É£ **–î—Ä—É–≥–∏–µ —Ç–∞–±–ª–∏—Ü—ã**

- `predefined_routes` - –ü—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã (–†–æ—Å—Ç–æ–≤-–¢–∞–≥–∞–Ω—Ä–æ–≥ –∏ —Ç.–¥.)
- `route_groups` - –ì—Ä—É–ø–ø—ã –º–∞—Ä—à—Ä—É—Ç–æ–≤
- `refresh_tokens` - JWT —Ç–æ–∫–µ–Ω—ã –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- `payments` - –ü–ª–∞—Ç–µ–∂–∏ –∑–∞ –∑–∞–∫–∞–∑—ã

---

## üì± –õ–û–ö–ê–õ–¨–ù–û–ï –•–†–ê–ù–ò–õ–ò–©–ï (SQLite –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏)

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
‚úÖ **–û—Ñ–ª–∞–π–Ω-–∫—ç—à** - —Ä–∞–±–æ—Ç–∞ –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞  
‚úÖ **–ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø** - –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö  
‚úÖ **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** - –æ—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä

### –§–∞–π–ª—ã –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö:

```
/data/data/com.example.time_to_travel/databases/
‚îú‚îÄ‚îÄ taxi_orders.db         - –ó–∞–∫–∞–∑—ã (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å backend)
‚îú‚îÄ‚îÄ predefined_routes.db   - –ú–∞—Ä—à—Ä—É—Ç—ã
‚îî‚îÄ‚îÄ route_groups.db        - –ì—Ä—É–ø–ø—ã –º–∞—Ä—à—Ä—É—Ç–æ–≤
```

### –°—Ö–µ–º–∞ `taxi_orders.db`:

```sql
CREATE TABLE orders (
    orderId TEXT PRIMARY KEY,
    timestamp INTEGER NOT NULL,
    fromLat REAL NOT NULL,
    fromLon REAL NOT NULL,
    toLat REAL NOT NULL,
    toLon REAL NOT NULL,
    fromAddress TEXT NOT NULL,
    toAddress TEXT NOT NULL,
    distanceKm REAL NOT NULL,
    rawPrice REAL NOT NULL,
    finalPrice REAL NOT NULL,
    baseCost REAL NOT NULL,
    costPerKm REAL NOT NULL,
    status TEXT NOT NULL,
    isSynced INTEGER NOT NULL DEFAULT 0,  -- 0 = –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ
    clientName TEXT,
    clientPhone TEXT,
    departureDate TEXT,
    departureTime TEXT,
    passengersJson TEXT,  -- JSON –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞
    baggageJson TEXT,
    petsJson TEXT,
    notes TEXT,
    vehicleClass TEXT
)
```

**–û—Ç–ª–∏—á–∏—è –æ—Ç PostgreSQL:**
- `REAL` –≤–º–µ—Å—Ç–æ `DECIMAL` (–º–µ–Ω—å—à–µ —Ç–æ—á–Ω–æ—Å—Ç—å)
- `TEXT` –≤–º–µ—Å—Ç–æ `JSONB` (–Ω–µ—Ç –Ω–∞—Ç–∏–≤–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ JSON)
- `INTEGER` –¥–ª—è timestamp (UNIX timestamp –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö)
- –ü–æ–ª–µ `isSynced` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

---

## üîÑ –ü–û–¢–û–ö –î–ê–ù–ù–´–•: –ö–õ–ò–ï–ù–¢ ‚Üí –°–ï–†–í–ï–† ‚Üí –î–ò–°–ü–ï–¢–ß–ï–†

### üéØ **–°—Ü–µ–Ω–∞—Ä–∏–π: –ö–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞—ë—Ç –∑–∞–∫–∞–∑**

#### **–®–ê–ì 1: –ö–ª–∏–µ–Ω—Ç –≤–≤–æ–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ**

**–§–∞–π–ª:** `lib/features/booking/screens/group_booking_screen.dart`

```dart
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É:
- –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–î–æ–Ω–µ—Ü–∫ ‚Üí –†–æ—Å—Ç–æ–≤)
- –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤ (–≤–∑—Ä–æ—Å–ª—ã–µ/–¥–µ—Ç–∏)
- –ë–∞–≥–∞–∂ (—Ä–∞–∑–º–µ—Ä—ã S/M/L)
- –ñ–∏–≤–æ—Ç–Ω—ã–µ (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
```

#### **–®–ê–ì 2: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏**

**–§–∞–π–ª:** `lib/services/booking_service.dart`

```dart
Future<String> createBooking(Booking booking) async {
  // 1. –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –≤ DateTime
  DateTime departureDateTime = DateTime(
    booking.departureDate.year,
    booking.departureDate.month,
    booking.departureDate.day,
    hour, minute
  );
  
  // 2. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –±–∞–≥–∞–∂ –≤ JSON —Ñ–æ—Ä–º–∞—Ç
  List<Map<String, dynamic>>? baggageList = booking.baggage.map((b) => {
    'size': b.size.toString().split('.').last,  // BaggageSize.m ‚Üí "m"
    'quantity': b.quantity,
    'pricePerExtraItem': b.pricePerExtraItem,
  }).toList();
  
  // 3. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤
  List<Map<String, dynamic>>? passengersList = booking.passengers.map((p) => {
    'type': p.type.toString().split('.').last,  // PassengerType.adult ‚Üí "adult"
  }).toList();
  
  // 4. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –∂–∏–≤–æ—Ç–Ω—ã—Ö
  List<Map<String, dynamic>>? petsList = booking.pets.map((p) => {
    'category': p.category.toString().split('.').last,
    'breed': p.breed,
    'cost': p.cost,
  }).toList();
  
  // 5. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ backend
  final createdOrder = await _ordersApi.createOrder(
    fromAddress: booking.pickupAddress ?? '–ù–µ —É–∫–∞–∑–∞–Ω',
    toAddress: booking.dropoffAddress ?? '–ù–µ —É–∫–∞–∑–∞–Ω',
    departureTime: departureDateTime,
    passengerCount: booking.passengerCount,
    basePrice: booking.basePrice,
    totalPrice: booking.totalPrice,
    tripType: 'group',  // ‚úÖ –¢–∏–ø –ø–æ–µ–∑–¥–∫–∏
    direction: 'donetskToRostov',  // ‚úÖ –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
    passengers: passengersList,
    baggage: baggageList,
    pets: petsList,
  );
}
```

#### **–®–ê–ì 3: HTTP –∑–∞–ø—Ä–æ—Å –∫ API**

**–§–∞–π–ª:** `lib/services/api/orders_api_service.dart`

```dart
Future<ApiOrder> createOrder({...}) async {
  final response = await _apiClient.post(
    ApiConfig.ordersEndpoint,  // '/api/orders'
    body: {
      'fromAddress': fromAddress,
      'toAddress': toAddress,
      'departureTime': departureTime.toIso8601String(),  // "2026-01-26T14:30:00.000Z"
      'passengerCount': passengerCount,
      'basePrice': basePrice,
      'totalPrice': totalPrice,
      'finalPrice': totalPrice,
      'tripType': tripType,
      'direction': direction,
      'passengers': passengers,  // [{"type":"adult"}]
      'baggage': baggage,        // [{"size":"m","quantity":2}]
      'pets': pets,              // [{"category":"upTo5kg"}]
    },
    requiresAuth: false,  // –ó–∞–∫–∞–∑—ã –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ë–ï–ó –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  );
  
  return ApiOrder.fromJson(response);
}
```

**–ü—Ä–∏–º–µ—Ä JSON —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "fromAddress": "–î–æ–Ω–µ—Ü–∫, —É–ª. –ê—Ä—Ç—ë–º–∞, 1",
  "toAddress": "–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É, –≤–æ–∫–∑–∞–ª",
  "departureTime": "2026-01-28T10:00:00.000Z",
  "passengerCount": 2,
  "basePrice": 1500.0,
  "totalPrice": 1700.0,
  "finalPrice": 1700.0,
  "tripType": "group",
  "direction": "donetskToRostov",
  "passengers": [
    {"type": "adult"},
    {"type": "child", "seatType": "booster", "ageMonths": 48}
  ],
  "baggage": [
    {"size": "m", "quantity": 2, "pricePerExtraItem": 100.0}
  ],
  "pets": []
}
```

#### **–®–ê–ì 4: Backend –æ–±—Ä–∞–±–æ—Ç–∫–∞ (Dart Frog)**

**–§–∞–π–ª:** `backend/backend/routes/orders/index.dart`

```dart
Future<Response> _createOrder(RequestContext context) async {
  // 1. –ü–∞—Ä—Å–∏–º JSON —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞
  final json = await context.request.json() as Map<String, dynamic>;
  final dto = CreateOrderDto.fromJson(json);  // ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è
  
  // 2. –í–∞–ª–∏–¥–∞—Ü–∏—è
  if (dto.fromAddress.isEmpty || dto.toAddress.isEmpty) {
    return Response.json(
      statusCode: 400,
      body: {'error': 'Addresses are required'},
    );
  }
  
  // 3. –°–æ–∑–¥–∞—ë–º –∑–∞–∫–∞–∑ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
  final order = await orderRepo.create(dto, userId: userId);
  
  // 4. –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–æ–∑–¥–∞–Ω–Ω—ã–π –∑–∞–∫–∞–∑
  return Response.json(
    statusCode: 201,
    body: {'order': order.toJson()},
  );
}
```

#### **–®–ê–ì 5: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ PostgreSQL**

**–§–∞–π–ª:** `backend/backend/lib/repositories/order_repository.dart`

```dart
Future<Order> create(CreateOrderDto dto, {String? userId}) async {
  // 1. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π orderId
  final orderId = 'ORDER-${now.year}-${now.month}-${now.millisecondsSinceEpoch % 1000}';
  
  // 2. –ü–∞—Ä—Å–∏–º –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è
  DateTime? parsedDateTime;
  if (dto.departureTime != null) {
    parsedDateTime = DateTime.parse(dto.departureTime!);
    dbDate = '2026-01-28';
    dbTime = '10:00:00';
  }
  
  // 3. INSERT –≤ PostgreSQL
  await db.insert(
    '''
    INSERT INTO orders (
      order_id, user_id,
      from_lat, from_lon, to_lat, to_lon,
      from_address, to_address,
      distance_km, raw_price, final_price, base_cost, cost_per_km,
      status,
      client_name, client_phone,
      departure_date, departure_time,
      passengers, baggage, pets,  -- JSONB –∫–æ–ª–æ–Ω–∫–∏!
      notes, vehicle_class,
      trip_type, direction
    ) VALUES (
      @orderId, @userId,
      @fromLat, @fromLon, @toLat, @toLon,
      @fromAddress, @toAddress,
      @distanceKm, @rawPrice, @finalPrice, @baseCost, @costPerKm,
      'pending',
      @clientName, @clientPhone,
      @departureDate, @departureTime,
      @passengers, @baggage, @pets,
      @notes, @vehicleClass,
      @tripType, @direction
    )
    ''',
    parameters: {
      'orderId': orderId,
      'fromAddress': dto.fromAddress,
      'toAddress': dto.toAddress,
      'departureDate': dbDate,  // '2026-01-28'
      'departureTime': dbTime,  // '10:00:00'
      'passengers': jsonEncode(dto.passengers!.map((p) => p.toJson()).toList()),  // JSON string
      'baggage': jsonEncode(dto.baggage!.map((b) => b.toJson()).toList()),
      'pets': jsonEncode(dto.pets!.map((p) => p.toJson()).toList()),
      'tripType': dto.tripType,    // 'group'
      'direction': dto.direction,  // 'donetskToRostov'
      // ...
    },
  );
  
  return order;
}
```

**–ò—Ç–æ–≥–æ–≤–∞—è –∑–∞–ø–∏—Å—å –≤ PostgreSQL:**
```sql
id: "550e8400-e29b-41d4-a716-446655440000"
order_id: "ORDER-2026-01-797"
user_id: NULL (–∞–Ω–æ–Ω–∏–º–Ω—ã–π –∑–∞–∫–∞–∑)
from_address: "–î–æ–Ω–µ—Ü–∫, —É–ª. –ê—Ä—Ç—ë–º–∞, 1"
to_address: "–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É, –≤–æ–∫–∑–∞–ª"
departure_date: 2026-01-28
departure_time: 10:00:00
passengers: [{"type":"adult"},{"type":"child","seatType":"booster","ageMonths":48}]
baggage: [{"size":"m","quantity":2,"pricePerExtraItem":100.0}]
pets: []
status: "pending"
trip_type: "group"
direction: "donetskToRostov"
created_at: 2026-01-26 12:34:56+00
```

#### **–®–ê–ì 6: –î–∏—Å–ø–µ—Ç—á–µ—Ä –≤–∏–¥–∏—Ç –∑–∞–∫–∞–∑**

**–§–∞–π–ª:** `lib/features/orders/screens/orders_screen.dart`

```dart
// –î–∏—Å–ø–µ—Ç—á–µ—Ä –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ä–∞–∑–¥–µ–ª "–ó–∞–∫–∞–∑—ã"
Future<void> _loadData() async {
  // 1. –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–∫–∞–∑—ã —Å backend API
  final response = await _ordersApi.getOrders(
    status: _filterStatus,  // pending, confirmed, completed
    limit: 100,
  );
  
  // 2. Backend –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –í–°–ï –∑–∞–∫–∞–∑—ã –¥–ª—è –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞
  setState(() {
    _bookings = response.orders.map((apiOrder) => Booking.fromApiOrder(apiOrder)).toList();
  });
}
```

**Backend –ª–æ–≥–∏–∫–∞ –¥–ª—è –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞:**

```dart
// backend/backend/routes/orders/index.dart

Future<Response> _getOrders(RequestContext context) async {
  // –ü–æ–ª—É—á–∞–µ–º —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ JWT —Ç–æ–∫–µ–Ω–∞
  String? userRole;
  if (authHeader != null) {
    final payload = jwtHelper.verifyToken(token);
    userRole = payload?['role'] as String?;
  }
  
  List<Order> orders;
  
  // ‚úÖ –î–ò–°–ü–ï–¢–ß–ï–†–´ –ò –ê–î–ú–ò–ù–´ - –≤–∏–¥—è—Ç –í–°–ï –∑–∞–∫–∞–∑—ã
  if (userRole == 'dispatcher' || userRole == 'admin') {
    orders = await orderRepo.findAll(limit: limit);
  }
  // –û–±—ã—á–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ - —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∑–∞–∫–∞–∑—ã
  else if (userId != null) {
    orders = await orderRepo.findByUserId(userId, limit: limit);
  }
  // ‚úÖ –ù–ï –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ - –í–°–ï –∑–∞–∫–∞–∑—ã (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
  else {
    orders = await orderRepo.findAll(limit: limit);
  }
  
  return Response.json(body: {'orders': orders});
}
```

---

## ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–´ –ò –ü–û–¢–ï–ù–¶–ò–ê–õ–¨–ù–´–ï –û–®–ò–ë–ö–ò

### üî¥ **–ü–†–û–ë–õ–ï–ú–ê 1: –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ë–î**

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- –í —Ç–∞–±–ª–∏—Ü–µ `users` –ù–ï–¢ –ø–æ–ª—è `role`
- –†–æ–ª–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ (SharedPreferences)
- Backend –ù–ï –º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –õ—é–±–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø—Ä–∏—Ç–≤–æ—Ä–∏—Ç—å—Å—è –¥–∏—Å–ø–µ—Ç—á–µ—Ä–æ–º, –∏–∑–º–µ–Ω–∏–≤ –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- Backend –ø–æ–ª–∞–≥–∞–µ—Ç—Å—è –Ω–∞ `role` –∏–∑ JWT —Ç–æ–∫–µ–Ω–∞, –Ω–æ –Ω–µ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –µ–≥–æ —á–µ—Ä–µ–∑ –ë–î

**–†–µ—à–µ–Ω–∏–µ:**
```sql
ALTER TABLE users ADD COLUMN role VARCHAR(50) DEFAULT 'client';
-- –í–æ–∑–º–æ–∂–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: 'client', 'dispatcher', 'admin'

UPDATE users SET role = 'admin' WHERE email = 'admin@titotr.ru';
UPDATE users SET role = 'dispatcher' WHERE email = 'driver@titotr.ru';
```

### üî¥ **–ü–†–û–ë–õ–ï–ú–ê 2: –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö SQLite ‚Üî PostgreSQL**

| –ü–æ–ª–µ | SQLite | PostgreSQL | –ü—Ä–æ–±–ª–µ–º–∞ |
|------|--------|-----------|----------|
| `passengers` | TEXT (JSON string) | JSONB | ‚ùå –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç JSON, –Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã |
| `distanceKm` | REAL | DECIMAL(10,2) | ‚ö†Ô∏è –ü–æ—Ç–µ—Ä—è —Ç–æ—á–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ |
| `timestamp` | INTEGER (milliseconds) | TIMESTAMP WITH TIME ZONE | ‚ö†Ô∏è –†–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –≤—Ä–µ–º–µ–Ω–∏ |

**–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–±–ª–µ–º—ã:**

Flutter –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç:
```json
"passengers": [{"type": "adult"}]
```

PostgreSQL –æ–∂–∏–¥–∞–µ—Ç:
```json
"passengers": [{"name": "–ò–≤–∞–Ω", "age": 30, "type": "adult"}]
```

–ï—Å–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç ‚Üí –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ –≤ –¥–∏—Å–ø–µ—Ç—á–µ—Ä—Å–∫–æ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ.

### üî¥ **–ü–†–û–ë–õ–ï–ú–ê 3: –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –º–æ–≥—É—Ç –±—ã—Ç—å NULL**

**–§–∞–π–ª:** `backend/backend/lib/models/order.dart`

```dart
class CreateOrderDto {
  final double? fromLat;  // NULLABLE!
  final double? fromLon;
  final double? toLat;
  final double? toLon;
  // ...
}
```

**PostgreSQL —Å—Ö–µ–º–∞:**
```sql
from_lat DECIMAL(10, 7) NOT NULL,  -- –ù–ï NULL!
from_lon DECIMAL(10, 7) NOT NULL,
```

‚ùå **–ö–æ–Ω—Ñ–ª–∏–∫—Ç:** Backend –ø—Ä–∏–Ω–∏–º–∞–µ—Ç NULL –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã, –Ω–æ PostgreSQL —Ç—Ä–µ–±—É–µ—Ç NOT NULL.

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–∫–∞–∑ –ë–ï–ó –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç (—Ç–æ–ª—å–∫–æ –∞–¥—Ä–µ—Å–∞)
2. Backend –ø—ã—Ç–∞–µ—Ç—Å—è –≤—Å—Ç–∞–≤–∏—Ç—å NULL –≤ `from_lat`
3. PostgreSQL –≤—ã–¥–∞—ë—Ç –æ—à–∏–±–∫—É: `null value in column "from_lat" violates not-null constraint`

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–∏—Ç—å –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–¥—Ä–µ—Å–æ–≤ –Ω–∞ backend (Yandex Geocoder API)
- –ò–ª–∏ —Å–¥–µ–ª–∞—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã nullable –≤ PostgreSQL
- –ò–ª–∏ —Ç—Ä–µ–±–æ–≤–∞—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞

### üî¥ **–ü–†–û–ë–õ–ï–ú–ê 4: –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö**

**–û—Ç –∫–ª–∏–µ–Ω—Ç–∞:**
```json
"departureTime": "2026-01-28T10:00:00.000Z"  // ISO 8601 DateTime
```

**–í PostgreSQL:**
```sql
departure_date DATE,      -- 2026-01-28
departure_time TIME,      -- 10:00:00
```

**Backend –ø–∞—Ä—Å–∏–Ω–≥:**
```dart
DateTime? parsedDateTime = DateTime.parse(dto.departureTime!);
dbDate = '${parsedDateTime.year}-${parsedDateTime.month}-${parsedDateTime.day}';
dbTime = '${parsedDateTime.hour}:${parsedDateTime.minute}:${parsedDateTime.second}';
```

‚ö†Ô∏è **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** –ß–∞—Å–æ–≤—ã–µ –ø–æ—è—Å–∞!
- –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç UTC –≤—Ä–µ–º—è
- PostgreSQL —Ö—Ä–∞–Ω–∏—Ç –±–µ–∑ time zone
- –î–∏—Å–ø–µ—Ç—á–µ—Ä –≤–∏–¥–∏—Ç –≤—Ä–µ–º—è –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —á–∞—Å–æ–≤–æ–º –ø–æ—è—Å–µ ‚Üí —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ

### üî¥ **–ü–†–û–ë–õ–ï–ú–ê 5: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (SQLite + PostgreSQL)**

**–°—Ü–µ–Ω–∞—Ä–∏–π:**
1. –ö–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞—ë—Ç –∑–∞–∫–∞–∑ ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ SQLite –ª–æ–∫–∞–ª—å–Ω–æ
2. –ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ backend ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ PostgreSQL
3. –î–∏—Å–ø–µ—Ç—á–µ—Ä –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å ‚Üí –º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ PostgreSQL
4. –ö–ª–∏–µ–Ω—Ç –≤–∏–¥–∏—Ç –°–¢–ê–†–´–ô —Å—Ç–∞—Ç—É—Å –∏–∑ SQLite!

**–†–µ—à–µ–Ω–∏–µ:**
- –í—Å–µ–≥–¥–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å SQLite ‚Üî PostgreSQL –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ò–ª–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–±—Ä–∞—Ç—å SQLite, —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å API

---

## üë• –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò –í –ë–ê–ó–ï –î–ê–ù–ù–´–•

### –ö–∞–∫ –Ω–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ PostgreSQL:

```sql
-- –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
docker exec -it postgres psql -U postgres -d timetotravel

-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
SELECT id, email, name, phone, is_verified, is_active, created_at 
FROM users;

-- –†–µ–∑—É–ª—å—Ç–∞—Ç:
+--------------------------------------+--------------------+------------------+-------------+-------------+-----------+---------------------+
| id                                   | email              | name             | phone       | verified    | active    | created_at          |
+--------------------------------------+--------------------+------------------+-------------+-------------+-----------+---------------------+
| 00000000-0000-0000-0000-000000000001 | admin@titotr.ru    | –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä    | +79001234567| TRUE        | TRUE      | 2026-01-21 12:00:00 |
| 00000000-0000-0000-0000-000000000002 | driver@titotr.ru   | –í–æ–¥–∏—Ç–µ–ª—å –ò–≤–∞–Ω    | +79007654321| TRUE        | TRUE      | 2026-01-21 12:00:00 |
| 00000000-0000-0000-0000-000000000003 | client@example.com | –¢–µ—Å—Ç–æ–≤—ã–π –ö–ª–∏–µ–Ω—Ç  | +79009998877| TRUE        | TRUE      | 2026-01-21 12:00:00 |
+--------------------------------------+--------------------+------------------+-------------+-------------+-----------+---------------------+
```

### –ö–∞–∫ –Ω–∞–π—Ç–∏ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞ –ï–≤–≥–µ–Ω–∏—è:

```sql
-- –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏
SELECT * FROM users WHERE name LIKE '%–ï–≤–≥–µ–Ω–∏–π%';

-- –ü–æ–∏—Å–∫ –ø–æ email
SELECT * FROM users WHERE email LIKE '%–µ–≤–≥–µ–Ω–∏–π%' OR email LIKE '%evgeny%';

-- –ï—Å–ª–∏ –µ—Å—Ç—å –ø–æ–ª–µ role (–ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏)
SELECT * FROM users WHERE role = 'dispatcher';
```

‚ùóÔ∏è **–í–ê–ñ–ù–û:** –°–µ–π—á–∞—Å –≤ –±–∞–∑–µ –ù–ï–¢ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è "–ï–≤–≥–µ–Ω–∏–π"!
- –ù—É–∂–Ω–æ –ª–∏–±–æ —Å–æ–∑–¥–∞—Ç—å –µ–≥–æ —á–µ—Ä–µ–∑ API —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- –ò–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ SQL
- –ò–ª–∏ –æ–Ω —É–∂–µ –µ—Å—Ç—å, –Ω–æ –ø–æ–¥ –¥—Ä—É–≥–∏–º –∏–º–µ–Ω–µ–º

---

## üíæ –ì–î–ï –•–†–ê–ù–Ø–¢–°–Ø –î–ê–ù–ù–´–ï?

### ‚úÖ **–ó–∞–∫–∞–∑—ã:**
- **–õ–æ–∫–∞–ª—å–Ω–æ (SQLite):** `/data/data/com.example.time_to_travel/databases/taxi_orders.db`
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –ö–≠–®–ê –¥–ª—è –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–∞
  - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å backend –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
  
- **–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ (PostgreSQL):** `Selectel ‚Üí Docker ‚Üí PostgreSQL ‚Üí orders`
  - –ì–ª–∞–≤–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
  - –í—Å–µ –∑–∞–∫–∞–∑—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –°–†–ê–ó–£ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç)
  - –î–∏—Å–ø–µ—Ç—á–µ—Ä –≤–∏–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ –æ—Ç—Å—é–¥–∞

### ‚úÖ **–ú–∞—Ä—à—Ä—É—Ç—ã:**
- **–õ–æ–∫–∞–ª—å–Ω–æ (SQLite):** `predefined_routes.db`, `route_groups.db`
- **–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ (PostgreSQL):** `predefined_routes`, `route_groups`

### ‚úÖ **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:**
- **–¢–û–õ–¨–ö–û –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (PostgreSQL):** `users`
- –õ–æ–∫–∞–ª—å–Ω–æ —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ JWT —Ç–æ–∫–µ–Ω—ã

---

## üîß –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Æ

### 1Ô∏è‚É£ **–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `role` –≤ —Ç–∞–±–ª–∏—Ü—É `users`**

```sql
ALTER TABLE users ADD COLUMN role VARCHAR(50) DEFAULT 'client';
UPDATE users SET role = 'admin' WHERE email = 'admin@titotr.ru';
UPDATE users SET role = 'dispatcher' WHERE email IN ('driver@titotr.ru', '–µ–≤–≥–µ–Ω–∏–π@titotr.ru');
```

### 2Ô∏è‚É£ **–°–¥–µ–ª–∞—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã NULLABLE –≤ PostgreSQL**

```sql
ALTER TABLE orders ALTER COLUMN from_lat DROP NOT NULL;
ALTER TABLE orders ALTER COLUMN from_lon DROP NOT NULL;
ALTER TABLE orders ALTER COLUMN to_lat DROP NOT NULL;
ALTER TABLE orders ALTER COLUMN to_lon DROP NOT NULL;
```

–ò–õ–ò –¥–æ–±–∞–≤–∏—Ç—å –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ backend.

### 3Ô∏è‚É£ **–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è `trip_type` –∏ `direction` –≤ –ë–î**

```sql
ALTER TABLE orders ADD COLUMN trip_type VARCHAR(50);
ALTER TABLE orders ADD COLUMN direction VARCHAR(50);
```

‚úÖ **–£–ñ–ï –î–û–ë–ê–í–õ–ï–ù–û** –≤ —Ç–µ–∫—É—â–µ–π —Å—Ö–µ–º–µ!

### 4Ô∏è‚É£ **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è SQLite ‚Üî PostgreSQL**

**–§–∞–π–ª:** `lib/services/orders_sync_service.dart`

```dart
// –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞ –Ω–∞ backend:
// 1. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ SQLite —Å isSynced = 1
await OfflineOrdersService.instance.saveOrder(order.copyWith(isSynced: true));

// –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–æ–º:
// 2. –û–±–Ω–æ–≤–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π SQLite
await OfflineOrdersService.instance.updateOrderStatus(orderId, newStatus);
```

### 5Ô∏è‚É£ **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–∏—Ö –∑–∞–∫–∞–∑–æ–≤ –≤ PostgreSQL**

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ PostgreSQL
docker exec -it postgres psql -U postgres -d timetotravel

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –∑–∞–∫–∞–∑—ã
SELECT order_id, from_address, to_address, status, client_name, client_phone, created_at 
FROM orders 
ORDER BY created_at DESC;

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å pending –∑–∞–∫–∞–∑—ã (–¥–ª—è –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞)
SELECT * FROM orders WHERE status = 'pending';
```

---

## üéØ –ò–¢–û–ì–û–í–´–ï –í–´–í–û–î–´

### ‚úÖ **–ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ü–†–ê–í–ò–õ–¨–ù–û:**

1. ‚úÖ –ó–∞–∫–∞–∑—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ PostgreSQL –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ Selectel
2. ‚úÖ Backend API –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–∫–∞–∑—ã —á–µ—Ä–µ–∑ HTTPS (titotr.ru)
3. ‚úÖ –î–∏—Å–ø–µ—Ç—á–µ—Ä –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å –≤—Å–µ –∑–∞–∫–∞–∑—ã —á–µ—Ä–µ–∑ API
4. ‚úÖ JSONB –ø–æ–ª—è –¥–ª—è –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤/–±–∞–≥–∞–∂–∞/–∂–∏–≤–æ—Ç–Ω—ã—Ö
5. ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–µ–π (client/dispatcher)

### ‚ùå **–ß—Ç–æ –Ω—É–∂–Ω–æ –ò–°–ü–†–ê–í–ò–¢–¨:**

1. ‚ùå –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `role` –≤ —Ç–∞–±–ª–∏—Ü—É `users`
2. ‚ùå –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (NULL vs NOT NULL)
3. ‚ùå –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —á–∞—Å–æ–≤—ã–µ –ø–æ—è—Å–∞ –¥–ª—è –¥–∞—Ç
4. ‚ùå –£–ª—É—á—à–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é SQLite ‚Üî PostgreSQL
5. ‚ùå –ù–∞–π—Ç–∏ –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è "–ï–≤–≥–µ–Ω–∏–π" –≤ –±–∞–∑–µ

### üîç **–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã:**

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –∑–∞–∫–∞–∑—ã –≤ PostgreSQL** (–µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ?)
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ backend** –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å JWT —Ç–æ–∫–µ–Ω—ã** –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞ (–µ—Å—Ç—å –ª–∏ `role` –≤ payload?)
4. **–î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ
5. **–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑** –∏ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –ø—É—Ç—å –¥–∞–Ω–Ω—ã—Ö

---

**–ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ:** GitHub Copilot  
**–î–∞—Ç–∞:** 26 —è–Ω–≤–∞—Ä—è 2026  
**–í–µ—Ä—Å–∏—è:** 1.0
