# –†–µ—à–µ–Ω–∏–µ: –ì–µ–æ–ª–æ–∫–∞—Ü–∏–æ–Ω–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–ª—è Yandex MapKit (—Å–∞–¥–∂–µ—Å—Ç—ã + –ø–æ–∏—Å–∫)

## –ü—Ä–æ–±–ª–µ–º–∞
1. **–°–∞–¥–∂–µ—Å—Ç—ã**: –ü—Ä–∏ –≤–≤–æ–¥–µ –∞–¥—Ä–µ—Å–∞ –±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è –≥–æ—Ä–æ–¥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–õ–µ–Ω–∏–Ω–∞ 33") –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏ –∞–¥—Ä–µ—Å–∞ –∏–∑ –ª—é–±–æ–≥–æ –≥–æ—Ä–æ–¥–∞ –†–æ—Å—Å–∏–∏ –≤ —Å–ª—É—á–∞–π–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
2. **–§–∏–Ω–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫**: –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –∞–¥—Ä–µ—Å–∞ –∏–∑ –ø–æ–¥—Å–∫–∞–∑–æ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ú–æ—Å–∫–≤–∞, –ö—É—Ç—É–∑–æ–≤—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç 43") –∫–∞—Ä—Ç–∞ –Ω–µ –ø–µ—Ä–µ–º–µ—â–∞–ª–∞—Å—å –≤ –Ω—É–∂–Ω–æ–µ –º–µ—Å—Ç–æ, —Ç.–∫. –ø–æ–∏—Å–∫ –±—ã–ª –æ–≥—Ä–∞–Ω–∏—á–µ–Ω —Ç–µ–∫—É—â–µ–π –≤–∏–¥–∏–º–æ–π –æ–±–ª–∞—Å—Ç—å—é

## –†–µ—à–µ–Ω–∏–µ
–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —É–º–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ BoundingBox/Geometry –¥–ª—è **–¥–≤—É—Ö —Ç–∏–ø–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤**:
- **Suggest API** (–ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø—Ä–∏ –Ω–∞–±–æ—Ä–µ) ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç BoundingBox
- **Search API** (—Ñ–∏–Ω–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ –∞–¥—Ä–µ—Å–∞) ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Geometry (–ø–æ–ª–∏–≥–æ–Ω)

### –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:
- **–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∫–∞–∑–∞–ª –≥–æ—Ä–æ–¥** ‚Üí —à–∏—Ä–æ–∫–∞—è –æ–±–ª–∞—Å—Ç—å –ø–æ–∏—Å–∫–∞ (–≤—Å—è –†–æ—Å—Å–∏—è)
- **–ï—Å–ª–∏ –≥–æ—Ä–æ–¥ –ù–ï —É–∫–∞–∑–∞–Ω –ò –µ—Å—Ç—å GPS** ‚Üí –ª–æ–∫–∞–ª—å–Ω–∞—è –æ–±–ª–∞—Å—Ç—å (~22–∫–º –≤–æ–∫—Ä—É–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- **Fallback** ‚Üí –≤–∏–¥–∏–º–∞—è –æ–±–ª–∞—Å—Ç—å –∫–∞—Ä—Ç—ã

---

## –ö–æ–¥ —Ä–µ—à–µ–Ω–∏—è

### 1. MapSearchManager - –ª–æ–≥–∏–∫–∞ –¥–ª—è —Å–∞–¥–∂–µ—Å—Ç–æ–≤ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)

```dart
// lib/features/search/managers/map_search_manager.dart

void _submitSuggest(
  String query,
  BoundingBox box, [
  SuggestOptions? options,
]) {
  BoundingBox effectiveBox;
  
  // üéØ –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —É–∫–∞–∑–∞–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≥–æ—Ä–æ–¥ –≤ –∑–∞–ø—Ä–æ—Å–µ
  final hasExplicitCity = _queryContainsCity(query);
  
  if (hasExplicitCity) {
    // –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –≥–æ—Ä–æ–¥ ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ–º —à–∏—Ä–æ–∫–∏–π bbox (–≤—Å—è –†–æ—Å—Å–∏—è)
    effectiveBox = BoundingBox(
      const Point(latitude: 41.0, longitude: 19.0),  // –Æ–≥–æ-–∑–∞–ø–∞–¥ –†–æ—Å—Å–∏–∏
      const Point(latitude: 82.0, longitude: 180.0), // –°–µ–≤–µ—Ä–æ-–≤–æ—Å—Ç–æ–∫ –†–æ—Å—Å–∏–∏
    );
    print('üåê Query contains city name ‚Üí using wide BoundingBox (all Russia)');
  } else if (_userPosition != null) {
    // –ï—Å–ª–∏ –ù–ï–¢ –≥–æ—Ä–æ–¥–∞ –≤ –∑–∞–ø—Ä–æ—Å–µ –ò –µ—Å—Ç—å GPS ‚Üí –º–∞–ª–µ–Ω—å–∫–∏–π bbox –≤–æ–∫—Ä—É–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const latDelta = 0.2;
    const lonDelta = 0.2;
    effectiveBox = BoundingBox(
      Point(
        latitude: _userPosition!.latitude - latDelta,
        longitude: _userPosition!.longitude - lonDelta,
      ),
      Point(
        latitude: _userPosition!.latitude + latDelta,
        longitude: _userPosition!.longitude + lonDelta,
      ),
    );
    print('üìç No city in query ‚Üí using local BoundingBox around user');
  } else {
    // Fallback: –∏—Å–ø–æ–ª—å–∑—É–µ–º bbox –≤–∏–¥–∏–º–æ–π –æ–±–ª–∞—Å—Ç–∏ –∫–∞—Ä—Ç—ã
    effectiveBox = box;
    print('üó∫Ô∏è Using visible region BoundingBox (no city, no GPS)');
  }
  
  _suggestSession.suggest(
    effectiveBox,
    options ?? defaultSuggestOptions,
    _suggestSessionListener,
    text: query,
  );
}
```

### 2. MapSearchManager - –ù–û–í–ê–Ø –ª–æ–≥–∏–∫–∞ –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞

```dart
// lib/features/search/managers/map_search_manager.dart

void startSearch([String? query]) {
  final searchQuery = query ?? _searchQuery.value;
  print('üöÄ startSearch with query: "$searchQuery"');
  final region = _visibleRegion.value;
  if (region == null) {
    print('‚ùå No visible region available');
    return;
  }

  // üéØ –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ–±–ª–∞—Å—Ç—å –ø–æ–∏—Å–∫–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ª–∏—á–∏—è –≥–æ—Ä–æ–¥–∞ –≤ –∑–∞–ø—Ä–æ—Å–µ
  Geometry searchGeometry;
  final hasExplicitCity = _queryContainsCity(searchQuery);
  
  if (hasExplicitCity) {
    // –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω –≥–æ—Ä–æ–¥ ‚Üí —Å–æ–∑–¥–∞—ë–º –±–æ–ª—å—à–æ–π –ø–æ–ª–∏–≥–æ–Ω –¥–ª—è –≤—Å–µ–π –†–æ—Å—Å–∏–∏
    final russiaPolygon = Polygon(
      LinearRing([
        const Point(latitude: 41.0, longitude: 19.0),   // –Æ–≥–æ-–∑–∞–ø–∞–¥
        const Point(latitude: 41.0, longitude: 180.0),  // –Æ–≥–æ-–≤–æ—Å—Ç–æ–∫
        const Point(latitude: 82.0, longitude: 180.0),  // –°–µ–≤–µ—Ä–æ-–≤–æ—Å—Ç–æ–∫
        const Point(latitude: 82.0, longitude: 19.0),   // –°–µ–≤–µ—Ä–æ-–∑–∞–ø–∞–¥
        const Point(latitude: 41.0, longitude: 19.0),   // –ó–∞–º—ã–∫–∞–µ–º –ø–æ–ª–∏–≥–æ–Ω
      ]),
      [],
    );
    searchGeometry = Geometry.fromPolygon(russiaPolygon);
    print('üåê Query contains city "$searchQuery" ‚Üí using wide search area (all Russia)');
  } else if (_userPosition != null) {
    // –ï—Å–ª–∏ –ù–ï–¢ –≥–æ—Ä–æ–¥–∞ –ò –µ—Å—Ç—å GPS ‚Üí –º–∞–ª–µ–Ω—å–∫–∏–π –ø–æ–ª–∏–≥–æ–Ω –≤–æ–∫—Ä—É–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const delta = 0.2;
    final localPolygon = Polygon(
      LinearRing([
        Point(latitude: _userPosition!.latitude - delta, longitude: _userPosition!.longitude - delta),
        Point(latitude: _userPosition!.latitude - delta, longitude: _userPosition!.longitude + delta),
        Point(latitude: _userPosition!.latitude + delta, longitude: _userPosition!.longitude + delta),
        Point(latitude: _userPosition!.latitude + delta, longitude: _userPosition!.longitude - delta),
        Point(latitude: _userPosition!.latitude - delta, longitude: _userPosition!.longitude - delta),
      ]),
      [],
    );
    searchGeometry = Geometry.fromPolygon(localPolygon);
    print('üìç No city in query ‚Üí using local search area around user position');
    print('   User position: (${_userPosition!.latitude}, ${_userPosition!.longitude})');
  } else {
    // Fallback: –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤–∏–¥–∏–º—É—é –æ–±–ª–∞—Å—Ç—å –∫–∞—Ä—Ç—ã
    searchGeometry = VisibleRegionUtils.toPolygon(region);
    print('üó∫Ô∏è Using visible region for search (no city, no GPS)');
  }

  _submitSearch(searchQuery, searchGeometry);
}
```

### 3. –ú–µ—Ç–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è –≥–æ—Ä–æ–¥–∞ (_queryContainsCity)

```dart
/// –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞
/// –°–ø–∏—Å–æ–∫ –∏–∑ 60+ –∫—Ä—É–ø–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ –†–æ—Å—Å–∏–∏
bool _queryContainsCity(String query) {
  final lowerQuery = query.toLowerCase();
  
  // –°–ø–∏—Å–æ–∫ –∫—Ä—É–ø–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ –†–æ—Å—Å–∏–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
  const cities = [
    '–º–æ—Å–∫–≤–∞', '—Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥', '–ø–∏—Ç–µ—Ä', '–µ–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥', '–µ–∫–±',
    '–Ω–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫', '–∫–∞–∑–∞–Ω—å', '–Ω–∏–∂–Ω–∏–π –Ω–æ–≤–≥–æ—Ä–æ–¥', '—á–µ–ª—è–±–∏–Ω—Å–∫',
    '—Å–∞–º–∞—Ä–∞', '–æ–º—Å–∫', '—Ä–æ—Å—Ç–æ–≤-–Ω–∞-–¥–æ–Ω—É', '—Ä–æ—Å—Ç–æ–≤', '—É—Ñ–∞', '–∫—Ä–∞—Å–Ω–æ—è—Ä—Å–∫',
    '–≤–æ—Ä–æ–Ω–µ–∂', '–ø–µ—Ä–º—å', '–≤–æ–ª–≥–æ–≥—Ä–∞–¥', '–∫—Ä–∞—Å–Ω–æ–¥–∞—Ä', '—Å–∞—Ä–∞—Ç–æ–≤',
    '—Ç—é–º–µ–Ω—å', '—Ç–æ–ª—å—è—Ç—Ç–∏', '–∏–∂–µ–≤—Å–∫', '–±–∞—Ä–Ω–∞—É–ª', '—É–ª—å—è–Ω–æ–≤—Å–∫',
    '–∏—Ä–∫—É—Ç—Å–∫', '—Ö–∞–±–∞—Ä–æ–≤—Å–∫', '—è—Ä–æ—Å–ª–∞–≤–ª—å', '–≤–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫', '–º–∞—Ö–∞—á–∫–∞–ª–∞',
    '—Ç–æ–º—Å–∫', '–æ—Ä–µ–Ω–±—É—Ä–≥', '–∫–µ–º–µ—Ä–æ–≤–æ', '–Ω–æ–≤–æ–∫—É–∑–Ω–µ—Ü–∫', '—Ä—è–∑–∞–Ω—å',
    '–Ω–∞–±–µ—Ä–µ–∂–Ω—ã–µ —á–µ–ª–Ω—ã', '–∞—Å—Ç—Ä–∞—Ö–∞–Ω—å', '–ø–µ–Ω–∑–∞', '–ª–∏–ø–µ—Ü–∫', '–∫–∏—Ä–æ–≤',
    '—á–µ–±–æ–∫—Å–∞—Ä—ã', '–∫–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥', '—Ç—É–ª–∞', '–∫—É—Ä—Å–∫', '—Å–æ—á–∏',
    '—Å—Ç–∞–≤—Ä–æ–ø–æ–ª—å', '—É–ª–∞–Ω-—É–¥—ç', '–º–∞–≥–Ω–∏—Ç–æ–≥–æ—Ä—Å–∫', '–∏–≤–∞–Ω–æ–≤–æ', '–±—Ä—è–Ω—Å–∫',
    '–±–µ–ª–≥–æ—Ä–æ–¥', '—Å—É—Ä–≥—É—Ç', '–≤–ª–∞–¥–∏–º–∏—Ä', '–∞—Ä—Ö–∞–Ω–≥–µ–ª—å—Å–∫', '—á–∏—Ç–∞',
    '–Ω–∏–∂–Ω–∏–π —Ç–∞–≥–∏–ª', '–∫–∞–ª—É–≥–∞', '—Å–º–æ–ª–µ–Ω—Å–∫', '–≤–æ–ª–∂—Å–∫–∏–π', '–∫—É—Ä–≥–∞–Ω'
  ];
  
  return cities.any((city) => lowerQuery.contains(city));
}
```

### 4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ GPS-–ø–æ–∑–∏—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```dart
// lib/features/search/managers/map_search_manager.dart

class MapSearchManager {
  // üìç –¢–µ–∫—É—â–∞—è GPS-–ø–æ–∑–∏—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –ø–æ–∏—Å–∫–∞
  Point? _userPosition;
  
  /// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ç–µ–∫—É—â—É—é GPS-–ø–æ–∑–∏—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  /// –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
  void setUserPosition(Point position) {
    _userPosition = position;
    print('üìç User position updated: (${position.latitude}, ${position.longitude})');
  }
}
```

### 5. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ UI (main_screen.dart)

```dart
// lib/features/main_screen.dart

Future<void> _moveToUserLocation() async {
  try {
    // ... –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π ...
    
    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ
    geolocator.Position position = await geolocator.Geolocator.getCurrentPosition(
      desiredAccuracy: geolocator.LocationAccuracy.high,
    );

    print('üìç –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è: –ü–æ–ª—É—á–µ–Ω—ã –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã ${position.latitude}, ${position.longitude}');
    
    // üìç –ö–õ–Æ–ß–ï–í–û–ô –ú–û–ú–ï–ù–¢: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –ø–æ–∏—Å–∫–∞
    final point = Point(latitude: position.latitude, longitude: position.longitude);
    _mapManager.setUserPosition(point);

    // –ü–µ—Ä–µ–º–µ—â–∞–µ–º –∫–∞–º–µ—Ä—É –∫ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    final newCameraPosition = CameraPosition(
      point, 
      zoom: 15.0,
      azimuth: 0.0,
      tilt: 0.0,
    );
    
    await _mapWindow?.map.moveWithAnimation(
      newCameraPosition,
      const Animation(AnimationType.Smooth, duration: 1.0),
    );

  } catch (e) {
    print('‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏: $e');
  }
}
```

---

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: "–õ–µ–Ω–∏–Ω–∞ 33" (–±–µ–∑ –≥–æ—Ä–æ–¥–∞, –≤ –ü–µ—Ä–º–∏)
**–ü–æ–¥—Å–∫–∞–∑–∫–∏:**
1. –ó–∞–ø—Ä–æ—Å –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞–∑–≤–∞–Ω–∏—è –≥–æ—Ä–æ–¥–∞
2. –ï—Å—Ç—å GPS-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (–ü–µ—Ä–º—å)
3. BoundingBox ¬±0.2¬∞ (~22–∫–º) –≤–æ–∫—Ä—É–≥ –ü–µ—Ä–º–∏
4. ‚úÖ –í —Ç–æ–ø–µ "—É–ª. –õ–µ–Ω–∏–Ω–∞ 33, –ü–µ—Ä–º—å"

**–§–∏–Ω–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫:**
1. –í—ã–±—Ä–∞–ª–∏ –∞–¥—Ä–µ—Å
2. –°–æ–∑–¥–∞–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω—ã–π –ø–æ–ª–∏–≥–æ–Ω ¬±0.2¬∞ –≤–æ–∫—Ä—É–≥ –ü–µ—Ä–º–∏
3. ‚úÖ –ö–∞—Ä—Ç–∞ –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è –Ω–∞ "—É–ª. –õ–µ–Ω–∏–Ω–∞ 33, –ü–µ—Ä–º—å"

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: "–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥ –õ–µ–Ω–∏–Ω–∞ 33" (–∏–∑ –ü–µ—Ä–º–∏)
**–ü–æ–¥—Å–∫–∞–∑–∫–∏:**
1. –ó–∞–ø—Ä–æ—Å —Å–æ–¥–µ—Ä–∂–∏—Ç "–µ–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥"
2. BoundingBox –≤—Å–µ–π –†–æ—Å—Å–∏–∏ (41-82¬∞N, 19-180¬∞E)
3. ‚úÖ –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö "—É–ª. –õ–µ–Ω–∏–Ω–∞ 33, –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥"

**–§–∏–Ω–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫:**
1. –í—ã–±—Ä–∞–ª–∏ "–ø—Ä–æ—Å–ø–µ–∫—Ç –õ–µ–Ω–∏–Ω–∞, 33" (–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥)
2. –°–æ–∑–¥–∞–µ—Ç—Å—è –ø–æ–ª–∏–≥–æ–Ω –≤—Å–µ–π –†–æ—Å—Å–∏–∏
3. ‚úÖ –ö–∞—Ä—Ç–∞ –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è –≤ –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥ –Ω–∞ –Ω—É–∂–Ω—ã–π –∞–¥—Ä–µ—Å

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: "–ú–æ—Å–∫–≤–∞ –ö—É—Ç—É–∑–æ–≤—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç 43" (–∏–∑ –ü–µ—Ä–º–∏)
**–ü–æ–¥—Å–∫–∞–∑–∫–∏:**
1. –ó–∞–ø—Ä–æ—Å —Å–æ–¥–µ—Ä–∂–∏—Ç "–º–æ—Å–∫–≤–∞"
2. BoundingBox –≤—Å–µ–π –†–æ—Å—Å–∏–∏
3. ‚úÖ –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö "–ö—É—Ç—É–∑–æ–≤—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç, 43, –ú–æ—Å–∫–≤–∞"

**–§–∏–Ω–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫:**
1. –í—ã–±—Ä–∞–ª–∏ "–ö—É—Ç—É–∑–æ–≤—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç, 32" (–ú–æ—Å–∫–≤–∞)
2. –°–æ–∑–¥–∞–µ—Ç—Å—è –ø–æ–ª–∏–≥–æ–Ω –≤—Å–µ–π –†–æ—Å—Å–∏–∏
3. ‚úÖ –ö–∞—Ä—Ç–∞ –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è –≤ –ú–æ—Å–∫–≤—É –Ω–∞ –ö—É—Ç—É–∑–æ–≤—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç

---

## –†–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É Suggest API –∏ Search API

| –ê—Å–ø–µ–∫—Ç | Suggest API (–ø–æ–¥—Å–∫–∞–∑–∫–∏) | Search API (—Ñ–∏–Ω–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫) |
|--------|-------------------------|------------------------------|
| **–ö–æ–≥–¥–∞** | –ü—Ä–∏ –∫–∞–∂–¥–æ–º –≤–≤–µ–¥–µ–Ω–Ω–æ–º —Å–∏–º–≤–æ–ª–µ | –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –∞–¥—Ä–µ—Å–∞ –∏–∑ –ø–æ–¥—Å–∫–∞–∑–æ–∫ |
| **–§–æ—Ä–º–∞—Ç –æ–±–ª–∞—Å—Ç–∏** | `BoundingBox` (2 —Ç–æ—á–∫–∏: SW + NE) | `Geometry` (–ø–æ–ª–∏–≥–æ–Ω —Å 4-5 —Ç–æ—á–∫–∞–º–∏) |
| **–ú–µ—Ç–æ–¥** | `suggest()` | `submit()` |
| **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** | üåê Query contains city... | üöÄ startSearch... |

---

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

1. **lib/features/search/managers/map_search_manager.dart**
   - –ú–µ—Ç–æ–¥ `_submitSuggest()` - –ª–æ–≥–∏–∫–∞ –¥–ª—è —Å–∞–¥–∂–µ—Å—Ç–æ–≤
   - –ú–µ—Ç–æ–¥ `startSearch()` - –ù–û–í–ê–Ø –ª–æ–≥–∏–∫–∞ –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
   - –ú–µ—Ç–æ–¥ `_queryContainsCity()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –≥–æ—Ä–æ–¥–∞
   - –ü–æ–ª–µ `_userPosition` - —Ö—Ä–∞–Ω–µ–Ω–∏–µ GPS
   - –ú–µ—Ç–æ–¥ `setUserPosition()` - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ GPS

2. **taxi_route_calculator/lib/features/search/managers/map_search_manager.dart**
   - –¢–µ –∂–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (–∫–æ–ø–∏—è –∫–æ–¥–∞)

3. **lib/features/main_screen.dart**
   - –ú–µ—Ç–æ–¥ `_moveToUserLocation()` - –≤—ã–∑–æ–≤ `setUserPosition()`

4. **taxi_route_calculator/lib/features/main_screen.dart**
   - –¢–µ –∂–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (–∫–æ–ø–∏—è –∫–æ–¥–∞)

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:
1. **–ë–µ–∑ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏**: "–õ–µ–Ω–∏–Ω–∞ 33" ‚Üí —Ä–∞–∑–Ω—ã–µ –≥–æ—Ä–æ–¥–∞
2. **–° –≥–µ–æ–ª–æ–∫–∞—Ü–∏–µ–π** (–ü–µ—Ä–º—å): "–õ–µ–Ω–∏–Ω–∞ 33" ‚Üí –ü–µ—Ä–º—å –ø–µ—Ä–≤–∞—è
3. **–° –≥–æ—Ä–æ–¥–æ–º**: "–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥ –õ–µ–Ω–∏–Ω–∞ 33" ‚Üí –Ω–∞—Ö–æ–¥–∏—Ç –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥
4. **–í—ã–±–æ—Ä –∞–¥—Ä–µ—Å–∞**: "–ú–æ—Å–∫–≤–∞ –ö—É—Ç—É–∑–æ–≤—Å–∫–∏–π 43" ‚Üí **–ö–ê–†–¢–ê –ü–ï–†–ï–ú–ï–©–ê–ï–¢–°–Ø –í –ú–û–°–ö–í–£** ‚úÖ

### –õ–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:
```
üìç User position updated: (58.0, 56.2)
üåê Query contains city name ‚Üí using wide BoundingBox (all Russia)
   Query: "–µ–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥ –ª–µ–Ω–∏–Ω–∞ 33"
üöÄ startSearch with query: "–ö—É—Ç—É–∑–æ–≤—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç, 43"
üåê Query contains city "–ö—É—Ç—É–∑–æ–≤—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç, 43" ‚Üí using wide search area (all Russia)
```

---

## Commit
```bash
git add .
git commit -m "fix: –¥–æ–±–∞–≤–ª–µ–Ω –≥–µ–æ–ª–æ–∫–∞—Ü–∏–æ–Ω–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–ª—è suggest –∏ search API

- Suggest API: —É–º–Ω—ã–π BoundingBox (–≥–æ—Ä–æ–¥/GPS/–≤–∏–¥–∏–º–∞—è –æ–±–ª–∞—Å—Ç—å)
- Search API: —É–º–Ω—ã–π Geometry –ø–æ–ª–∏–≥–æ–Ω (–≥–æ—Ä–æ–¥/GPS/–≤–∏–¥–∏–º–∞—è –æ–±–ª–∞—Å—Ç—å)
- –¢–µ–ø–µ—Ä—å –ø–æ–∏—Å–∫ '–ú–æ—Å–∫–≤–∞ –ö—É—Ç—É–∑–æ–≤—Å–∫–∏–π 43' –∏–∑ –ü–µ—Ä–º–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ"
git push
```

---

## –ò—Å—Ç–æ—á–Ω–∏–∫
–†–µ—à–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞:
- –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Yandex MapKit
- –ü—Ä–∏–º–µ—Ä–∞—Ö –∏–∑ map_search (–ø—Ä–∏–ª–æ–∂–µ–Ω–Ω–∞—è –ø–∞–ø–∫–∞)
- –†–∞–∑–ª–∏—á–∏—è—Ö –º–µ–∂–¥—É Suggest API (BoundingBox) –∏ Search API (Geometry)

**–ö–ª—é—á–µ–≤–æ–µ –æ—Ç–ª–∏—á–∏–µ –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏**: –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ (Search API), –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–æ–∫ (Suggest API).

## –†–µ—à–µ–Ω–∏–µ
–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —É–º–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ BoundingBox –¥–ª—è Yandex MapKit:
- **–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∫–∞–∑–∞–ª –≥–æ—Ä–æ–¥** ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —à–∏—Ä–æ–∫–∏–π BoundingBox (–≤—Å—è –†–æ—Å—Å–∏—è)
- **–ï—Å–ª–∏ –≥–æ—Ä–æ–¥ –ù–ï —É–∫–∞–∑–∞–Ω –ò –µ—Å—Ç—å GPS** ‚Üí –º–∞–ª–µ–Ω—å–∫–∏–π BoundingBox (~22–∫–º –≤–æ–∫—Ä—É–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- **Fallback** ‚Üí BoundingBox –≤–∏–¥–∏–º–æ–π –æ–±–ª–∞—Å—Ç–∏ –∫–∞—Ä—Ç—ã

---

## –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### 1. `/lib/features/search/managers/map_search_manager.dart`
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `Point? _userPosition` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è GPS-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
- –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `setUserPosition(Point)` –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–æ–∑–∏—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `_queryContainsCity(String)` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è –≥–æ—Ä–æ–¥–∞ –≤ –∑–∞–ø—Ä–æ—Å–µ (60+ –≥–æ—Ä–æ–¥–æ–≤ –†–æ—Å—Å–∏–∏)
- –ò–∑–º–µ–Ω—ë–Ω –º–µ—Ç–æ–¥ `_submitSuggest()` –¥–ª—è —É–º–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ BoundingBox

### 2. `/lib/features/main_screen.dart`
- –í –º–µ—Ç–æ–¥ `_moveToUserLocation()` –¥–æ–±–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ `_mapManager.setUserPosition(point)` –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç

### 3. `/taxi_route_calculator/lib/features/search/managers/map_search_manager.dart`
- –ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –º–æ–¥—É–ª—è taxi_route_calculator

---

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç "–õ–µ–Ω–∏–Ω–∞ 33" (–±–µ–∑ –≥–æ—Ä–æ–¥–∞)
1. –ó–∞–ø—Ä–æ—Å –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞–∑–≤–∞–Ω–∏—è –≥–æ—Ä–æ–¥–∞
2. –ï—Å—Ç—å GPS-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ü–µ—Ä–º—å)
3. –°–æ–∑–¥–∞—ë—Ç—Å—è **–º–∞–ª–µ–Ω—å–∫–∏–π BoundingBox** ¬±0.2¬∞ (~22–∫–º) –≤–æ–∫—Ä—É–≥ –ü–µ—Ä–º–∏
4. Yandex MapKit –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–∞–¥–∂–µ—Å—Ç—ã –¢–û–õ–¨–ö–û –∏–∑ –ü–µ—Ä–º–∏ –∏ –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–µ–π
5. ‚úÖ –í —Ç–æ–ø–µ "—É–ª. –õ–µ–Ω–∏–Ω–∞ 33, –ü–µ—Ä–º—å"

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç "–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥ –õ–µ–Ω–∏–Ω–∞ 33"
1. –ó–∞–ø—Ä–æ—Å —Å–æ–¥–µ—Ä–∂–∏—Ç "–µ–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥"
2. –°–æ–∑–¥–∞—ë—Ç—Å—è **—à–∏—Ä–æ–∫–∏–π BoundingBox** (–≤—Å—è –†–æ—Å—Å–∏—è 41-82¬∞N, 19-180¬∞E)
3. Yandex MapKit –∏—â–µ—Ç –ø–æ –≤—Å–µ–π –†–æ—Å—Å–∏–∏
4. ‚úÖ –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö "—É–ª. –õ–µ–Ω–∏–Ω–∞ 33, –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥"

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ù–µ—Ç GPS –∏ –Ω–µ—Ç –≥–æ—Ä–æ–¥–∞
1. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è BoundingBox –≤–∏–¥–∏–º–æ–π –æ–±–ª–∞—Å—Ç–∏ –∫–∞—Ä—Ç—ã (fallback)
2. –°–∞–¥–∂–µ—Å—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –¥–ª—è —Ç–æ–π –æ–±–ª–∞—Å—Ç–∏, –∫–æ—Ç–æ—Ä—É—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –Ω–∞ —ç–∫—Ä–∞–Ω–µ

---

## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã

### BoundingBox —Ä–∞–∑–º–µ—Ä—ã
- **–õ–æ–∫–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫**: ¬±0.2¬∞ (~22–∫–º —Ä–∞–¥–∏—É—Å)
  - –ú–æ–∂–Ω–æ —É–º–µ–Ω—å—à–∏—Ç—å –¥–æ ¬±0.1¬∞ (~11–∫–º) –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
  - –ú–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –¥–æ ¬±0.5¬∞ (~55–∫–º) –¥–ª—è –ø—Ä–∏–≥–æ—Ä–æ–¥–æ–≤
  
- **–®–∏—Ä–æ–∫–∏–π –ø–æ–∏—Å–∫**: 41-82¬∞N, 19-180¬∞E (–≤—Å—è –†–æ—Å—Å–∏—è)
  - –î–ª—è –¥—Ä—É–≥–∏—Ö —Å—Ç—Ä–∞–Ω –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã

### –°–ø–∏—Å–æ–∫ –≥–æ—Ä–æ–¥–æ–≤
–í `_queryContainsCity()` —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è 60+ –≥–æ—Ä–æ–¥–æ–≤ –†–æ—Å—Å–∏–∏:
- –í—Å–µ –≥–æ—Ä–æ–¥–∞-–º–∏–ª–ª–∏–æ–Ω–Ω–∏–∫–∏
- –ö—Ä—É–ø–Ω—ã–µ –æ–±–ª–∞—Å—Ç–Ω—ã–µ —Ü–µ–Ω—Ç—Ä—ã
- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –≥–æ—Ä–æ–¥–∞ (–°–æ—á–∏, –ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥ –∏ —Ç.–¥.)

**–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞:**
```dart
const cities = [
  '–º–æ—Å–∫–≤–∞', '—Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥', // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ
  '–≤–∞—à-–≥–æ—Ä–æ–¥', '–¥—Ä—É–≥–æ–π-–≥–æ—Ä–æ–¥', // –¥–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–∏
];
```

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã
1. **–ë–µ–∑ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏**: –≤–≤–µ–¥–∏—Ç–µ "–õ–µ–Ω–∏–Ω–∞ 33" ‚Üí –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑–∞—Ç—å—Å—è —Ä–∞–∑–Ω—ã–µ –≥–æ—Ä–æ–¥–∞
2. **–í–∫–ª—é—á–∏—Ç–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é**: –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É GPS ‚Üí setUserPosition() –≤—ã–∑–≤–∞–Ω
3. **–í–≤–µ–¥–∏—Ç–µ —Å–Ω–æ–≤–∞ "–õ–µ–Ω–∏–Ω–∞ 33"** ‚Üí –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å—Å—è –≤–∞—à –≥–æ—Ä–æ–¥ –ø–µ—Ä–≤—ã–º
4. **–í–≤–µ–¥–∏—Ç–µ "–ú–æ—Å–∫–≤–∞ –õ–µ–Ω–∏–Ω–∞ 33"** ‚Üí –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑–∞—Ç—å—Å—è –ú–æ—Å–∫–≤–∞ (–¥–∞–∂–µ –µ—Å–ª–∏ –≤—ã –≤ –ü–µ—Ä–º–∏)

### –õ–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
```
üìç User position updated: (58.0, 56.2)
üåê Query contains city name ‚Üí using wide BoundingBox (all Russia)
   Query: "–µ–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥ –ª–µ–Ω–∏–Ω–∞ 33"
```

```
üìç No city in query ‚Üí using local BoundingBox around user position
   User position: (58.0, 56.2)
   BoundingBox: SW(57.8,56.0) NE(58.2,56.4)
```

---

## –ò—Å—Ç–æ—á–Ω–∏–∫ —Ä–µ—à–µ–Ω–∏—è
–†–µ—à–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Yandex MapKit –∏ –ø—Ä–∏–º–µ—Ä–∞—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –Ø–Ω–¥–µ–∫—Å–∞ –ø–æ —Ä–∞–±–æ—Ç–µ —Å BoundingBox –¥–ª—è –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞.
