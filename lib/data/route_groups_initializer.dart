import '../models/route_group.dart';
import '../services/route_group_service.dart';

/// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –≥—Ä—É–ø–ø –º–∞—Ä—à—Ä—É—Ç–æ–≤
class RouteGroupsInitializer {
  /// –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –≥—Ä—É–ø–ø –º–∞—Ä—à—Ä—É—Ç–æ–≤
  static List<RouteGroup> get initialGroups {
    final now = DateTime.now();
    
    return [
      // ========================================
      // –ì–†–£–ü–ü–ê 1: –†–æ—Å—Ç–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å
      // ========================================
      RouteGroup(
        id: 'rostov_region',
        name: '–†–æ—Å—Ç–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        description: '–ú–∞—Ä—à—Ä—É—Ç—ã –≤ –≥–æ—Ä–æ–¥–∞ –†–æ—Å—Ç–æ–≤—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏',
        basePrice: 8000,
        destinationCities: ['–†–æ—Å—Ç–æ–≤', '–†–û–°–¢–û–í', '–¢–∞–≥–∞–Ω—Ä–æ–≥', '–ë–∞—Ç–∞–π—Å–∫', '–ê–∫—Å–∞–π'],
        originCities: [
          '–î–æ–Ω–µ—Ü–∫', '–ú–∞–∫–µ–µ–≤–∫–∞', '–•–∞—Ä—Ü—ã–∑—Å–∫', '–ê–º–≤—Ä–æ—Å–∏–µ–≤–∫–∞', 
          '–ó—É–≥—Ä—ç—Å', '–®–∞—Ö—Ç—ë—Ä—Å–∫', '–¢–æ—Ä–µ–∑', '–ò–ª–æ–≤–∞–π—Å–∫–∏–π', 
          '–°—Ç–∞—Ä–æ–±–µ—à–µ–≤–æ', '–ù–æ–≤—ã–π —Å–≤–µ—Ç', '–ï–ª–µ–Ω–æ–≤–∫–∞', 
          '–ú–∞—Ä–∏—É–ø–æ–ª—å', '–ï–Ω–∞–∫–∏–µ–≤–æ', '–î–æ–∫—É—á–∞–µ–≤—Å–∫', 
          '–Ø—Å–∏–Ω–æ–≤–∞—Ç–∞—è', '–í–æ–ª–Ω–æ–≤–∞—Ö–∞'
        ],
        autoGenerateReverse: true,
        createdAt: now,
        updatedAt: now,
      ),
      
      // ========================================
      // –ì–†–£–ü–ü–ê 2: –ö—Ä—ã–º—Å–∫–∏–π –ø–æ–ª—É–æ—Å—Ç—Ä–æ–≤
      // ========================================
      RouteGroup(
        id: 'crimea',
        name: '–ö—Ä—ã–º—Å–∫–∏–π –ø–æ–ª—É–æ—Å—Ç—Ä–æ–≤',
        description: '–í—Å–µ –º–∞—Ä—à—Ä—É—Ç—ã –Ω–∞ –ö—Ä—ã–º—Å–∫–∏–π –ø–æ–ª—É–æ—Å—Ç—Ä–æ–≤',
        basePrice: 45000,
        destinationCities: [
          '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ö—Ä—ã–º', '–°–∏–º—Ñ–µ—Ä–æ–ø–æ–ª—å', '–Ø–ª—Ç–∞', '–°–µ–≤–∞—Å—Ç–æ–ø–æ–ª—å',
          '–ï–≤–ø–∞—Ç–æ—Ä–∏—è', '–§–µ–æ–¥–æ—Å–∏—è', '–ö–µ—Ä—á—å', '–ê–ª—É—à—Ç–∞', '–°—É–¥–∞–∫',
          '–ë–∞–ª–∞–∫–ª–∞–≤–∞', '–ë–µ–ª–æ–≥–æ—Ä—Å–∫', '–°–∞–∫–∏', '–î–∂–∞–Ω–∫–æ–π', '–ö—Ä–∞—Å–Ω–æ–ø–µ—Ä–µ–∫–æ–ø—Å–∫'
        ],
        originCities: ['–î–æ–Ω–µ—Ü–∫', '–ú–∞–∫–µ–µ–≤–∫–∞'],
        autoGenerateReverse: true,
        createdAt: now,
        updatedAt: now,
      ),
      
      // ========================================
      // –ì–†–£–ü–ü–ê 3: –ü—Ä–∏–∞–∑–æ–≤—å–µ
      // ========================================
      RouteGroup(
        id: 'azov_sea',
        name: '–ü—Ä–∏–∞–∑–æ–≤—å–µ',
        description: '–ú–∞—Ä—à—Ä—É—Ç—ã –∫ –ê–∑–æ–≤—Å–∫–æ–º—É –º–æ—Ä—é',
        basePrice: 7500,
        destinationCities: [
          '–ù–æ–≤–æ–∞–∑–æ–≤—Å–∫', '–°–µ–¥–æ–≤–æ', '–ú–∞—Ä–∏—É–ø–æ–ª—å', '–ú–µ–ª–µ–∫–∏–Ω–æ', 
          '–Æ—Ä—å–µ–≤–∫–∞', '—É—Ä–∑—É—Ñ', '–ë–µ—Ä–¥—è–Ω—Å–∫'
        ],
        originCities: ['–î–æ–Ω–µ—Ü–∫'],
        autoGenerateReverse: true,
        createdAt: now,
        updatedAt: now,
      ),
      
      // ========================================
      // –ì–†–£–ü–ü–ê 4: –ß–µ—Ä–Ω–æ–º–æ—Ä—Å–∫–æ–µ –ø–æ–±–µ—Ä–µ–∂—å–µ
      // ========================================
      RouteGroup(
        id: 'black_sea_coast',
        name: '–ß–µ—Ä–Ω–æ–º–æ—Ä—Å–∫–æ–µ –ø–æ–±–µ—Ä–µ–∂—å–µ',
        description: '–ö—É—Ä–æ—Ä—Ç—ã –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä—Å–∫–æ–≥–æ –∫—Ä–∞—è (–ê–Ω–∞–ø–∞, –ì–µ–ª–µ–Ω–¥–∂–∏–∫)',
        basePrice: 40000,
        destinationCities: ['–ê–Ω–∞–ø–∞', '–ì–µ–ª–µ–Ω–¥–∂–∏–∫', '–¥–∏–≤–Ω–æ–º—Ä—Å–∫–æ–µ'],
        originCities: ['–î–æ–Ω–µ—Ü–∫', '–ú–∞–∫–µ–µ–≤–∫–∞', '–•–∞—Ä—Ü—ã–∑—Å–∫'],
        autoGenerateReverse: true,
        createdAt: now,
        updatedAt: now,
      ),
      
      // ========================================
      // –ì–†–£–ü–ü–ê 5: –°–æ—á–∏
      // ========================================
      RouteGroup(
        id: 'sochi',
        name: '–°–æ—á–∏',
        description: '–ú–∞—Ä—à—Ä—É—Ç—ã –≤ –°–æ—á–∏ –∏ –∞—ç—Ä–æ–ø–æ—Ä—Ç',
        basePrice: 50000,
        destinationCities: ['–°–æ—á–∏', '–°–æ—á–∏ –∞—ç—Ä–æ–ø–æ—Ä—Ç'],
        originCities: ['–î–æ–Ω–µ—Ü–∫'],
        autoGenerateReverse: true,
        createdAt: now,
        updatedAt: now,
      ),
      
      // ========================================
      // –ì–†–£–ü–ü–ê 6: –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä
      // ========================================
      RouteGroup(
        id: 'krasnodar',
        name: '–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä',
        description: '–ú–∞—Ä—à—Ä—É—Ç—ã –≤ –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä',
        basePrice: 30000,
        destinationCities: ['–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä'],
        originCities: [
          '–î–æ–Ω–µ—Ü–∫', '–ú–∞–∫–µ–µ–≤–∫–∞', '–•–∞—Ä—Ü—ã–∑—Å–∫', '–ò–ª–æ–≤–∞–π—Å–∫', 
          '–ê–º–≤—Ä–æ—Å–∏–µ–≤–∫–∞', '–ü—É–Ω–∫—Ç –ø—Ä–æ–ø—É—Å–∫–∞ –ê–≤–∏–ª–æ-–£—Å–ø–µ–Ω–∫–∞',
          '–ü—É–Ω–∫—Ç –ø—Ä–æ–ø—É—Å–∫–∞ –ê–≤–∏–ª–æ –£—Å–ø–µ–Ω–∫–∞'
        ],
        autoGenerateReverse: true,
        createdAt: now,
        updatedAt: now,
      ),
      
      // ========================================
      // –ì–†–£–ü–ü–ê 7: –í–æ–ª–≥–æ–≥—Ä–∞–¥ –∏ –ú–∏–Ω–≤–æ–¥—ã
      // ========================================
      RouteGroup(
        id: 'volgograd_minvody',
        name: '–í–æ–ª–≥–æ–≥—Ä–∞–¥ –∏ –ú–∏–Ω–≤–æ–¥—ã',
        description: '–ú–∞—Ä—à—Ä—É—Ç—ã –≤ –í–æ–ª–≥–æ–≥—Ä–∞–¥ –∏ –ú–∏–Ω–µ—Ä–∞–ª—å–Ω—ã–µ –í–æ–¥—ã',
        basePrice: 40000,
        destinationCities: ['–í–æ–ª–≥–æ–≥—Ä–∞–¥', '–º–∏–Ω–≤–æ–¥—ã'],
        originCities: ['–î–æ–Ω–µ—Ü–∫', '–•–∞—Ä—Ü—ã–∑—Å–∫', '–ú–∞–∫–µ–µ–≤–∫–∞'],
        autoGenerateReverse: true,
        createdAt: now,
        updatedAt: now,
      ),
      
      // ========================================
      // –ì–†–£–ü–ü–ê 8: –ï–π—Å–∫
      // ========================================
      RouteGroup(
        id: 'yeisk',
        name: '–ï–π—Å–∫',
        description: '–ú–∞—Ä—à—Ä—É—Ç—ã –≤ –ï–π—Å–∫',
        basePrice: 22000,
        destinationCities: ['–ï–π—Å–∫'],
        originCities: ['–î–æ–Ω–µ—Ü–∫', '–ú–∞–∫–µ–µ–≤–∫–∞', '–ï–Ω–∞–∫–∏–µ–≤–æ'],
        autoGenerateReverse: true,
        createdAt: now,
        updatedAt: now,
      ),
      
      // ========================================
      // –ì–†–£–ü–ü–ê 9: –î–∞–ª—å–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –†–æ—Å—Å–∏–∏
      // ========================================
      RouteGroup(
        id: 'distant_russia',
        name: '–î–∞–ª—å–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –†–æ—Å—Å–∏–∏',
        description: '–ú–æ—Å–∫–≤–∞, –í–æ—Ä–æ–Ω–µ–∂ –∏ –¥—Ä—É–≥–∏–µ –¥–∞–ª—å–Ω–∏–µ –≥–æ—Ä–æ–¥–∞',
        basePrice: 50000,
        destinationCities: ['–ú–æ—Å–∫–≤–∞', '–í–æ—Ä–æ–Ω–µ–∂'],
        originCities: ['–î–æ–Ω–µ—Ü–∫'],
        autoGenerateReverse: true,
        createdAt: now,
        updatedAt: now,
      ),
      
      // ========================================
      // –ì–†–£–ü–ü–ê 10: –õ—é–±—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã
      // ========================================
      RouteGroup(
        id: 'any_routes',
        name: '–õ—é–±—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã',
        description: '–ú–∞—Ä—à—Ä—É—Ç—ã, –Ω–µ –æ—Ç–Ω–æ—Å—è—â–∏–µ—Å—è –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –≥—Ä—É–ø–ø–∞–º',
        basePrice: 0, // –¶–µ–Ω–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ
        destinationCities: [], // –ü—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ - –ª—é–±—ã–µ –≥–æ—Ä–æ–¥–∞
        originCities: [], // –ü—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ - –ª—é–±—ã–µ –≥–æ—Ä–æ–¥–∞
        autoGenerateReverse: false,
        createdAt: now,
        updatedAt: now,
      ),
    ];
  }
  
  /// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≥—Ä—É–ø–ø
  static Map<String, dynamic> get groupStats {
    final groups = initialGroups;
    int totalPotentialRoutes = 0;
    
    for (final group in groups) {
      totalPotentialRoutes += group.potentialRoutesCount;
    }
    
    return {
      'total_groups': groups.length,
      'total_potential_routes': totalPotentialRoutes,
      'avg_base_price': (groups.map((g) => g.basePrice).reduce((a, b) => a + b) / groups.length).round(),
    };
  }
  
  /// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä—É–ø–ø –≤ Firebase
  static Future<void> initializeGroups() async {
    try {
      print('üöÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –≥—Ä—É–ø–ø –º–∞—Ä—à—Ä—É—Ç–æ–≤...');
      
      final service = RouteGroupService.instance;
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –≥—Ä—É–ø–ø—ã
      final existingGroups = await service.getAllGroups();
      final existingIds = existingGroups.map((g) => g.id).toSet();
      
      print('üìÑ –ù–∞–π–¥–µ–Ω–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –≥—Ä—É–ø–ø: ${existingGroups.length}');
      
      // –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –≥—Ä—É–ø–ø—ã, –∫–æ—Ç–æ—Ä—ã—Ö –µ—â—ë –Ω–µ—Ç
      final groupsToAdd = initialGroups
          .where((group) => !existingIds.contains(group.id))
          .toList();
      
      if (groupsToAdd.isEmpty) {
        print('‚úÖ –í—Å–µ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –≥—Ä—É–ø–ø—ã —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç (${initialGroups.length} —à—Ç.)');
        print('üìä –í—Å–µ–≥–æ –≥—Ä—É–ø–ø –≤ –±–∞–∑–µ: ${existingGroups.length}');
        return;
      }
      
      print('üì• –î–æ–±–∞–≤–ª—è–µ–º ${groupsToAdd.length} –Ω–æ–≤—ã—Ö –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –≥—Ä—É–ø–ø...');
      
      // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –≥—Ä—É–ø–ø—ã
      await service.addGroupsBatch(groupsToAdd);
      
      final totalGroups = existingGroups.length + groupsToAdd.length;
      
      print('‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!');
      print('üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:');
      print('   ‚Ä¢ –í—Å–µ–≥–æ –≥—Ä—É–ø–ø –≤ –±–∞–∑–µ: $totalGroups');
      print('   ‚Ä¢ –ë—ã–ª–æ –¥–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ${existingGroups.length}');
      print('   ‚Ä¢ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö: ${groupsToAdd.length}');
      
    } catch (e) {
      print('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≥—Ä—É–ø–ø: $e');
      rethrow;
    }
  }
  
  /// –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä—É–ø–ø
  static Future<void> forceInitializeGroups() async {
    try {
      print('üßπ –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∏ –ø–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä—É–ø–ø...');
      
      final service = RouteGroupService.instance;
      
      // –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –≥—Ä—É–ø–ø—ã
      final existingGroups = await service.getAllGroups();
      print('üóëÔ∏è –ù–∞–π–¥–µ–Ω–æ ${existingGroups.length} –≥—Ä—É–ø–ø –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è...');
      
      for (final group in existingGroups) {
        await service.deleteGroup(group.id);
      }
      
      print('‚úÖ –û—á–∏—â–µ–Ω–æ ${existingGroups.length} –≥—Ä—É–ø–ø');
      
      // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –≥—Ä—É–ø–ø—ã
      await service.addGroupsBatch(initialGroups);
      
      print('‚úÖ –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!');
      print('üìä –î–æ–±–∞–≤–ª–µ–Ω–æ –≥—Ä—É–ø–ø: ${initialGroups.length}');
      
    } catch (e) {
      print('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≥—Ä—É–ø–ø: $e');
      rethrow;
    }
  }
}
