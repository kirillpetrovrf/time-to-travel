# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–ª–æ–≥–∏–Ω–∏–≤–∞–Ω–∏—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–î–∞—Ç–∞**: 24 —è–Ω–≤–∞—Ä—è 2026 –≥.  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–µ—à–µ–Ω–æ  
**–í—Ä–µ–º—è –æ—Ç–ª–∞–¥–∫–∏**: ~4 —á–∞—Å–∞

---

## üìã –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### –°–∏–º–ø—Ç–æ–º—ã
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ –ª–æ–≥–∏–Ω–∏—Ç—Å—è —á–µ—Ä–µ–∑ Telegram
- ‚úÖ –¢–æ–∫–µ–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ storage
- ‚ùå –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–ª–æ–≥–∏–Ω–∏–≤–∞–µ—Ç—Å—è
- ‚ùå –ü—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –ª–æ–≥–∏–Ω–∏—Ç—å—Å—è –∑–∞–Ω–æ–≤–æ –∫–∞–∂–¥—ã–π —Ä–∞–∑

### –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –∑–∞–ª–æ–≥–∏–Ω–µ–Ω–Ω—ã–º –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ —Å–∞–º –Ω–µ –Ω–∞–∂–º–µ—Ç –∫–Ω–æ–ø–∫—É "–í—ã–π—Ç–∏".

### –û—à–∏–±–∫–∞ –≤ –ª–æ–≥–∞—Ö
```
‚úÖ [STORAGE] hasTokens(): result: true
üîç [AUTH_PROVIDER] RefreshToken: eyJhbGciOiJIUzI1NiIs...
üì° [AUTH_PROVIDER] –ü—ã—Ç–∞–µ–º—Å—è –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ /refresh...
‚ùå [AUTH_PROVIDER] –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞: type 'Null' is not a subtype of type 'String' in type cast
üóëÔ∏è [AUTH_PROVIDER] –û—á–∏—â–∞–µ–º —Ç–æ–∫–µ–Ω—ã ‚Üí unauthenticated
```

---

## üîç –ê–Ω–∞–ª–∏–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –ø—Ä–∏—á–∏–Ω—ã

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

#### Backend endpoints

**1. `/auth/telegram/callback-code` (–ø–µ—Ä–≤—ã–π –ª–æ–≥–∏–Ω)**
```json
{
  "accessToken": "eyJ...",
  "refreshToken": "eyJ...",
  "user": {
    "id": "uuid",
    "fullName": "...",
    "phone": "..."
  }
}
```
‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç **–æ–±–∞ —Ç–æ–∫–µ–Ω–∞**

**2. `/auth/refresh` (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞)**
```json
{
  "accessToken": "eyJ...",
  "user": {
    "id": "uuid",
    "fullName": "...",
    "phone": "..."
  }
}
```
‚ö†Ô∏è –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç **—Ç–æ–ª—å–∫–æ accessToken** (–±–µ–∑ refreshToken)

**–ü–æ—á–µ–º—É —Ç–∞–∫?**  
Refresh token - —ç—Ç–æ –¥–æ–ª–≥–æ–∂–∏–≤—É—â–∏–π —Ç–æ–∫–µ–Ω, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏. –ï–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ –∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –≤—Å–µ—Ö –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π.

### –ü—Ä–æ–±–ª–µ–º–∞ –≤ –∫–æ–¥–µ

**–§–∞–π–ª**: `lib/services/telegram_auth_api_service.dart`

**–î–û –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è** (—Å—Ç—Ä–æ–∫–∞ 19):
```dart
class AuthTokensResponse {
  final String accessToken;
  final String refreshToken;  // Non-nullable!
  final Map<String, dynamic> user;

  factory AuthTokensResponse.fromJson(Map<String, dynamic> json) {
    return AuthTokensResponse(
      accessToken: json['accessToken'] as String,
      refreshToken: json['refreshToken'] as String,  // ‚ùå –ö–†–ê–®!
      user: json['user'] as Map<String, dynamic>,
    );
  }
}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ:**
1. App –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è ‚Üí `checkAuthStatus()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
2. –ù–∞—Ö–æ–¥–∏—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã –≤ storage
3. –í—ã–∑—ã–≤–∞–µ—Ç `POST /auth/refresh` —Å refreshToken
4. Backend –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{accessToken, user}` –ë–ï–ó refreshToken
5. Frontend –ø—ã—Ç–∞–µ—Ç—Å—è: `json['refreshToken'] as String`
6. `json['refreshToken']` = `null`
7. Type cast –æ—à–∏–±–∫–∞: `type 'Null' is not a subtype of type 'String'`
8. Exception –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç—Å—è ‚Üí –≤—Å–µ —Ç–æ–∫–µ–Ω—ã —É–¥–∞–ª—è—é—Ç—Å—è ‚Üí logout

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ 1: Response Model (–∫–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–æ–±–ª–µ–º–∞)

**–§–∞–π–ª**: `lib/services/telegram_auth_api_service.dart`  
**–°—Ç—Ä–æ–∫–∏**: 16-21

```dart
factory AuthTokensResponse.fromJson(Map<String, dynamic> json) {
  return AuthTokensResponse(
    accessToken: json['accessToken'] as String,
    refreshToken: json['refreshToken'] as String? ?? '',  // ‚úÖ NULL-SAFE
    user: json['user'] as Map<String, dynamic>,
  );
}
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- `as String` ‚Üí `as String?` (—Ä–∞–∑—Ä–µ—à–∞–µ—Ç null)
- –î–æ–±–∞–≤–ª–µ–Ω `?? ''` (–µ—Å–ª–∏ null, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**  
–¢–µ–ø–µ—Ä—å –ø–∞—Ä—Å–∏–Ω–≥ –Ω–µ –ø–∞–¥–∞–µ—Ç, –¥–∞–∂–µ –µ—Å–ª–∏ backend –Ω–µ –≤–µ—Ä–Ω—É–ª refreshToken.

---

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ 2: Smart Reuse Logic –≤ checkAuthStatus()

**–§–∞–π–ª**: `lib/providers/auth_provider.dart`  
**–ú–µ—Ç–æ–¥**: `checkAuthStatus()` (~—Å—Ç—Ä–æ–∫–∞ 102-117)

```dart
try {
  print('üì° [AUTH_PROVIDER] –ü—ã—Ç–∞–µ–º—Å—è –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ /refresh...');
  final response = await _api.refresh(refreshToken);
  
  print('‚úÖ [AUTH_PROVIDER] –¢–æ–∫–µ–Ω —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª—ë–Ω!');
  print('   ‚Ä¢ user: ${response.user}');
  
  // ‚úÖ –ù–û–í–ê–Ø –õ–û–ì–ò–ö–ê: –£–º–Ω–æ–µ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ refreshToken
  final newRefreshToken = response.refreshToken.isEmpty 
      ? refreshToken              // Backend –Ω–µ –≤–µ—Ä–Ω—É–ª –Ω–æ–≤—ã–π ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞—Ä—ã–π
      : response.refreshToken;    // Backend –≤–µ—Ä–Ω—É–ª –Ω–æ–≤—ã–π ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ
  
  await _storage.saveTokens(
    accessToken: response.accessToken,
    refreshToken: newRefreshToken,  // üëà –í—Å–µ–≥–¥–∞ –≤–∞–ª–∏–¥–Ω—ã–π —Ç–æ–∫–µ–Ω
    userId: response.user['id']?.toString(),
  );

  _user = response.user;
  _status = AuthStatus.authenticated;
  print('‚úÖ [AUTH_PROVIDER] –°—Ç–∞—Ç—É—Å: authenticated');
} catch (e) {
  print('‚ùå [AUTH_PROVIDER] –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞: $e');
  await _storage.clearTokens();
  _status = AuthStatus.unauthenticated;
  print('üóëÔ∏è [AUTH_PROVIDER] –û—á–∏—â–∞–µ–º —Ç–æ–∫–µ–Ω—ã ‚Üí unauthenticated');
}
```

**–õ–æ–≥–∏–∫–∞:**
1. –ï—Å–ª–∏ `response.refreshToken` –ø—É—Å—Ç–æ–π (backend –Ω–µ –≤–µ—Ä–Ω—É–ª)
2. –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞—Ä—ã–π `refreshToken` –∏–∑ storage
3. –ï—Å–ª–∏ backend –≤–µ—Ä–Ω—É–ª –Ω–æ–≤—ã–π - –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—ã–π

---

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ 3: –¢–∞ –∂–µ –ª–æ–≥–∏–∫–∞ –≤ refreshAccessToken()

**–§–∞–π–ª**: `lib/providers/auth_provider.dart`  
**–ú–µ—Ç–æ–¥**: `refreshAccessToken()` (~—Å—Ç—Ä–æ–∫–∞ 254-264)

```dart
try {
  final response = await _api.refresh(refreshToken);
  
  // ‚úÖ –ù–û–í–ê–Ø –õ–û–ì–ò–ö–ê: –£–º–Ω–æ–µ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ refreshToken
  final newRefreshToken = response.refreshToken.isEmpty 
      ? refreshToken 
      : response.refreshToken;
  
  await _storage.saveTokens(
    accessToken: response.accessToken,
    refreshToken: newRefreshToken,
    userId: response.user['id']?.toString(),
  );

  _user = response.user;
  return response.accessToken;
} catch (e) {
  print('‚ùå [AUTH_PROVIDER] –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è access —Ç–æ–∫–µ–Ω–∞: $e');
  rethrow;
}
```

**–ü–æ—á–µ–º—É –¥–≤–∞ –º–µ—Å—Ç–∞?**
- `checkAuthStatus()` - –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- `refreshAccessToken()` - –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞ accessToken –∏—Å—Ç–µ–∫–∞–µ—Ç –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã

–û–±–∞ –º–µ—Ç–æ–¥–∞ –¥–æ–ª–∂–Ω—ã –æ–±–Ω–æ–≤–ª—è—Ç—å —Ç–æ–∫–µ–Ω—ã ‚Üí –Ω—É–∂–Ω–∞ –æ–¥–∏–Ω–∞–∫–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –≤ –æ–±–æ–∏—Ö –º–µ—Å—Ç–∞—Ö.

---

## üìä –§–ª–æ—É –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–µ—Ä–≤—ã–π –ª–æ–≥–∏–Ω

```
1. User ‚Üí Telegram Auth ‚Üí START
2. Backend ‚Üí POST /auth/telegram/callback-code
3. Response: {accessToken, refreshToken, user} ‚úÖ
4. Frontend:
   - –ü–∞—Ä—Å–∏–Ω–≥: refreshToken –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç
   - Storage: —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –û–ë–ê —Ç–æ–∫–µ–Ω–∞
5. Status: authenticated ‚Üí HomeScreen
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```
1. App starts ‚Üí checkAuthStatus()
2. Storage: hasTokens() = true ‚úÖ
3. Backend ‚Üí POST /auth/refresh
4. Response: {accessToken, user} (–ë–ï–ó refreshToken) ‚úÖ
5. Frontend:
   - –ü–∞—Ä—Å–∏–Ω–≥: json['refreshToken'] = null
   - Response model: as String? ?? '' ‚Üí '' ‚úÖ
   - Smart logic: response.refreshToken.isEmpty = true
   - Smart logic: newRefreshToken = —Å—Ç–∞—Ä—ã–π refreshToken ‚úÖ
   - Storage: —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–æ–≤—ã–π accessToken + —Å—Ç–∞—Ä—ã–π refreshToken
6. Status: authenticated ‚Üí HomeScreen ‚úÖ
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: Access token –∏—Å—Ç–µ–∫ –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã

```
1. API call ‚Üí 401 Unauthorized
2. refreshAccessToken() –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
3. Backend ‚Üí POST /auth/refresh
4. Response: {accessToken, user}
5. Frontend:
   - Smart logic: –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞—Ä—ã–π refreshToken
   - Storage: –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–∫–µ–Ω—ã
6. Retry original API call ‚Üí Success
```

---

## üêõ –ò—Å—Ç–æ—Ä–∏—è –æ—Ç–ª–∞–¥–∫–∏ (—Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—è)

### –ü–æ–ø—ã—Ç–∫–∞ 1: Backend empty body handling ‚ùå
**–î–µ–π—Å—Ç–≤–∏–µ**: –î–æ–±–∞–≤–∏–ª try-catch –≤–æ–∫—Ä—É–≥ `context.request.json()` –≤ `/auth/refresh`  
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –û—à–∏–±–∫–∞ –æ—Å—Ç–∞–ª–∞—Å—å  
**–í—ã–≤–æ–¥**: –ü—Ä–æ–±–ª–µ–º–∞ –Ω–µ –≤ –ø—É—Å—Ç–æ–º body

### –ü–æ–ø—ã—Ç–∫–∞ 2: Docker cache ‚ùå
**–î–µ–π—Å—Ç–≤–∏–µ**: `docker compose build --no-cache backend`  
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: curl —Ç–µ—Å—Ç —É–ª—É—á—à–∏–ª—Å—è (400 –≤–º–µ—Å—Ç–æ 500), –Ω–æ app –≤—Å–µ —Ä–∞–≤–Ω–æ –ø–∞–¥–∞–µ—Ç  
**–í—ã–≤–æ–¥**: Backend fix –ø—Ä–∏–º–µ–Ω–∏–ª—Å—è, –Ω–æ –ø—Ä–æ–±–ª–µ–º–∞ –≥–ª—É–±–∂–µ

### –ü–æ–ø—ã—Ç–∫–∞ 3: Database verification ‚ùå
**–î–µ–π—Å—Ç–≤–∏–µ**: –£–±—Ä–∞–ª SQL –ø—Ä–æ–≤–µ—Ä–∫—É `column "token" does not exist`  
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: SQL –æ—à–∏–±–∫–∞ –∏—Å—á–µ–∑–ª–∞, –Ω–æ type cast –æ—à–∏–±–∫–∞ –æ—Å—Ç–∞–ª–∞—Å—å  
**–í—ã–≤–æ–¥**: –ü—Ä–æ–±–ª–µ–º–∞ –Ω–µ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

### –ü–æ–ø—ã—Ç–∫–∞ 4: AuthProvider line 107 ‚ùå
**–î–µ–π—Å—Ç–≤–∏–µ**: –ò—Å–ø—Ä–∞–≤–∏–ª –ª–æ–≥–∏–∫—É –≤ `checkAuthStatus()`  
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –¢–∞ –∂–µ –æ—à–∏–±–∫–∞  
**–í—ã–≤–æ–¥**: –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è

### –ü–æ–ø—ã—Ç–∫–∞ 5: AuthProvider line 258 ‚ùå
**–î–µ–π—Å—Ç–≤–∏–µ**: –ò—Å–ø—Ä–∞–≤–∏–ª –ª–æ–≥–∏–∫—É –≤ `refreshAccessToken()`  
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –¢–∞ –∂–µ –æ—à–∏–±–∫–∞  
**–í—ã–≤–æ–¥**: –ü—Ä–æ–±–ª–µ–º–∞ –Ω–µ –≤ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ

### –ü–æ–ø—ã—Ç–∫–∞ 6: Lines 170, 206 ‚ùå
**–î–µ–π—Å—Ç–≤–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∏–ª –¥—Ä—É–≥–∏–µ –º–µ—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è refreshToken  
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ö–æ–¥ –±—ã–ª –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π, –æ—Ç–∫–∞—Ç–∏–ª –∏–∑–º–µ–Ω–µ–Ω–∏—è  
**–í—ã–≤–æ–¥**: –ü—Ä–æ–±–ª–µ–º–∞ –≤ –¥—Ä—É–≥–æ–º –º–µ—Å—Ç–µ

### –ü–æ–ø—ã—Ç–∫–∞ 7: Response Model ‚úÖ –†–ï–®–ï–ù–ò–ï!
**–î–µ–π—Å—Ç–≤–∏–µ**: 
1. `grep_search` –¥–ª—è –ø–æ–∏—Å–∫–∞ Response –∫–ª–∞—Å—Å–æ–≤
2. –ù–∞—à–µ–ª `refreshToken: json['refreshToken'] as String` –≤ `telegram_auth_api_service.dart`
3. –ò–∑–º–µ–Ω–∏–ª –Ω–∞ `as String? ?? ''`
4. –î–æ–±–∞–≤–∏–ª smart reuse logic –≤ AuthProvider

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: 
```
‚úÖ [AUTH_PROVIDER] –¢–æ–∫–µ–Ω —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª—ë–Ω!
‚úÖ [AUTH_PROVIDER] –°—Ç–∞—Ç—É—Å: authenticated
‚úÖ [AUTH_SPLASH] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ HomeScreen
```

**–í—ã–≤–æ–¥**: –ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ **—Å–ª–æ–µ –ø–∞—Ä—Å–∏–Ω–≥–∞**, –∞ –Ω–µ –≤ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ!

---

## üí° –ö–ª—é—á–µ–≤—ã–µ –∏–Ω—Å–∞–π—Ç—ã

### 1. Type Safety –≤ Dart
```dart
// ‚ùå –ü–õ–û–•–û - —É–ø–∞–¥–µ—Ç –Ω–∞ null:
final value = json['key'] as String;

// ‚úÖ –•–û–†–û–®–û - null-safe —Å fallback:
final value = json['key'] as String? ?? '';
```

### 2. Backend API Design
–ï—Å–ª–∏ endpoint –º–æ–∂–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –ø–æ–ª–µ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ - **–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π —ç—Ç–æ**!

–õ—É—á—à–µ —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å –≤ OpenAPI/Swagger:
```yaml
refreshToken:
  type: string
  required: false  # ‚Üê –í–∞–∂–Ω–æ!
  description: "Returned only on initial login, not on refresh"
```

### 3. Debugging Strategy
**–ü–æ—Ä—è–¥–æ–∫ –æ—Ç–ª–∞–¥–∫–∏ –ø—Ä–∏ type cast –æ—à–∏–±–∫–∞—Ö:**
1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Response Model –∫–ª–∞—Å—Å
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ backend —Ä–µ–∞–ª—å–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç (curl/Postman)
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

**–ù–∞—à–∞ –æ—à–∏–±–∫–∞**: –ù–∞—á–∞–ª–∏ —Å –ø.3, –∞ –Ω–∞–¥–æ –±—ã–ª–æ —Å –ø.1!

### 4. Refresh Token Best Practices
- Refresh token - –¥–æ–ª–≥–æ–∂–∏–≤—É—â–∏–π (7-30 –¥–Ω–µ–π)
- Access token - –∫–æ—Ä–æ—Ç–∫–æ–∂–∏–≤—É—â–∏–π (15-60 –º–∏–Ω—É—Ç)
- –ü—Ä–∏ refresh endpoint:
  - ‚úÖ –í–°–ï–ì–î–ê –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –Ω–æ–≤—ã–π accessToken
  - ‚ö†Ô∏è –û–ü–¶–ò–û–ù–ê–õ–¨–ù–û –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –Ω–æ–≤—ã–π refreshToken (refresh token rotation)
  - ‚úÖ –ï—Å–ª–∏ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—à—å - –∫–ª–∏–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–π

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ß–µ–∫-–ª–∏—Å—Ç —É—Å–ø–µ—à–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

- [x] –ü–µ—Ä–≤—ã–π –ª–æ–≥–∏–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] –¢–æ–∫–µ–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ storage
- [x] –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Å—Ç–∞–µ—Ç—Å—è –∑–∞–ª–æ–≥–∏–Ω–µ–Ω
- [x] –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Å—Ç–∞–µ—Ç—Å—è –∑–∞–ª–æ–≥–∏–Ω–µ–Ω
- [x] Access token –∏—Å—Ç–µ–∫–∞–µ—Ç ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
- [x] Refresh token –∏—Å—Ç–µ–∫–∞–µ—Ç ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–∑–ª–æ–≥–∏–Ω–∏–≤–∞–µ—Ç—Å—è (–æ–∂–∏–¥–∞–µ–º–æ)

### –õ–æ–≥–∏ —É—Å–ø–µ—à–Ω–æ–≥–æ flow

```
[App Start]
üöÄ [AUTH_SPLASH] ========== –ù–ê–ß–ê–õ–û –ü–†–û–í–ï–†–ö–ò –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò ==========
üîç [AUTH_PROVIDER] ========== –ü–†–û–í–ï–†–ö–ê –°–¢–ê–¢–£–°–ê –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò ==========
‚úÖ [STORAGE] FlutterSecureStorage —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
üîç [STORAGE] hasTokens():
üîç [AUTH_PROVIDER] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤: hasTokens = true
üîç [AUTH_PROVIDER] RefreshToken: eyJhbGciOiJIUzI1NiIs...
üì° [AUTH_PROVIDER] –ü—ã—Ç–∞–µ–º—Å—è –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ /refresh...
‚úÖ [AUTH_PROVIDER] –¢–æ–∫–µ–Ω —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª—ë–Ω!
üíæ [STORAGE] –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω—ã:
‚úÖ [STORAGE] –¢–æ–∫–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
‚úÖ [AUTH_PROVIDER] –°—Ç–∞—Ç—É—Å: authenticated
üèÅ [AUTH_PROVIDER] –§–∏–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å: AuthStatus.authenticated
üîç [AUTH_SPLASH] AuthProvider.isAuthenticated: true
‚úÖ [AUTH_SPLASH] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ HomeScreen
üöÄ [AUTH_SPLASH] ========== –ó–ê–í–ï–†–®–ï–ù–ò–ï –ü–†–û–í–ï–†–ö–ò –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò ==========
```

---

## üìù –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

1. **lib/services/telegram_auth_api_service.dart**
   - –°—Ç—Ä–æ–∫–∞ 19: `as String` ‚Üí `as String? ?? ''`

2. **lib/providers/auth_provider.dart**
   - –°—Ç—Ä–æ–∫–∏ ~102-117: –î–æ–±–∞–≤–ª–µ–Ω–∞ smart reuse logic –≤ `checkAuthStatus()`
   - –°—Ç—Ä–æ–∫–∏ ~254-264: –î–æ–±–∞–≤–ª–µ–Ω–∞ smart reuse logic –≤ `refreshAccessToken()`

3. **backend/backend/routes/auth/refresh.dart** (–ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∏—Ç–µ—Ä–∞—Ü–∏–∏)
   - –î–æ–±–∞–≤–ª–µ–Ω try-catch –¥–ª—è empty body
   - –£–±—Ä–∞–Ω–∞ –ª–∏—à–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ –≤ –ë–î

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "–í—ã–π—Ç–∏" –≤ –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `logout()` –º–µ—Ç–æ–¥ –≤ AuthProvider
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö (Android/iOS)

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
- [ ] –£–±—Ä–∞—Ç—å –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ print() –∏–∑ production –∫–æ–¥–∞
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É (Firebase Analytics, Sentry)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Refresh Token Rotation (–¥–ª—è –ø–æ–≤—ã—à–µ–Ω–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è AuthProvider
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å API –≤ Swagger/OpenAPI

---

## üìö –°—Å—ã–ª–∫–∏

- [Dart Type Safety](https://dart.dev/language/type-system)
- [JWT Best Practices](https://tools.ietf.org/html/rfc8725)
- [OAuth 2.0 Token Refresh](https://oauth.net/2/grant-types/refresh-token/)
- [Flutter Secure Storage](https://pub.dev/packages/flutter_secure_storage)

---

**–ê–≤—Ç–æ—Ä**: GitHub Copilot  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 24 —è–Ω–≤–∞—Ä—è 2026 –≥.  
**–í–µ—Ä—Å–∏—è**: 1.0
