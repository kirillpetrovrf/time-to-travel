#!/bin/bash

# =============================================================
# –ú–ê–°–¢–ï–†-–°–ö–†–ò–ü–¢ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–ò –ú–ê–†–®–†–£–¢–û–í –í POSTGRESQL
# 
# –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
# 1. –ó–∞–≥—Ä—É–∑–∫–∞ –≥—Ä—É–ø–ø –º–∞—Ä—à—Ä—É—Ç–æ–≤ (10 —à—Ç—É–∫)
# 2. –ó–∞–≥—Ä—É–∑–∫–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤ (70+ —à—Ç—É–∫)
# 
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
#   export ADMIN_TOKEN='–≤–∞—à_jwt_—Ç–æ–∫–µ–Ω'
#   ./seed_all_routes.sh
# =============================================================

set -e

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

echo "==================================================="
echo "üöÄ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ú–ê–†–®–†–£–¢–û–í –í POSTGRESQL"
echo "==================================================="
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω
if [ -z "$ADMIN_TOKEN" ]; then
    echo "‚ùå –û–®–ò–ë–ö–ê: –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é ADMIN_TOKEN"
    echo ""
    echo "==================================================="
    echo "üìã –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –ü–û–õ–£–ß–ï–ù–ò–Æ –¢–û–ö–ï–ù–ê:"
    echo "==================================================="
    echo ""
    echo "–í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ Flutter DevTools"
    echo "  1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏"
    echo "  2. –í–æ–π–¥–∏—Ç–µ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä (–¥–∏—Å–ø–µ—Ç—á–µ—Ä)"
    echo "  3. –û—Ç–∫—Ä–æ–π—Ç–µ Flutter DevTools"
    echo "  4. –ù–∞–π–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –≤ SharedPreferences (–∫–ª—é—á: jwt_token)"
    echo ""
    echo "–í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ –ª–æ–≥–∏"
    echo "  1. –î–æ–±–∞–≤—å—Ç–µ print –≤ AuthService –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ"
    echo "  2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ JWT —Ç–æ–∫–µ–Ω –∏–∑ –ª–æ–≥–æ–≤"
    echo ""
    echo "–í–∞—Ä–∏–∞–Ω—Ç 3: –ß–µ—Ä–µ–∑ –ø—Ä—è–º–æ–π API-–∑–∞–ø—Ä–æ—Å"
    echo "  curl -X POST https://titotr.ru/api/auth/telegram/init \\"
    echo "    -H 'Content-Type: application/json' \\"
    echo "    -d '{\"initData\": \"...\"}'"
    echo ""
    echo "–ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞:"
    echo "  export ADMIN_TOKEN='eyJ...(–≤–∞—à —Ç–æ–∫–µ–Ω)...'"
    echo "  ./seed_all_routes.sh"
    echo ""
    exit 1
fi

# –î–µ–ª–∞–µ–º —Å–∫—Ä–∏–ø—Ç—ã –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º–∏
chmod +x "$SCRIPT_DIR/seed_route_groups.sh" 2>/dev/null || true
chmod +x "$SCRIPT_DIR/seed_routes.sh" 2>/dev/null || true

# –®–∞–≥ 1: –ó–∞–≥—Ä—É–∂–∞–µ–º –≥—Ä—É–ø–ø—ã
echo ""
echo "üì¶ –®–ê–ì 1/2: –ó–∞–≥—Ä—É–∑–∫–∞ –≥—Ä—É–ø–ø –º–∞—Ä—à—Ä—É—Ç–æ–≤..."
echo "---------------------------------------------------"
bash "$SCRIPT_DIR/seed_route_groups.sh"

# –ù–µ–±–æ–ª—å—à–∞—è –ø–∞—É–∑–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
sleep 1

# –®–∞–≥ 2: –ó–∞–≥—Ä—É–∂–∞–µ–º –º–∞—Ä—à—Ä—É—Ç—ã
echo ""
echo "üì¶ –®–ê–ì 2/2: –ó–∞–≥—Ä—É–∑–∫–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤..."
echo "---------------------------------------------------"
bash "$SCRIPT_DIR/seed_routes.sh"

echo ""
echo "==================================================="
echo "‚úÖ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê –£–°–ü–ï–®–ù–û!"
echo "==================================================="
echo ""
echo "–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ:"
echo "  1. –û—Ç–∫—Ä—ã—Ç—å —Ä–∞–∑–¥–µ–ª '–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ü–µ–Ω—ã' –≤ –¥–∏—Å–ø–µ—Ç—á–µ—Ä—Å–∫–æ–π –ø–∞–Ω–µ–ª–∏"
echo "  2. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å–µ 70+ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è"
echo "  3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ –≥—Ä—É–ø–ø–∞–º"
echo ""
