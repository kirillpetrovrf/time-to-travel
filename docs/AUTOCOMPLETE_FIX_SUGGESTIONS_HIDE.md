# üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –ü–æ–¥—Å–∫–∞–∑–∫–∏ –Ω–µ —Å–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –∞–¥—Ä–µ—Å–∞

**–î–∞—Ç–∞:** 13 –Ω–æ—è–±—Ä—è 2024  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

## –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –∞–¥—Ä–µ—Å–∞ –∏–∑ —Å–ø–∏—Å–∫–∞ –ø–æ–¥—Å–∫–∞–∑–æ–∫, —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–¥–æ–ª–∂–∞–ª –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è –∏ –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è:

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç: "Donetsk, Rostov Region, prospekt Lenina, 15"
‚Üì
–¢–µ–∫—Å—Ç –≤ –ø–æ–ª–µ –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å
‚Üì
_onTextChanged() —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
‚Üì
–ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π –ø–æ–∏—Å–∫ —Å –ø–æ–ª–Ω—ã–º –∞–¥—Ä–µ—Å–æ–º
‚Üì
–ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –ø–æ–¥—Å–∫–∞–∑–∫–∏ —Å–Ω–æ–≤–∞!
```

**–õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏:**
```
üìç –í—ã–±—Ä–∞–Ω: Donetsk, Rostov Region, prospekt Lenina, 15
üîç [AUTOCOMPLETE] –ü–æ–∏—Å–∫: "–î–æ–Ω–µ—Ü–∫, Donetsk, Rostov Region, prospekt Lenina, 15"
‚úÖ [AUTOCOMPLETE] –ù–∞–π–¥–µ–Ω–æ 3 –ø–æ–¥—Å–∫–∞–∑–æ–∫
```

## –ü—Ä–∏—á–∏–Ω–∞

–ü—Ä–∏ –≤—ã–±–æ—Ä–µ –∞–¥—Ä–µ—Å–∞ –∏–∑ –ø–æ–¥—Å–∫–∞–∑–∫–∏:
1. `_controller.text = address;` –º–µ–Ω—è–µ—Ç —Ç–µ–∫—Å—Ç –≤ –ø–æ–ª–µ
2. –≠—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç `_onTextChanged()` (—Ç.–∫. —Å–ª—É—à–∞—Ç–µ–ª—å –Ω–∞ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ)
3. `_onTextChanged()` –∑–∞–ø—É—Å–∫–∞–µ—Ç –Ω–æ–≤—ã–π –ø–æ–∏—Å–∫ –ø–æ–¥—Å–∫–∞–∑–æ–∫
4. –¶–∏–∫–ª –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—ã–±–æ—Ä–µ

## –†–µ—à–µ–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω —Ñ–ª–∞–≥ `_isProgrammaticChange` –¥–ª—è —Ä–∞–∑–ª–∏—á–µ–Ω–∏—è:
- **–†—É—á–Ω–æ–π –≤–≤–æ–¥** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí –∑–∞–ø—É—Å–∫–∞—Ç—å –ø–æ–∏—Å–∫
- **–ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ** –ø—Ä–∏ –≤—ã–±–æ—Ä–µ ‚Üí –ù–ï –∑–∞–ø—É—Å–∫–∞—Ç—å –ø–æ–∏—Å–∫

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

**1. –î–æ–±–∞–≤–ª–µ–Ω —Ñ–ª–∞–≥:**
```dart
class _AddressAutocompleteFieldState extends State<AddressAutocompleteField> {
  // ...
  bool _isProgrammaticChange = false; // ‚Üê –ù–æ–≤—ã–π —Ñ–ª–∞–≥
```

**2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ _onTextChanged:**
```dart
void _onTextChanged() {
  // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–º –≤—ã–±–æ—Ä–µ –∞–¥—Ä–µ—Å–∞
  if (_isProgrammaticChange) {
    return;
  }
  
  final text = _controller.text.trim();
  // ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞
}
```

**3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–ª–∞–≥–∞ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ:**
```dart
void _onSuggestionSelected(SuggestItem item) {
  final address = _formatAddress(item);
  
  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º —Ç–µ–∫—Å—Ç–∞
  _isProgrammaticChange = true;
  
  setState(() {
    _controller.text = address;
    _showSuggestions = false;
    _suggestions.clear(); // ‚Üê –¢–∞–∫–∂–µ –æ—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫
  });
  
  // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –ø–æ—Å–ª–µ –∫–æ—Ä–æ—Ç–∫–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏
  Future.delayed(const Duration(milliseconds: 100), () {
    _isProgrammaticChange = false;
  });
  
  // ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞
}
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç

**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```
üìç –í—ã–±—Ä–∞–Ω: Donetsk, prospekt Lenina, 15
üîç [AUTOCOMPLETE] –ü–æ–∏—Å–∫: "–î–æ–Ω–µ—Ü–∫, Donetsk, prospekt Lenina, 15"
‚úÖ [AUTOCOMPLETE] –ù–∞–π–¥–µ–Ω–æ 3 –ø–æ–¥—Å–∫–∞–∑–æ–∫
üìç –í—ã–±—Ä–∞–Ω: Donetsk, prospekt Lenina, 15 (—Å–Ω–æ–≤–∞)
üîç [AUTOCOMPLETE] –ü–æ–∏—Å–∫: "–î–æ–Ω–µ—Ü–∫, Donetsk, prospekt Lenina, 15" (—Å–Ω–æ–≤–∞)
... (–±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª)
```

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```
üìç –í—ã–±—Ä–∞–Ω: Donetsk, prospekt Lenina, 15
‚úÖ –ü–æ–¥—Å–∫–∞–∑–∫–∏ —Å–∫—Ä—ã—Ç—ã
‚úÖ –ü–æ–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ
‚úÖ –ì–æ—Ç–æ–≤–æ!
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
flutter run
```

### –°—Ü–µ–Ω–∞—Ä–∏–π –ø—Ä–æ–≤–µ—Ä–∫–∏:
1. ‚úÖ –û—Ç–∫—Ä—ã—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä
2. ‚úÖ –í—ã–±—Ä–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç (–î–æ–Ω–µ—Ü–∫ ‚Üí –†–æ—Å—Ç–æ–≤)
3. ‚úÖ –ù–∞—á–∞—Ç—å –≤–≤–æ–¥–∏—Ç—å –∞–¥—Ä–µ—Å –≤ –ø–æ–ª–µ "–æ—Ç–∫—É–¥–∞"
4. ‚úÖ –£–≤–∏–¥–µ—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏
5. ‚úÖ –í—ã–±—Ä–∞—Ç—å –∞–¥—Ä–µ—Å –∏–∑ –ø–æ–¥—Å–∫–∞–∑–æ–∫
6. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –ø–æ–¥—Å–∫–∞–∑–∫–∏ –¥–æ–ª–∂–Ω—ã –∏—Å—á–µ–∑–Ω—É—Ç—å!**
7. ‚úÖ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –¥–ª—è –ø–æ–ª—è "–∫—É–¥–∞"

### –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:
- –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä—É—á–Ω–æ–º –≤–≤–æ–¥–µ
- –ü—Ä–∏ –≤—ã–±–æ—Ä–µ –∞–¥—Ä–µ—Å–∞ —Å–ø–∏—Å–æ–∫ —Å—Ä–∞–∑—É —Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è
- –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –ù–ï –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
- –ú–æ–∂–Ω–æ —Å–Ω–æ–≤–∞ –≤—Ä—É—á–Ω—É—é —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–µ

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

–í –º–µ—Ç–æ–¥–µ `_onSuggestionSelected` —Ç–∞–∫–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ:
```dart
_suggestions.clear(); // –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–¥—Å–∫–∞–∑–æ–∫
```

–≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –¥–∞–∂–µ –µ—Å–ª–∏ UI –Ω–µ —É—Å–ø–µ–µ—Ç –æ–±–Ω–æ–≤–∏—Ç—å—Å—è, —Å–ø–∏—Å–æ–∫ –±—É–¥–µ—Ç –ø—É—Å—Ç.

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

- `lib/widgets/address_autocomplete_field.dart` (3 –∏–∑–º–µ–Ω–µ–Ω–∏—è)

## Commit

```bash
git add lib/widgets/address_autocomplete_field.dart
git commit -m "fix: Hide suggestions immediately after address selection

- Add _isProgrammaticChange flag to prevent search on selection
- Clear suggestions list when address is selected
- Reset flag after 100ms delay to allow manual editing again"
```

---

**–°–ø–∞—Å–∏–±–æ –∑–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ! –¢–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –Ω–∞–¥–æ! üéâ**
