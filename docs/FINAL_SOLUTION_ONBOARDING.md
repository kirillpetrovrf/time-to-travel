# ‚úÖ –§–ò–ù–ê–õ–¨–ù–û–ï –†–ï–®–ï–ù–ò–ï: Onboarding –ø–æ–¥—Å–∫–∞–∑–∫–∞

**–î–∞—Ç–∞**: 4 –¥–µ–∫–∞–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫ –≤–Ω–µ–¥—Ä–µ–Ω–∏—é

---

## üìã –ö–æ–Ω—Ç–µ–∫—Å—Ç

–ü–æ—Å–ª–µ **7 –ø—Ä–æ–≤–∞–ª–∏–≤—à–∏—Ö—Å—è –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ Yandex MapKit –¥–ª—è autocomplete callbacks, –æ—á–µ–≤–∏–¥–Ω–æ, —á—Ç–æ:

1. **MapKit —Ç—Ä–µ–±—É–µ—Ç –í–ò–î–ò–ú–£–Æ –∫–∞—Ä—Ç—É** –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ callbacks
2. **–ù–∏–∫–∞–∫–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–µ —Ö–∞–∫–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç**:
   - Invisible maps (1x1, 100x100)
   - Pre-warm –Ω–∞ SplashScreen
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤–∏–∑–∏—Ç —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏ 500ms-2000ms
   - –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ
3. **–†—É—á–Ω–æ–π –≤–∏–∑–∏—Ç –í–°–ï–ì–î–ê —Ä–∞–±–æ—Ç–∞–µ—Ç** ‚Äî –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –∑–Ω–∞–Ω–∏—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## üí° –†–µ—à–µ–Ω–∏–µ: Onboarding –ø–æ–¥—Å–∫–∞–∑–∫–∞

**–í–º–µ—Å—Ç–æ –±–æ—Ä—å–±—ã —Å API, –Ω–∞—É—á–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!**

–ü–æ–∫–∞–∑–∞—Ç—å **–æ–¥–Ω–æ—Ä–∞–∑–æ–≤—É—é –ø–æ–¥—Å–∫–∞–∑–∫—É –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ**:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!                ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ  –î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –ø–æ–∏—Å–∫–∞        ‚îÇ
‚îÇ  –∞–¥—Ä–µ—Å–æ–≤, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–µ—Ä–µ–π–¥–∏—Ç–µ      ‚îÇ
‚îÇ  –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–ö–∞—Ä—Ç–∞" –æ–¥–∏–Ω —Ä–∞–∑.        ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ  [–ü–æ–Ω—è—Ç–Ω–æ, –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ –∫–∞—Ä—Ç—É ‚Üí]      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è** ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º –Ω–∞ MainScreen (–∫–∞—Ä—Ç—É), –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –∫–∞—Ä—Ç—É, –≤—Å—ë –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è, –≥–æ—Ç–æ–≤–æ!

---

## üîß –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

### 1. –°–æ–∑–¥–∞—Ç—å Onboarding –≤–∏–¥–∂–µ—Ç

**–§–∞–π–ª**: `lib/widgets/mapkit_onboarding_dialog.dart`

```dart
import 'package:flutter/cupertino.dart';
import 'package:shared_preferences/shared_preferences.dart';

class MapKitOnboardingDialog extends StatelessWidget {
  final VoidCallback onComplete;

  const MapKitOnboardingDialog({
    Key? key,
    required this.onComplete,
  }) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return CupertinoAlertDialog(
      title: const Text('üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!'),
      content: const Padding(
        padding: EdgeInsets.only(top: 8.0),
        child: Text(
          '–î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –ø–æ–∏—Å–∫–∞ –∞–¥—Ä–µ—Å–æ–≤, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, '
          '–ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–ö–∞—Ä—Ç–∞" –æ–¥–∏–Ω —Ä–∞–∑.\n\n'
          '–≠—Ç–æ –∑–∞–π–º—ë—Ç –≤—Å–µ–≥–æ —Å–µ–∫—É–Ω–¥—É!',
          style: TextStyle(fontSize: 14),
        ),
      ),
      actions: [
        CupertinoDialogAction(
          isDefaultAction: true,
          onPressed: () async {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–ª–∞–≥
            final prefs = await SharedPreferences.getInstance();
            await prefs.setBool('has_seen_mapkit_onboarding', true);
            
            Navigator.of(context).pop();
            onComplete();
          },
          child: const Text('–ü–æ–Ω—è—Ç–Ω–æ, –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ –∫–∞—Ä—Ç—É'),
        ),
      ],
    );
  }

  /// –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω—É–∂–Ω–æ –ª–∏ –ø–æ–∫–∞–∑–∞—Ç—å onboarding
  static Future<bool> shouldShow() async {
    final prefs = await SharedPreferences.getInstance();
    return !(prefs.getBool('has_seen_mapkit_onboarding') ?? false);
  }
}
```

---

### 2. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ HomeScreen

**–§–∞–π–ª**: `lib/features/home/screens/home_screen.dart`

**–î–æ–±–∞–≤–∏—Ç—å –≤ initState():**

```dart
@override
void initState() {
  super.initState();
  _loadUserType();
  _restoreLastTab();
  _showOnboardingIfNeeded(); // ‚Üê –ù–û–í–´–ô –ú–ï–¢–û–î
}

Future<void> _showOnboardingIfNeeded() async {
  // –¢–æ–ª—å–∫–æ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤
  if (_userType != UserType.client) return;
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –ø–æ–∫–∞–∑–∞—Ç—å
  final shouldShow = await MapKitOnboardingDialog.shouldShow();
  if (!shouldShow) return;
  
  // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ —á—Ç–æ–±—ã UI –æ—Ç—Ä–∏—Å–æ–≤–∞–ª—Å—è
  await Future.delayed(const Duration(milliseconds: 500));
  
  if (!mounted) return;
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∏–∞–ª–æ–≥
  showCupertinoDialog(
    context: context,
    barrierDismissible: false, // –ù–µ–ª—å–∑—è –∑–∞–∫—Ä—ã—Ç—å —Å–ª—É—á–∞–π–Ω–æ
    builder: (context) => MapKitOnboardingDialog(
      onComplete: () {
        // –ü–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è "–ü–æ–Ω—è—Ç–Ω–æ" ‚Üí –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –∫–∞—Ä—Ç—É
        setState(() {
          _currentIndex = 1; // MainScreen
        });
      },
    ),
  );
}
```

---

### 3. –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–π –∫–æ–¥ Variant 7

**–£–¥–∞–ª–∏—Ç—å –º–µ—Ç–æ–¥** `_autoVisitMapIfNeeded()` –∏–∑ `home_screen.dart` ‚Äî –æ–Ω –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω.

**–£–¥–∞–ª–∏—Ç—å –≤—ã–∑–æ–≤** –∏–∑ `_loadUserType()`:

```dart
Future<void> _loadUserType() async {
  final userType = await AuthService.instance.getUserType();
  setState(() {
    _userType = userType;
  });
  // –£–î–ê–õ–ò–¢–¨: await _autoVisitMapIfNeeded();
}
```

---

## üé® UX Flow

### –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫:

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**
2. **–ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è HomeScreen** (BookingScreen –≤–∏–¥–Ω–æ)
3. **–ß–µ—Ä–µ–∑ 500ms –ø–æ—è–≤–ª—è–µ—Ç—Å—è –¥–∏–∞–ª–æ–≥** —Å –ø–æ–¥—Å–∫–∞–∑–∫–æ–π
4. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —á–∏—Ç–∞–µ—Ç** ‚Üí –Ω–∞–∂–∏–º–∞–µ—Ç "–ü–æ–Ω—è—Ç–Ω–æ, –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ –∫–∞—Ä—Ç—É"
5. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ** –Ω–∞ MainScreen (–∫–∞—Ä—Ç–∞)
6. **–ö–∞—Ä—Ç–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è** ‚Üí MapKit –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è
7. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å—Å—è** –Ω–∞ BookingScreen
8. **Autocomplete —Ä–∞–±–æ—Ç–∞–µ—Ç** –Ω–∞–≤—Å–µ–≥–¥–∞!

### –í—Ç–æ—Ä–æ–π –∏ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—É—Å–∫–∏:

- **–î–∏–∞–ª–æ–≥ –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è** (—Ñ–ª–∞–≥ `has_seen_mapkit_onboarding` = true)
- **Autocomplete —Ä–∞–±–æ—Ç–∞–µ—Ç** —Å—Ä–∞–∑—É (MapKit —É–∂–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω)

---

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **100% –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å** ‚Äî —Ä—É—á–Ω–æ–π –≤–∏–∑–∏—Ç –í–°–ï–ì–î–ê —Ä–∞–±–æ—Ç–∞–µ—Ç
2. **UX –ø—Ä–æ–∑—Ä–∞—á–µ–Ω** ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–Ω–∏–º–∞–µ—Ç, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç
3. **–û–¥–Ω–æ—Ä–∞–∑–æ–≤–æ** ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ 1 —Ä–∞–∑
4. **–ù–µ —Ä–∞–∑–¥—Ä–∞–∂–∞–µ—Ç** ‚Äî –ø—Ä–æ—Å—Ç–æ–π –∏ –±—ã—Å—Ç—Ä—ã–π –ø—Ä–æ—Ü–µ—Å—Å
5. **–ù–µ—Ç —Ö–∞–∫–æ–≤** ‚Äî —á–µ—Å—Ç–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –≤–º–µ—Å—Ç–æ –±–æ—Ä—å–±—ã —Å API

---

## ‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏

- **–¢—Ä–µ–±—É–µ—Ç 1 –¥–µ–π—Å—Ç–≤–∏–µ** –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–æ –æ–Ω–æ –ø–æ–Ω—è—Ç–Ω–æ–µ –∏ –±—ã—Å—Ç—Ä–æ–µ)
- **–ù–∞ 0.5-1 —Å–µ–∫—É–Ω–¥—É –¥–æ–ª—å—à–µ** –ø–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫

---

## üÜö –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã

### –í–∞—Ä–∏–∞–Ω—Ç A: "–¢–∏—Ö–∏–π" onboarding

**–ë–µ–∑ –¥–∏–∞–ª–æ–≥–∞**, –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑–∞—Ç—å **hint —Å–Ω–∏–∑—É**:

```dart
// –í–º–µ—Å—Ç–æ –¥–∏–∞–ª–æ–≥–∞ ‚Äî SnackBar –∏–ª–∏ Banner
ScaffoldMessenger.of(context).showSnackBar(
  SnackBar(
    content: Text('üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞: –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–ö–∞—Ä—Ç–∞" –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø–æ–∏—Å–∫–∞'),
    action: SnackBarAction(
      label: '–ü–µ—Ä–µ–π—Ç–∏',
      onPressed: () {
        setState(() => _currentIndex = 1);
      },
    ),
    duration: Duration(seconds: 10),
  ),
);
```

**–ü–ª—é—Å—ã**: –ú–µ–Ω–µ–µ –Ω–∞–≤—è–∑—á–∏–≤–æ  
**–ú–∏–Ω—É—Å—ã**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å

---

### –í–∞—Ä–∏–∞–Ω—Ç B: –í–æ–æ–±—â–µ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å

–ü—Ä–æ—Å—Ç–æ **–¥–æ–±–∞–≤–∏—Ç—å –≤ FAQ** –∏–ª–∏ **—ç–∫—Ä–∞–Ω —Å–ø—Ä–∞–≤–∫–∏**:

> "–ï—Å–ª–∏ –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–æ–≤ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É '–ö–∞—Ä—Ç–∞' –æ–¥–∏–Ω —Ä–∞–∑."

**–ü–ª—é—Å—ã**: –ù–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ UI  
**–ú–∏–Ω—É—Å—ã**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±—É–¥—É—Ç –∂–∞–ª–æ–≤–∞—Ç—å—Å—è –Ω–∞ –±–∞–≥

---

### –í–∞—Ä–∏–∞–Ω—Ç C: –ù–∞–ø–∏—Å–∞—Ç—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É Yandex

**–û—Ç–∫—Ä—ã—Ç—å —Ç–∏–∫–µ—Ç** —Å –≤–æ–ø—Ä–æ—Å–æ–º:

> "–ü–æ—á–µ–º—É SearchSuggestSession callbacks –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è YandexMap? –ï—Å—Ç—å –ª–∏ API –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–π –∞–∫—Ç–∏–≤–∞—Ü–∏–∏?"

**–ü–ª—é—Å—ã**: –í–æ–∑–º–æ–∂–Ω–æ, –µ—Å—Ç—å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ  
**–ú–∏–Ω—É—Å—ã**: –û—Ç–≤–µ—Ç –º–æ–∂–µ—Ç –ø—Ä–∏–π—Ç–∏ —á–µ—Ä–µ–∑ –Ω–µ–¥–µ–ª–∏/–º–µ—Å—è—Ü—ã

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**–í–∞—Ä–∏–∞–Ω—Ç —Å Onboarding –¥–∏–∞–ª–æ–≥–æ–º** ‚Äî –ª—É—á—à–∏–π –±–∞–ª–∞–Ω—Å:

- ‚úÖ –†–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –Ω–∞–≤—Å–µ–≥–¥–∞
- ‚úÖ –ü–æ–Ω—è—Ç–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç –±–æ—Ä—å–±—ã —Å API
- ‚úÖ –õ–µ–≥–∫–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å (~50 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞)

**–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ** –º–æ–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å –≤ Yandex ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ, –≤ –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö MapKit –ø–æ—è–≤–∏—Ç—Å—è fix.

---

## üìä –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–≤–∞–ª–æ–≤ (–¥–ª—è —Å–ø—Ä–∞–≤–∫–∏)

| Variant | –ü–æ–¥—Ö–æ–¥ | –†–µ–∑—É–ª—å—Ç–∞—Ç | –ü—Ä–∏—á–∏–Ω–∞ |
|---------|--------|-----------|---------|
| 1 | SearchManager singleton | ‚ùå –ü—Ä–æ–≤–∞–ª | Callbacks –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä—É—é—Ç—Å—è |
| 4 | 1x1 invisible map BookingScreen | ‚ùå –ü—Ä–æ–≤–∞–ª | –ö–∞—Ä—Ç–∞ —Å–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–∞—è |
| 4.1 | 100x100 invisible map | ‚ùå –ü—Ä–æ–≤–∞–ª | –í—Å—ë –µ—â—ë —Å–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–∞—è |
| 5 | SplashScreen pre-warm | ‚ùå –ü—Ä–æ–≤–∞–ª | –ö–æ–¥ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è |
| 5 reinstall | –¢–æ –∂–µ + –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ | ‚ùå –ü—Ä–æ–≤–∞–ª | –¢–∞ –∂–µ –ø—Ä–∏—á–∏–Ω–∞ |
| 6 v1 | –ê–≤—Ç–æ-–≤–∏–∑–∏—Ç MainScreen | ‚ùå –ü—Ä–æ–≤–∞–ª | Race condition –≤ initState() |
| 6 v2 | –ê–≤—Ç–æ-–≤–∏–∑–∏—Ç (race fix) | ‚ùå –ü—Ä–æ–≤–∞–ª | Callbacks –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç |
| 7 | –ê–≤—Ç–æ-–≤–∏–∑–∏—Ç (2 —Å–µ–∫) | ‚ùå –ù–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω | –§–ª–∞–≥ –Ω–µ —Å–±—Ä–æ—à–µ–Ω |

**–í—ã–≤–æ–¥**: –ù–∏–∫–∞–∫–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç. MapKit —Ç—Ä–µ–±—É–µ—Ç –†–ï–ê–õ–¨–ù–û–ì–û –≤–∏–∑–∏—Ç–∞ –Ω–∞ –í–ò–î–ò–ú–£–Æ –∫–∞—Ä—Ç—É.

---

## üìù –ö–æ–¥ –¥–ª—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å –≤–∏–¥–∂–µ—Ç

```bash
# –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª
touch lib/widgets/mapkit_onboarding_dialog.dart
```

**–í—Å—Ç–∞–≤–∏—Ç—å –∫–æ–¥** –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ "–†–µ–∞–ª–∏–∑–∞—Ü–∏—è ‚Üí 1. –°–æ–∑–¥–∞—Ç—å Onboarding –≤–∏–¥–∂–µ—Ç"

---

### –®–∞–≥ 2: –û–±–Ω–æ–≤–∏—Ç—å HomeScreen

**–§–∞–π–ª**: `lib/features/home/screens/home_screen.dart`

1. –î–æ–±–∞–≤–∏—Ç—å import:
```dart
import '../../../widgets/mapkit_onboarding_dialog.dart';
```

2. –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `_showOnboardingIfNeeded()` (–∫–æ–¥ –≤—ã—à–µ)

3. –í—ã–∑–≤–∞—Ç—å –≤ `initState()`:
```dart
_showOnboardingIfNeeded();
```

4. –£–¥–∞–ª–∏—Ç—å `_autoVisitMapIfNeeded()` –∏ –µ–≥–æ –≤—ã–∑–æ–≤

---

### –®–∞–≥ 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **–£–¥–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** (—á—Ç–æ–±—ã —Å–±—Ä–æ—Å–∏—Ç—å —Ñ–ª–∞–≥)
2. **–ó–∞–ø—É—Å—Ç–∏—Ç—å** `flutter run`
3. **–í–æ–π—Ç–∏ –∫–∞–∫ –∫–ª–∏–µ–Ω—Ç**
4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**: –¥–∏–∞–ª–æ–≥ –ø–æ—è–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ 500ms
5. **–ù–∞–∂–∞—Ç—å** "–ü–æ–Ω—è—Ç–Ω–æ, –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ –∫–∞—Ä—Ç—É"
6. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ MainScreen
7. **–í–µ—Ä–Ω—É—Ç—å—Å—è** –Ω–∞ BookingScreen
8. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** autocomplete ‚Üí –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å!

---

## ‚úÖ –ì–æ—Ç–æ–≤–æ!

**–ü—Ä–æ—Å—Ç–æ–µ, –Ω–∞–¥—ë–∂–Ω–æ–µ, –ø–æ–Ω—è—Ç–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ** –≤–º–µ—Å—Ç–æ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤ —Å API.

**–ï—Å–ª–∏ Yandex –≤—ã–ø—É—Å—Ç–∏—Ç fix** –≤ –±—É–¥—É—â–µ–º ‚Üí –ø—Ä–æ—Å—Ç–æ —É–¥–∞–ª–∏–º onboarding. –î–æ —Ç–µ—Ö –ø–æ—Ä ‚Äî —ç—Ç–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Ä–∞–±–æ—á–∏–π –≤–∞—Ä–∏–∞–Ω—Ç.

---

## üîó –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

- **7 –ø—Ä–æ–≤–∞–ª–∏–≤—à–∏—Ö—Å—è –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤**: –°–º. —Ñ–∞–π–ª—ã VARIANT_*.md
- **Race condition fix**: VARIANT_6_AUTO_VISIT_MAP.md
- **Yandex MapKit docs**: https://yandex.ru/dev/mapkit/

**–í–æ–ø—Ä–æ—Å—ã?** ‚Üí –ü–∏—à–∏—Ç–µ –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É Yandex —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø—Ä–æ–±–ª–µ–º—ã.
