# üöÄ –ü–ª–∞–Ω –ú–∏–≥—Ä–∞—Ü–∏–∏ Time to Travel: Firebase ‚Üí Dart Frog

**–ü—Ä–æ–µ–∫—Ç:** Time to Travel (titotr.ru)  
**–î–∞—Ç–∞ —Å—Ç–∞—Ä—Ç–∞:** 21 —è–Ω–≤–∞—Ä—è 2026  
**–û–±—â–µ–µ –≤—Ä–µ–º—è:** 10-16 –¥–Ω–µ–π  
**–°—Ç–∞—Ç—É—Å:** üü° –í –ø—Ä–æ—Ü–µ—Å—Å–µ

---

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–≠—Ç–∞–ø 0: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ](#—ç—Ç–∞–ø-0-–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-–∏-–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)
2. [–≠—Ç–∞–ø 1: –ê—Ä–µ–Ω–¥–∞ –∏ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –°–µ—Ä–≤–µ—Ä–∞](#—ç—Ç–∞–ø-1-–∞—Ä–µ–Ω–¥–∞-–∏-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-—Å–µ—Ä–≤–µ—Ä–∞)
3. [–≠—Ç–∞–ø 2: DNS –∏ –î–æ–º–µ–Ω](#—ç—Ç–∞–ø-2-dns-–∏-–¥–æ–º–µ–Ω)
4. [–≠—Ç–∞–ø 3: SSH –∏ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#—ç—Ç–∞–ø-3-ssh-–∏-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
5. [–≠—Ç–∞–ø 4: Docker –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞](#—ç—Ç–∞–ø-4-docker-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
6. [–≠—Ç–∞–ø 5: PostgreSQL –°—Ö–µ–º–∞](#—ç—Ç–∞–ø-5-postgresql-—Å—Ö–µ–º–∞)
7. [–≠—Ç–∞–ø 6: Dart Frog Backend](#—ç—Ç–∞–ø-6-dart-frog-backend)
8. [–≠—Ç–∞–ø 7: JWT Authentication](#—ç—Ç–∞–ø-7-jwt-authentication)
9. [–≠—Ç–∞–ø 8: API Endpoints](#—ç—Ç–∞–ø-8-api-endpoints)
10. [–≠—Ç–∞–ø 9: Nginx –∏ SSL](#—ç—Ç–∞–ø-9-nginx-–∏-ssl)
11. [–≠—Ç–∞–ø 10: –ú–∏–≥—Ä–∞—Ü–∏—è –î–∞–Ω–Ω—ã—Ö](#—ç—Ç–∞–ø-10-–º–∏–≥—Ä–∞—Ü–∏—è-–¥–∞–Ω–Ω—ã—Ö)
12. [–≠—Ç–∞–ø 11: Flutter Integration](#—ç—Ç–∞–ø-11-flutter-integration)
13. [–≠—Ç–∞–ø 12: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—ç—Ç–∞–ø-12-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
14. [–≠—Ç–∞–ø 13: Production Deploy](#—ç—Ç–∞–ø-13-production-deploy)
15. [–≠—Ç–∞–ø 14: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥](#—ç—Ç–∞–ø-14-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
16. [–≠—Ç–∞–ø 15: –û—Ç–∫–ª—é—á–µ–Ω–∏–µ Firebase](#—ç—Ç–∞–ø-15-–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ-firebase)

---

## –≠—Ç–∞–ø 0: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

**–í—Ä–µ–º—è:** 1 –¥–µ–Ω—å  
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –ù–µ –Ω–∞—á–∞—Ç

### –ó–∞–¥–∞—á–∏:

- [ ] **0.1** –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö Firebase
  ```bash
  # Firebase Console -> Project Settings -> Service Accounts
  # Download private key –¥–ª—è admin SDK
  ```

- [ ] **0.2** –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ Firestore
  ```bash
  firebase firestore:export gs://time-to-travel.appspot.com/backup-$(date +%Y%m%d)
  ```

- [ ] **0.3** –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π Firebase Auth
  ```bash
  # –ß–µ—Ä–µ–∑ Firebase Console –∏–ª–∏ Admin SDK
  # –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ CSV/JSON
  ```

- [ ] **0.4** –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–µ API endpoints Firebase
  - –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö Cloud Functions
  - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö Firestore
  - Firestore Security Rules

- [ ] **0.5** –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
  ```bash
  # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
  brew install dart
  dart pub global activate dart_frog_cli
  brew install postgresql@15
  brew install redis
  ```

- [ ] **0.6** –°–æ–∑–¥–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–ª—è backend
  ```bash
  cd /Users/kirillpetrov/Projects/time-to-travel
  mkdir backend
  cd backend
  dart_frog create .
  git init
  git add .
  git commit -m "Initial Dart Frog setup"
  ```

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
‚úÖ –ü–æ–ª–Ω—ã–π –±—ç–∫–∞–ø –¥–∞–Ω–Ω—ã—Ö Firebase  
‚úÖ –õ–æ–∫–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ  
‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ backend –ø—Ä–æ–µ–∫—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞

---

## –≠—Ç–∞–ø 1: –ê—Ä–µ–Ω–¥–∞ –∏ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –°–µ—Ä–≤–µ—Ä–∞

**–í—Ä–µ–º—è:** 0.5 –¥–Ω—è  
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –ù–µ –Ω–∞—á–∞—Ç

### –ó–∞–¥–∞—á–∏:

- [ ] **1.1** –ê—Ä–µ–Ω–¥–æ–≤–∞—Ç—å VPS –Ω–∞ Selectel
  - –í–æ–π—Ç–∏ –≤ [my.selectel.ru](https://my.selectel.ru)
  - –í—ã–±—Ä–∞—Ç—å "–û–±–ª–∞—á–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞" ‚Üí "–°–µ—Ä–≤–µ—Ä—ã"
  - **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Å—Ç–∞—Ä—Ç–∞:**
    - CPU: 2 vCPU
    - RAM: 4 GB
    - –î–∏—Å–∫: 40 GB SSD
    - –û–°: Ubuntu 22.04 LTS
    - –õ–æ–∫–∞—Ü–∏—è: –ú–æ—Å–∫–≤–∞
  - –°—Ç–æ–∏–º–æ—Å—Ç—å: ~600-800 —Ä—É–±/–º–µ—Å

- [ ] **1.2** –ó–∞–ø–∏—Å–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä–∞
  ```
  IP –∞–¥—Ä–µ—Å: _________________
  Root –ø–∞—Ä–æ–ª—å: _____________
  ```

- [ ] **1.3** –ü–µ—Ä–≤—ã–π –≤—Ö–æ–¥ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
  ```bash
  ssh root@<IP_–°–ï–†–í–ï–†–ê>
  # –°–º–µ–Ω–∏—Ç—å root –ø–∞—Ä–æ–ª—å
  passwd
  ```

- [ ] **1.4** –û–±–Ω–æ–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É
  ```bash
  apt update && apt upgrade -y
  ```

- [ ] **1.5** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∞–∑–æ–≤—ã–µ —É—Ç–∏–ª–∏—Ç—ã
  ```bash
  apt install -y \
    curl \
    wget \
    git \
    htop \
    nano \
    vim \
    net-tools \
    ufw \
    fail2ban \
    ca-certificates \
    gnupg \
    lsb-release
  ```

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
‚úÖ VPS –∞—Ä–µ–Ω–¥–æ–≤–∞–Ω  
‚úÖ –°–µ—Ä–≤–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω  
‚úÖ –ë–∞–∑–æ–≤—ã–µ —É—Ç–∏–ª–∏—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã

---

## –≠—Ç–∞–ø 2: DNS –∏ –î–æ–º–µ–Ω

**–í—Ä–µ–º—è:** 0.5 –¥–Ω—è (+ –≤—Ä–µ–º—è –Ω–∞ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ DNS)  
**–°—Ç–∞—Ç—É—Å:** üü¢ –î–æ–º–µ–Ω –∫—É–ø–ª–µ–Ω (titotr.ru)

### –ó–∞–¥–∞—á–∏:

- [ ] **2.1** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å DNS –Ω–∞ Selectel
  - –í–æ–π—Ç–∏ –≤ –ø–∞–Ω–µ–ª—å Selectel
  - –ü–µ—Ä–µ–π—Ç–∏ –≤ —Ä–∞–∑–¥–µ–ª "DNS"
  - –î–æ–±–∞–≤–∏—Ç—å –¥–æ–º–µ–Ω titotr.ru

- [ ] **2.2** –î–æ–±–∞–≤–∏—Ç—å DNS –∑–∞–ø–∏—Å–∏
  ```
  –¢–∏–ø: A
  –ò–º—è: @
  –ó–Ω–∞—á–µ–Ω–∏–µ: <IP_–í–ê–®–ï–ì–û_–°–ï–†–í–ï–†–ê>
  TTL: 3600

  –¢–∏–ø: A
  –ò–º—è: www
  –ó–Ω–∞—á–µ–Ω–∏–µ: <IP_–í–ê–®–ï–ì–û_–°–ï–†–í–ï–†–ê>
  TTL: 3600

  –¢–∏–ø: CNAME
  –ò–º—è: api
  –ó–Ω–∞—á–µ–Ω–∏–µ: titotr.ru
  TTL: 3600
  ```

- [ ] **2.3** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å DNS (–º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –¥–æ 48 —á–∞—Å–æ–≤)
  ```bash
  # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å A-–∑–∞–ø–∏—Å—å
  dig titotr.ru A
  
  # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å —Ä–∞–∑–Ω—ã—Ö DNS
  dig @8.8.8.8 titotr.ru
  dig @1.1.1.1 titotr.ru
  
  # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ
  # https://dnschecker.org/#A/titotr.ru
  ```

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
‚úÖ DNS –∑–∞–ø–∏—Å–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã  
‚úÖ –î–æ–º–µ–Ω –¥–æ—Å—Ç—É–ø–µ–Ω –∏ —Ä–µ–∑–æ–ª–≤–∏—Ç—Å—è –Ω–∞ IP —Å–µ—Ä–≤–µ—Ä–∞

---

## –≠—Ç–∞–ø 3: SSH –∏ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–í—Ä–µ–º—è:** 1 –¥–µ–Ω—å  
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –ù–µ –Ω–∞—á–∞—Ç

### –ó–∞–¥–∞—á–∏:

- [ ] **3.1** –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–µ root)
  ```bash
  # –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
  adduser deploy
  usermod -aG sudo deploy
  ```

- [ ] **3.2** –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å SSH –∫–ª—é—á –Ω–∞ Mac
  ```bash
  # –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ (Mac)
  ssh-keygen -t ed25519 -C "titotr-production" -f ~/.ssh/id_ed25519_titotr
  
  # –î–æ–±–∞–≤–∏—Ç—å –≤ Keychain
  ssh-add --apple-use-keychain ~/.ssh/id_ed25519_titotr
  ```

- [ ] **3.3** –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –Ω–∞ —Å–µ—Ä–≤–µ—Ä
  ```bash
  # –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ
  ssh-copy-id -i ~/.ssh/id_ed25519_titotr.pub deploy@<IP_–°–ï–†–í–ï–†–ê>
  ```

- [ ] **3.4** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å SSH config –Ω–∞ Mac
  ```bash
  # –°–æ–∑–¥–∞—Ç—å/–æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å ~/.ssh/config
  nano ~/.ssh/config
  ```
  
  –î–æ–±–∞–≤–∏—Ç—å:
  ```
  Host titotr-production
      HostName <IP_–°–ï–†–í–ï–†–ê>
      Port 2222
      User deploy
      IdentityFile ~/.ssh/id_ed25519_titotr
      UseKeychain yes
      AddKeysToAgent yes
      ServerAliveInterval 60
  ```

- [ ] **3.5** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å SSH –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
  ```bash
  # –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø–æ–¥ root
  nano /etc/ssh/sshd_config
  ```
  
  –ò–∑–º–µ–Ω–∏—Ç—å:
  ```
  Port 2222
  PermitRootLogin no
  PubkeyAuthentication yes
  PasswordAuthentication no
  ChallengeResponseAuthentication no
  UsePAM no
  X11Forwarding no
  AllowUsers deploy
  ```

- [ ] **3.6** –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å SSH
  ```bash
  systemctl restart sshd
  ```

- [ ] **3.7** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–æ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (–ù–ï –ó–ê–ö–†–´–í–ê–¢–¨ –°–¢–ê–†–£–Æ –°–ï–°–°–ò–Æ!)
  ```bash
  # –í –Ω–æ–≤–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
  ssh titotr-production
  ```

- [ ] **3.8** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å UFW Firewall
  ```bash
  # –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
  sudo ufw default deny incoming
  sudo ufw default allow outgoing
  sudo ufw allow 2222/tcp comment 'SSH'
  sudo ufw allow 80/tcp comment 'HTTP'
  sudo ufw allow 443/tcp comment 'HTTPS'
  sudo ufw enable
  sudo ufw status verbose
  ```

- [ ] **3.9** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Fail2Ban
  ```bash
  sudo nano /etc/fail2ban/jail.local
  ```
  
  –î–æ–±–∞–≤–∏—Ç—å:
  ```ini
  [DEFAULT]
  bantime = 3600
  findtime = 600
  maxretry = 5

  [sshd]
  enabled = true
  port = 2222
  logpath = /var/log/auth.log
  ```
  
  ```bash
  sudo systemctl enable fail2ban
  sudo systemctl start fail2ban
  ```

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
‚úÖ SSH —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ –∫–ª—é—á–∞–º –Ω–∞ –ø–æ—Ä—Ç—É 2222  
‚úÖ Root –¥–æ—Å—Ç—É–ø –æ—Ç–∫–ª—é—á–µ–Ω  
‚úÖ Firewall –Ω–∞—Å—Ç—Ä–æ–µ–Ω  
‚úÖ Fail2ban –∞–∫—Ç–∏–≤–µ–Ω

---

## –≠—Ç–∞–ø 4: Docker –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

**–í—Ä–µ–º—è:** 0.5 –¥–Ω—è  
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –ù–µ –Ω–∞—á–∞—Ç

### –ó–∞–¥–∞—á–∏:

- [ ] **4.1** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Docker
  ```bash
  # –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
  curl -fsSL https://get.docker.com -o get-docker.sh
  sudo sh get-docker.sh
  
  # –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—É docker
  sudo usermod -aG docker deploy
  
  # –ü–µ—Ä–µ–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è
  exit
  ssh titotr-production
  
  # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
  docker --version
  docker compose version
  ```

- [ ] **4.2** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ Docker
  ```bash
  sudo systemctl enable docker
  sudo systemctl start docker
  ```

- [ ] **4.3** –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
  ```bash
  sudo mkdir -p /opt/titotr/{backend,database/init,nginx/conf.d,backups,logs}
  sudo chown -R deploy:deploy /opt/titotr
  cd /opt/titotr
  ```

- [ ] **4.4** –°–æ–∑–¥–∞—Ç—å .env —Ñ–∞–π–ª
  ```bash
  nano /opt/titotr/.env
  ```
  
  –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
  ```bash
  # Database
  POSTGRES_USER=titotr_user
  POSTGRES_PASSWORD=<–°–ì–ï–ù–ï–†–ò–†–û–í–ê–¢–¨_–ü–ê–†–û–õ–¨_32_–°–ò–ú–í–û–õ–ê>
  POSTGRES_DB=titotr_production

  # Redis
  REDIS_PASSWORD=<–°–ì–ï–ù–ï–†–ò–†–û–í–ê–¢–¨_–ü–ê–†–û–õ–¨_32_–°–ò–ú–í–û–õ–ê>

  # JWT
  JWT_SECRET=<–°–ì–ï–ù–ï–†–ò–†–û–í–ê–¢–¨_–°–ï–ö–†–ï–¢_64_–°–ò–ú–í–û–õ–ê>

  # App
  NODE_ENV=production
  API_URL=https://titotr.ru/api
  ```

- [ ] **4.5** –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏
  ```bash
  # –ù–∞ Mac –∏–ª–∏ —Å–µ—Ä–≤–µ—Ä–µ
  openssl rand -base64 32  # –¥–ª—è POSTGRES_PASSWORD
  openssl rand -base64 32  # –¥–ª—è REDIS_PASSWORD
  openssl rand -base64 64  # –¥–ª—è JWT_SECRET
  ```

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
‚úÖ Docker —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω  
‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π —Å–æ–∑–¥–∞–Ω–∞  
‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

---

## –≠—Ç–∞–ø 5: PostgreSQL –°—Ö–µ–º–∞

**–í—Ä–µ–º—è:** 1 –¥–µ–Ω—å  
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –ù–µ –Ω–∞—á–∞—Ç

### –ó–∞–¥–∞—á–∏:

- [ ] **5.1** –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î
  ```bash
  nano /opt/titotr/database/init/01-schema.sql
  ```

- [ ] **5.2** –î–æ–±–∞–≤–∏—Ç—å —Å—Ö–µ–º—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
  ```sql
  -- Enable extensions
  CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
  CREATE EXTENSION IF NOT EXISTS "pg_trgm";

  -- Users table
  CREATE TABLE users (
      id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
      email VARCHAR(255) UNIQUE NOT NULL,
      password_hash VARCHAR(255) NOT NULL,
      name VARCHAR(255) NOT NULL,
      phone VARCHAR(20),
      is_verified BOOLEAN DEFAULT FALSE,
      is_active BOOLEAN DEFAULT TRUE,
      created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
      updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
  );

  -- Refresh tokens
  CREATE TABLE refresh_tokens (
      id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
      user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
      token_hash VARCHAR(255) NOT NULL,
      expires_at TIMESTAMP WITH TIME ZONE NOT NULL,
      created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
  );

  -- Routes
  CREATE TABLE routes (
      id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
      name VARCHAR(255) NOT NULL,
      from_city VARCHAR(255) NOT NULL,
      to_city VARCHAR(255) NOT NULL,
      distance_km DECIMAL(10, 2),
      duration_minutes INTEGER,
      base_price DECIMAL(10, 2) NOT NULL,
      is_active BOOLEAN DEFAULT TRUE,
      created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
      updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
  );

  -- Bookings
  CREATE TABLE bookings (
      id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
      user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
      route_id UUID NOT NULL REFERENCES routes(id),
      pickup_address TEXT NOT NULL,
      dropoff_address TEXT NOT NULL,
      pickup_time TIMESTAMP WITH TIME ZONE NOT NULL,
      passengers INTEGER DEFAULT 1,
      luggage INTEGER DEFAULT 0,
      total_price DECIMAL(10, 2) NOT NULL,
      status VARCHAR(50) DEFAULT 'pending',
      payment_status VARCHAR(50) DEFAULT 'pending',
      notes TEXT,
      created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
      updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
  );

  -- Payments
  CREATE TABLE payments (
      id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
      booking_id UUID NOT NULL REFERENCES bookings(id) ON DELETE CASCADE,
      amount DECIMAL(10, 2) NOT NULL,
      currency VARCHAR(3) DEFAULT 'RUB',
      payment_method VARCHAR(50),
      payment_provider VARCHAR(50),
      transaction_id VARCHAR(255),
      status VARCHAR(50) DEFAULT 'pending',
      paid_at TIMESTAMP WITH TIME ZONE,
      created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
  );

  -- Indexes
  CREATE INDEX idx_users_email ON users(email);
  CREATE INDEX idx_refresh_tokens_user_id ON refresh_tokens(user_id);
  CREATE INDEX idx_bookings_user_id ON bookings(user_id);
  CREATE INDEX idx_bookings_status ON bookings(status);
  CREATE INDEX idx_bookings_pickup_time ON bookings(pickup_time);
  CREATE INDEX idx_payments_booking_id ON payments(booking_id);

  -- Trigger –¥–ª—è updated_at
  CREATE OR REPLACE FUNCTION update_updated_at_column()
  RETURNS TRIGGER AS $$
  BEGIN
      NEW.updated_at = NOW();
      RETURN NEW;
  END;
  $$ language 'plpgsql';

  CREATE TRIGGER update_users_updated_at BEFORE UPDATE ON users
      FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

  CREATE TRIGGER update_routes_updated_at BEFORE UPDATE ON routes
      FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

  CREATE TRIGGER update_bookings_updated_at BEFORE UPDATE ON bookings
      FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
  ```

- [ ] **5.3** –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  ```bash
  nano /opt/titotr/database/init/02-seed.sql
  ```

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
‚úÖ SQL —Å—Ö–µ–º–∞ —Å–æ–∑–¥–∞–Ω–∞  
‚úÖ –ò–Ω–¥–µ–∫—Å—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã  
‚úÖ –¢—Ä–∏–≥–≥–µ—Ä—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

---

## –≠—Ç–∞–ø 6: Dart Frog Backend

**–í—Ä–µ–º—è:** 2-3 –¥–Ω—è  
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –ù–µ –Ω–∞—á–∞—Ç

### –ó–∞–¥–∞—á–∏:

- [ ] **6.1** –°–æ–∑–¥–∞—Ç—å Dart Frog –ø—Ä–æ–µ–∫—Ç –ª–æ–∫–∞–ª—å–Ω–æ
  ```bash
  cd /Users/kirillpetrov/Projects/time-to-travel
  mkdir backend
  cd backend
  dart_frog create .
  ```

- [ ] **6.2** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å pubspec.yaml
  ```yaml
  name: time_to_travel_backend
  description: Dart Frog backend for Time to Travel
  version: 1.0.0

  environment:
    sdk: '>=3.0.0 <4.0.0'

  dependencies:
    dart_frog: ^2.0.0
    postgres: ^3.0.0
    jwt_decoder: ^2.0.1
    dart_jsonwebtoken: ^2.12.0
    bcrypt: ^1.1.3
    uuid: ^4.0.0
    http: ^1.1.0
    redis: ^3.1.0
    dotenv: ^4.2.0

  dev_dependencies:
    build_runner: ^2.4.0
    dart_frog_cli: ^2.0.0
    mocktail: ^1.0.0
    test: ^1.24.0
    very_good_analysis: ^6.0.0
  ```

- [ ] **6.3** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
  ```bash
  dart pub get
  ```

- [ ] **6.4** –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
  ```bash
  mkdir -p lib/{models,services,repositories,middlewares,utils}
  mkdir -p routes/{auth,users,bookings,routes}
  mkdir -p test/{routes,services}
  ```

- [ ] **6.5** –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
  
  –§–∞–π–ª: `lib/models/user.dart`
  –§–∞–π–ª: `lib/models/booking.dart`
  –§–∞–π–ª: `lib/models/route.dart`

- [ ] **6.6** –°–æ–∑–¥–∞—Ç—å DatabaseService
  
  –§–∞–π–ª: `lib/services/database_service.dart`

- [ ] **6.7** –°–æ–∑–¥–∞—Ç—å Dockerfile
  ```bash
  nano Dockerfile
  ```

- [ ] **6.8** –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ
  ```bash
  dart_frog dev
  # –î–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è –Ω–∞ http://localhost:8080
  ```

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
‚úÖ Dart Frog –ø—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω  
‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã  
‚úÖ –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞  
‚úÖ –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## –≠—Ç–∞–ø 7: JWT Authentication

**–í—Ä–µ–º—è:** 1-2 –¥–Ω—è  
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –ù–µ –Ω–∞—á–∞—Ç

### –ó–∞–¥–∞—á–∏:

- [ ] **7.1** –°–æ–∑–¥–∞—Ç—å AuthService
  
  –§–∞–π–ª: `lib/services/auth_service.dart`
  - –ú–µ—Ç–æ–¥ register()
  - –ú–µ—Ç–æ–¥ login()
  - –ú–µ—Ç–æ–¥ refreshToken()
  - –ú–µ—Ç–æ–¥ validateToken()

- [ ] **7.2** –°–æ–∑–¥–∞—Ç—å Auth Middleware
  
  –§–∞–π–ª: `lib/middlewares/auth_middleware.dart`

- [ ] **7.3** –°–æ–∑–¥–∞—Ç—å auth routes
  - `routes/auth/register.dart`
  - `routes/auth/login.dart`
  - `routes/auth/refresh.dart`
  - `routes/auth/logout.dart`

- [ ] **7.4** –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
  ```bash
  curl -X POST http://localhost:8080/auth/register \
    -H "Content-Type: application/json" \
    -d '{"email":"test@test.com","password":"test123","name":"Test User"}'
  ```

- [ ] **7.5** –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–Ω
  ```bash
  curl -X POST http://localhost:8080/auth/login \
    -H "Content-Type: application/json" \
    -d '{"email":"test@test.com","password":"test123"}'
  ```

- [ ] **7.6** –ù–∞–ø–∏—Å–∞—Ç—å unit —Ç–µ—Å—Ç—ã
  
  –§–∞–π–ª: `test/services/auth_service_test.dart`

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
‚úÖ JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç  
‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç  
‚úÖ –õ–æ–≥–∏–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç  
‚úÖ –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

---

## –≠—Ç–∞–ø 8: API Endpoints

**–í—Ä–µ–º—è:** 2-3 –¥–Ω—è  
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –ù–µ –Ω–∞—á–∞—Ç

### –ó–∞–¥–∞—á–∏:

- [ ] **8.1** –°–æ–∑–¥–∞—Ç—å Users API
  - `routes/users/me/index.dart` - GET —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
  - `routes/users/[id].dart` - GET/PUT/DELETE –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

- [ ] **8.2** –°–æ–∑–¥–∞—Ç—å Routes API
  - `routes/routes/index.dart` - GET —Å–ø–∏—Å–æ–∫ –º–∞—Ä—à—Ä—É—Ç–æ–≤
  - `routes/routes/[id].dart` - GET –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç

- [ ] **8.3** –°–æ–∑–¥–∞—Ç—å Bookings API
  - `routes/bookings/index.dart` - GET/POST –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
  - `routes/bookings/[id].dart` - GET/PUT/DELETE –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
  - `routes/bookings/[id]/cancel.dart` - POST –æ—Ç–º–µ–Ω–∞

- [ ] **8.4** –°–æ–∑–¥–∞—Ç—å Health Check
  - `routes/health.dart` - GET –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è

- [ ] **8.5** –î–æ–±–∞–≤–∏—Ç—å CORS middleware
  
  –§–∞–π–ª: `routes/_middleware.dart`

- [ ] **8.6** –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ endpoints
  ```bash
  # –°–æ–∑–¥–∞—Ç—å Postman –∫–æ–ª–ª–µ–∫—Ü–∏—é –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å curl
  ```

- [ ] **8.7** –ù–∞–ø–∏—Å–∞—Ç—å integration —Ç–µ—Å—Ç—ã

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
‚úÖ –í—Å–µ API endpoints —Ä–∞–±–æ—Ç–∞—é—Ç  
‚úÖ CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω  
‚úÖ –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

---

## –≠—Ç–∞–ø 9: Nginx –∏ SSL

**–í—Ä–µ–º—è:** 1 –¥–µ–Ω—å  
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –ù–µ –Ω–∞—á–∞—Ç

### –ó–∞–¥–∞—á–∏:

- [ ] **9.1** –°–æ–∑–¥–∞—Ç—å docker-compose.yml
  ```bash
  nano /opt/titotr/docker-compose.yml
  ```

- [ ] **9.2** –°–æ–∑–¥–∞—Ç—å Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
  ```bash
  nano /opt/titotr/nginx/nginx.conf
  nano /opt/titotr/nginx/conf.d/titotr.conf
  ```

- [ ] **9.3** –ó–∞–ø—É—Å—Ç–∏—Ç—å Docker Compose (–±–µ–∑ SSL)
  ```bash
  cd /opt/titotr
  docker compose up -d nginx postgres redis
  ```

- [ ] **9.4** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –Ω–∞ HTTP
  ```bash
  curl http://titotr.ru/health
  ```

- [ ] **9.5** –ü–æ–ª—É—á–∏—Ç—å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
  ```bash
  docker compose run --rm certbot certonly \
    --webroot \
    --webroot-path=/var/www/certbot \
    --email admin@titotr.ru \
    --agree-tos \
    --no-eff-email \
    -d titotr.ru \
    -d www.titotr.ru
  ```

- [ ] **9.6** –û–±–Ω–æ–≤–∏—Ç—å Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è HTTPS

- [ ] **9.7** –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Nginx
  ```bash
  docker compose restart nginx
  ```

- [ ] **9.8** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å HTTPS
  ```bash
  curl https://titotr.ru/health
  ```

- [ ] **9.9** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SSL —Ä–µ–π—Ç–∏–Ω–≥
  - –û—Ç–∫—Ä—ã—Ç—å: https://www.ssllabs.com/ssltest/analyze.html?d=titotr.ru
  - –¶–µ–ª—å: A+ —Ä–µ–π—Ç–∏–Ω–≥

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
‚úÖ Docker Compose –∑–∞–ø—É—â–µ–Ω  
‚úÖ Nginx —Ä–∞–±–æ—Ç–∞–µ—Ç  
‚úÖ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω  
‚úÖ HTTPS —Ä–∞–±–æ—Ç–∞–µ—Ç  
‚úÖ SSL —Ä–µ–π—Ç–∏–Ω–≥ A+

---

## –≠—Ç–∞–ø 10: –ú–∏–≥—Ä–∞—Ü–∏—è –î–∞–Ω–Ω—ã—Ö

**–í—Ä–µ–º—è:** 1-2 –¥–Ω—è  
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –ù–µ –Ω–∞—á–∞—Ç

### –ó–∞–¥–∞—á–∏:

- [ ] **10.1** –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ Firebase Auth
  ```javascript
  // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Firebase Admin SDK
  // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ users.json
  ```

- [ ] **10.2** –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ Firestore
  ```bash
  firebase firestore:export ./firestore-backup
  ```

- [ ] **10.3** –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
  
  –§–∞–π–ª: `tools/migrate_firebase.dart`

- [ ] **10.4** –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –ë–î
  ```bash
  dart run tools/migrate_firebase.dart --test
  ```

- [ ] **10.5** –í—ã–ø–æ–ª–Ω–∏—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é
  ```bash
  dart run tools/migrate_firebase.dart --production
  ```

- [ ] **10.6** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
  ```sql
  -- –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
  docker compose exec postgres psql -U titotr_user -d titotr_production
  SELECT COUNT(*) FROM users;
  SELECT COUNT(*) FROM bookings;
  ```

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã  
‚úÖ –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã  
‚úÖ –î–∞–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã

---

## –≠—Ç–∞–ø 11: Flutter Integration

**–í—Ä–µ–º—è:** 2-3 –¥–Ω—è  
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –ù–µ –Ω–∞—á–∞—Ç

### –ó–∞–¥–∞—á–∏:

- [ ] **11.1** –°–æ–∑–¥–∞—Ç—å API –∫–ª–∏–µ–Ω—Ç –≤ Flutter
  ```dart
  // lib/services/api_client.dart
  ```

- [ ] **11.2** –ó–∞–º–µ–Ω–∏—Ç—å Firebase Auth –Ω–∞ JWT
  - –£–¥–∞–ª–∏—Ç—å firebase_auth
  - –°–æ–∑–¥–∞—Ç—å auth_service.dart
  - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å JWT —Ö—Ä–∞–Ω–µ–Ω–∏–µ (flutter_secure_storage)

- [ ] **11.3** –û–±–Ω–æ–≤–∏—Ç—å –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
  - User model
  - Booking model
  - Route model

- [ ] **11.4** –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ API –≤—ã–∑–æ–≤—ã
  - –ó–∞–º–µ–Ω–∏—Ç—å Firestore –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ HTTP
  - –û–±–Ω–æ–≤–∏—Ç—å auth –º–µ—Ç–æ–¥—ã
  - –û–±–Ω–æ–≤–∏—Ç—å CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏

- [ ] **11.5** –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—à–∏–±–∫–∏ –∏ retry –ª–æ–≥–∏–∫—É

- [ ] **11.6** –î–æ–±–∞–≤–∏—Ç—å –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  - –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ sqflite
  - Sync –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞

- [ ] **11.7** –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
  - iOS
  - Android

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
‚úÖ Firebase SDK —É–¥–∞–ª–µ–Ω  
‚úÖ API –∫–ª–∏–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç  
‚úÖ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç  
‚úÖ –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç

---

## –≠—Ç–∞–ø 12: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–í—Ä–µ–º—è:** 2-3 –¥–Ω—è  
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –ù–µ –Ω–∞—á–∞—Ç

### –ó–∞–¥–∞—á–∏:

- [ ] **12.1** Backend Unit Tests
  ```bash
  cd backend
  dart test
  ```

- [ ] **12.2** Backend Integration Tests
  ```bash
  dart test test/integration
  ```

- [ ] **12.3** Flutter Unit Tests
  ```bash
  cd mobile
  flutter test
  ```

- [ ] **12.4** Flutter Widget Tests

- [ ] **12.5** E2E —Ç–µ—Å—Ç—ã (patrol –∏–ª–∏ integration_test)

- [ ] **12.6** –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
  ```bash
  # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Apache Bench –∏–ª–∏ k6
  ab -n 1000 -c 10 https://titotr.ru/api/health
  ```

- [ ] **12.7** Security –∞—É–¥–∏—Ç
  - SQL injection —Ç–µ—Å—Ç—ã
  - XSS —Ç–µ—Å—Ç—ã
  - CSRF —Ç–µ—Å—Ç—ã
  - Rate limiting —Ç–µ—Å—Ç—ã

- [ ] **12.8** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –º–µ–¥–ª–µ–Ω–Ω–æ–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç  
‚úÖ –ù–∞–≥—Ä—É–∑–∫–∞ –≤—ã–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è  
‚úÖ Security –ø—Ä–æ–±–ª–µ–º –Ω–µ—Ç

---

## –≠—Ç–∞–ø 13: Production Deploy

**–í—Ä–µ–º—è:** 1 –¥–µ–Ω—å  
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –ù–µ –Ω–∞—á–∞—Ç

### –ó–∞–¥–∞—á–∏:

- [ ] **13.1** –°–æ–∑–¥–∞—Ç—å deploy —Å–∫—Ä–∏–ø—Ç—ã
  ```bash
  chmod +x scripts/deploy.sh
  chmod +x scripts/backup_db.sh
  ```

- [ ] **13.2** –í—ã–ø–æ–ª–Ω–∏—Ç—å –ø–µ—Ä–≤—ã–π –¥–µ–ø–ª–æ–π
  ```bash
  ./scripts/deploy.sh
  ```

- [ ] **13.3** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
  ```bash
  ssh titotr-production
  docker compose ps
  docker compose logs -f
  ```

- [ ] **13.4** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã
  ```bash
  # –î–æ–±–∞–≤–∏—Ç—å –≤ crontab
  crontab -e
  # 0 3 * * * cd /opt/titotr && ./scripts/backup_db.sh
  ```

- [ ] **13.5** –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –±—ç–∫–∞–ø –∏ restore
  ```bash
  ./scripts/backup_db.sh
  ./scripts/restore_db.sh backup_20260121.sql.gz
  ```

- [ ] **13.6** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
  ```bash
  # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–æ—Ç–∞—Ü–∏—é –ª–æ–≥–æ–≤
  docker compose logs --tail=100 backend
  ```

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
‚úÖ Production –¥–µ–ø–ª–æ–π –≤—ã–ø–æ–ª–Ω–µ–Ω  
‚úÖ –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç  
‚úÖ –ë—ç–∫–∞–ø—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã  
‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## –≠—Ç–∞–ø 14: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

**–í—Ä–µ–º—è:** 1 –¥–µ–Ω—å  
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –ù–µ –Ω–∞—á–∞—Ç

### –ó–∞–¥–∞—á–∏:

- [ ] **14.1** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Portainer (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  ```bash
  # –£–∂–µ –≤ docker-compose.yml
  # –û—Ç–∫—Ä—ã—Ç—å https://titotr.ru:9443
  ```

- [ ] **14.2** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Uptime –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å UptimeRobot.com (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)
  - –î–æ–±–∞–≤–∏—Ç—å https://titotr.ru/health
  - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å email –∞–ª–µ—Ä—Ç—ã

- [ ] **14.3** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤
  ```bash
  # –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
  htop
  docker stats
  df -h
  ```

- [ ] **14.4** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã
  - Email –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —Å–µ—Ä–≤–∏—Å–∞
  - Telegram –±–æ—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

- [ ] **14.5** –°–æ–∑–¥–∞—Ç—å dashboard –¥–ª—è –º–µ—Ç—Ä–∏–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  - Grafana + Prometheus
  - –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ–π —Å–∫—Ä–∏–ø—Ç —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
‚úÖ Uptime –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞—Å—Ç—Ä–æ–µ–Ω  
‚úÖ –ê–ª–µ—Ä—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç  
‚úÖ –ú–µ—Ç—Ä–∏–∫–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è

---

## –≠—Ç–∞–ø 15: –û—Ç–∫–ª—é—á–µ–Ω–∏–µ Firebase

**–í—Ä–µ–º—è:** 1 –¥–µ–Ω—å  
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –ù–µ –Ω–∞—á–∞—Ç

### –ó–∞–¥–∞—á–∏:

- [ ] **15.1** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –≤ production (1 –Ω–µ–¥–µ–ª—è)
  - –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –æ—à–∏–±–∫–∏
  - –°–æ–±–∏—Ä–∞—Ç—å feedback –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

- [ ] **15.2** –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã

- [ ] **15.3** –û—Ç–∫–ª—é—á–∏—Ç—å Firebase Functions
  ```bash
  firebase functions:delete --force
  ```

- [ ] **15.4** –û—Ç–∫–ª—é—á–∏—Ç—å Firebase Firestore
  - –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –±—ç–∫–∞–ø
  - –£–¥–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ

- [ ] **15.5** –û—Ç–∫–ª—é—á–∏—Ç—å Firebase Auth
  - –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–µ—Ä–µ—à–ª–∏

- [ ] **15.6** –ü–æ–Ω–∏–∑–∏—Ç—å Firebase –ø–ª–∞–Ω –¥–æ Spark (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π)
  - Firebase Console ‚Üí Settings ‚Üí Usage and billing

- [ ] **15.7** –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
  - README
  - API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
‚úÖ Firebase –æ—Ç–∫–ª—é—á–µ–Ω  
‚úÖ –ü—Ä–æ–µ–∫—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–º backend  
‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞

---

## üìä –¢—Ä–µ–∫–∏–Ω–≥ –ü—Ä–æ–≥—Ä–µ—Å—Å–∞

| –≠—Ç–∞–ø | –ó–∞–¥–∞—á | –í—ã–ø–æ–ª–Ω–µ–Ω–æ | –ü—Ä–æ–≥—Ä–µ—Å—Å | –°—Ç–∞—Ç—É—Å |
|------|-------|-----------|----------|--------|
| 0. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ | 6 | 0 | 0% | ‚è≥ |
| 1. –°–µ—Ä–≤–µ—Ä | 5 | 0 | 0% | ‚è≥ |
| 2. DNS | 3 | 1 | 33% | üü° |
| 3. SSH | 9 | 0 | 0% | ‚è≥ |
| 4. Docker | 5 | 0 | 0% | ‚è≥ |
| 5. PostgreSQL | 3 | 0 | 0% | ‚è≥ |
| 6. Dart Frog | 8 | 0 | 0% | ‚è≥ |
| 7. JWT | 6 | 0 | 0% | ‚è≥ |
| 8. API | 7 | 0 | 0% | ‚è≥ |
| 9. Nginx/SSL | 9 | 0 | 0% | ‚è≥ |
| 10. –ú–∏–≥—Ä–∞—Ü–∏—è | 6 | 0 | 0% | ‚è≥ |
| 11. Flutter | 7 | 0 | 0% | ‚è≥ |
| 12. –¢–µ—Å—Ç—ã | 8 | 0 | 0% | ‚è≥ |
| 13. Deploy | 6 | 0 | 0% | ‚è≥ |
| 14. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ | 5 | 0 | 0% | ‚è≥ |
| 15. Firebase OFF | 7 | 0 | 0% | ‚è≥ |
| **–ò–¢–û–ì–û** | **90** | **1** | **1%** | üü° |

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ –®–∞–≥–∏

**–ù–∞—á–∞—Ç—å —Å –≠—Ç–∞–ø–∞ 0: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞**

1. –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø Firebase
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
3. –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É backend

**–ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å?** –°–∫–∞–∂–∏ "–ù–∞—á–∏–Ω–∞–µ–º –≠—Ç–∞–ø 0" –∏ —è –ø–æ–º–æ–≥—É –ø–æ—à–∞–≥–æ–≤–æ!

---

**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 21 —è–Ω–≤–∞—Ä—è 2026  
**–ê–≤—Ç–æ—Ä:** AI Assistant + Kirill Petrov
