#!/bin/bash

# =============================================================
# –°–ö–†–ò–ü–¢ –ó–ê–ì–†–£–ó–ö–ò –ì–†–£–ü–ü –ú–ê–†–®–†–£–¢–û–í –í POSTGRESQL
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç route-groups API –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ 10 –≥—Ä—É–ø–ø
# =============================================================

set -e

API_URL="https://titotr.ru/api"
# API_URL="http://localhost:8080/api"  # –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω
if [ -z "$ADMIN_TOKEN" ]; then
    echo "‚ùå –û–®–ò–ë–ö–ê: –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é ADMIN_TOKEN"
    echo ""
    echo "–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:"
    echo "1. –í–æ–π–¥–∏—Ç–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä"
    echo "2. –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –∏–∑ –∫–æ–Ω—Å–æ–ª–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∏–ª–∏ SharedPreferences"
    echo "3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ: export ADMIN_TOKEN='–≤–∞—à_—Ç–æ–∫–µ–Ω'"
    echo "4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ"
    exit 1
fi

echo "üöÄ –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –≥—Ä—É–ø–ø –º–∞—Ä—à—Ä—É—Ç–æ–≤ –≤ PostgreSQL..."
echo "üìç API: $API_URL"
echo ""

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä—É–ø–ø—ã
create_group() {
    local json=$1
    local name=$2
    
    echo "  üì¶ –°–æ–∑–¥–∞—ë–º –≥—Ä—É–ø–ø—É: $name"
    
    RESPONSE=$(curl -s -X POST "$API_URL/route-groups" \
      -H "Authorization: Bearer $ADMIN_TOKEN" \
      -H "Content-Type: application/json" \
      -d "$json")
    
    if echo "$RESPONSE" | grep -q '"error"'; then
        if echo "$RESPONSE" | grep -q "already exists"; then
            echo "    ‚ö†Ô∏è  –ì—Ä—É–ø–ø–∞ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º"
        else
            echo "    ‚ùå –û—à–∏–±–∫–∞: $RESPONSE"
        fi
    else
        echo "    ‚úÖ –°–æ–∑–¥–∞–Ω–æ"
    fi
}

# =============================================================
# –ì–†–£–ü–ü–´ –ú–ê–†–®–†–£–¢–û–í (10 —à—Ç—É–∫ –∏–∑ route_groups_initializer.dart)
# =============================================================

echo "üì¶ –ó–∞–≥—Ä—É–∂–∞–µ–º 10 –≥—Ä—É–ø–ø –º–∞—Ä—à—Ä—É—Ç–æ–≤..."
echo ""

# –ì—Ä—É–ø–ø–∞ 1: –†–æ—Å—Ç–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å
create_group '{
  "name": "–†–æ—Å—Ç–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å",
  "description": "–ú–∞—Ä—à—Ä—É—Ç—ã –≤ –≥–æ—Ä–æ–¥–∞ –†–æ—Å—Ç–æ–≤—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏",
  "basePrice": 8000
}' "–†–æ—Å—Ç–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å"

# –ì—Ä—É–ø–ø–∞ 2: –ö—Ä—ã–º
create_group '{
  "name": "–ö—Ä—ã–º—Å–∫–∏–π –ø–æ–ª—É–æ—Å—Ç—Ä–æ–≤",
  "description": "–í—Å–µ –º–∞—Ä—à—Ä—É—Ç—ã –Ω–∞ –ö—Ä—ã–º—Å–∫–∏–π –ø–æ–ª—É–æ—Å—Ç—Ä–æ–≤",
  "basePrice": 45000
}' "–ö—Ä—ã–º—Å–∫–∏–π –ø–æ–ª—É–æ—Å—Ç—Ä–æ–≤"

# –ì—Ä—É–ø–ø–∞ 3: –ü—Ä–∏–∞–∑–æ–≤—å–µ
create_group '{
  "name": "–ü—Ä–∏–∞–∑–æ–≤—å–µ",
  "description": "–ú–∞—Ä—à—Ä—É—Ç—ã –∫ –ê–∑–æ–≤—Å–∫–æ–º—É –º–æ—Ä—é",
  "basePrice": 7500
}' "–ü—Ä–∏–∞–∑–æ–≤—å–µ"

# –ì—Ä—É–ø–ø–∞ 4: –ß–µ—Ä–Ω–æ–º–æ—Ä—Å–∫–æ–µ –ø–æ–±–µ—Ä–µ–∂—å–µ
create_group '{
  "name": "–ß–µ—Ä–Ω–æ–º–æ—Ä—Å–∫–æ–µ –ø–æ–±–µ—Ä–µ–∂—å–µ",
  "description": "–ö—É—Ä–æ—Ä—Ç—ã –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä—Å–∫–æ–≥–æ –∫—Ä–∞—è (–ê–Ω–∞–ø–∞, –ì–µ–ª–µ–Ω–¥–∂–∏–∫)",
  "basePrice": 40000
}' "–ß–µ—Ä–Ω–æ–º–æ—Ä—Å–∫–æ–µ –ø–æ–±–µ—Ä–µ–∂—å–µ"

# –ì—Ä—É–ø–ø–∞ 5: –°–æ—á–∏
create_group '{
  "name": "–°–æ—á–∏",
  "description": "–ú–∞—Ä—à—Ä—É—Ç—ã –≤ –°–æ—á–∏ –∏ –∞—ç—Ä–æ–ø–æ—Ä—Ç",
  "basePrice": 50000
}' "–°–æ—á–∏"

# –ì—Ä—É–ø–ø–∞ 6: –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä
create_group '{
  "name": "–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä",
  "description": "–ú–∞—Ä—à—Ä—É—Ç—ã –≤ –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä",
  "basePrice": 30000
}' "–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä"

# –ì—Ä—É–ø–ø–∞ 7: –í–æ–ª–≥–æ–≥—Ä–∞–¥ –∏ –ú–∏–Ω–≤–æ–¥—ã
create_group '{
  "name": "–í–æ–ª–≥–æ–≥—Ä–∞–¥ –∏ –ú–∏–Ω–≤–æ–¥—ã",
  "description": "–ú–∞—Ä—à—Ä—É—Ç—ã –≤ –í–æ–ª–≥–æ–≥—Ä–∞–¥ –∏ –ú–∏–Ω–µ—Ä–∞–ª—å–Ω—ã–µ –í–æ–¥—ã",
  "basePrice": 40000
}' "–í–æ–ª–≥–æ–≥—Ä–∞–¥ –∏ –ú–∏–Ω–≤–æ–¥—ã"

# –ì—Ä—É–ø–ø–∞ 8: –ï–π—Å–∫
create_group '{
  "name": "–ï–π—Å–∫",
  "description": "–ú–∞—Ä—à—Ä—É—Ç—ã –≤ –ï–π—Å–∫",
  "basePrice": 22000
}' "–ï–π—Å–∫"

# –ì—Ä—É–ø–ø–∞ 9: –î–∞–ª—å–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –†–æ—Å—Å–∏–∏
create_group '{
  "name": "–î–∞–ª—å–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –†–æ—Å—Å–∏–∏",
  "description": "–ú–æ—Å–∫–≤–∞, –í–æ—Ä–æ–Ω–µ–∂ –∏ –¥—Ä—É–≥–∏–µ –¥–∞–ª—å–Ω–∏–µ –≥–æ—Ä–æ–¥–∞",
  "basePrice": 50000
}' "–î–∞–ª—å–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –†–æ—Å—Å–∏–∏"

# –ì—Ä—É–ø–ø–∞ 10: –õ—é–±—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã
create_group '{
  "name": "–õ—é–±—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã",
  "description": "–ú–∞—Ä—à—Ä—É—Ç—ã, –Ω–µ –æ—Ç–Ω–æ—Å—è—â–∏–µ—Å—è –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –≥—Ä—É–ø–ø–∞–º",
  "basePrice": 0
}' "–õ—é–±—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã"

echo ""
echo "==================================================="
echo "üìä –ì–†–£–ü–ü–´ –ú–ê–†–®–†–£–¢–û–í –ó–ê–ì–†–£–ñ–ï–ù–´ –í POSTGRESQL!"
echo "==================================================="
