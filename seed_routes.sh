#!/bin/bash

# =============================================================
# –°–ö–†–ò–ü–¢ –ó–ê–ì–†–£–ó–ö–ò –ú–ê–†–®–†–£–¢–û–í –í POSTGRESQL
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç batch API –¥–ª—è –º–∞—Å—Å–æ–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ 70+ –º–∞—Ä—à—Ä—É—Ç–æ–≤
# =============================================================

set -e

API_URL="https://titotr.ru/api"
# API_URL="http://localhost:8080/api"  # –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω
if [ -z "$ADMIN_TOKEN" ]; then
    echo "‚ùå –û–®–ò–ë–ö–ê: –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é ADMIN_TOKEN"
    echo ""
    echo "–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:"
    echo "1. –í–æ–π–¥–∏—Ç–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä"
    echo "2. –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –∏–∑ –∫–æ–Ω—Å–æ–ª–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∏–ª–∏ SharedPreferences"
    echo "3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ: export ADMIN_TOKEN='–≤–∞—à_—Ç–æ–∫–µ–Ω'"
    echo "4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ"
    exit 1
fi

echo "üöÄ –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –º–∞—Ä—à—Ä—É—Ç–æ–≤ –≤ PostgreSQL..."
echo "üìç API: $API_URL"
echo ""

# =============================================================
# –ú–ê–†–®–†–£–¢–´ (70+ —à—Ç—É–∫ –∏–∑ route_initializer.dart)
# =============================================================

ROUTES_JSON=$(cat <<'EOF'
{
  "skipDuplicates": true,
  "routes": [
    {"fromCity": "–ï–Ω–∞–∫–∏–µ–≤–æ", "toCity": "–†–æ—Å—Ç–æ–≤", "price": 12000},
    {"fromCity": "–•–∞—Ä—Ü—ã–∑—Å–∫", "toCity": "–†–æ—Å—Ç–æ–≤", "price": 8000},
    {"fromCity": "–ì–æ—Ä–ª–æ–≤–∫–∞", "toCity": "–†–æ—Å—Ç–æ–≤", "price": 15000},
    {"fromCity": "–ê–º–≤—Ä–æ—Å–∏–µ–≤–∫–∞", "toCity": "–†–æ—Å—Ç–æ–≤", "price": 8000},
    {"fromCity": "–ó—É–≥—Ä—ç—Å", "toCity": "–†–æ—Å—Ç–æ–≤", "price": 8000},
    {"fromCity": "–®–∞—Ö—Ç—ë—Ä—Å–∫", "toCity": "–†–æ—Å—Ç–æ–≤", "price": 8000},
    {"fromCity": "–¢–æ—Ä–µ–∑", "toCity": "–†–æ—Å—Ç–æ–≤", "price": 8000},
    {"fromCity": "–ò–ª–æ–≤–∞–π—Å–∫–∏–π", "toCity": "–†–æ—Å—Ç–æ–≤", "price": 8000},
    {"fromCity": "–°—Ç–∞—Ä–æ–±–µ—à–µ–≤–æ", "toCity": "–†–æ—Å—Ç–æ–≤", "price": 8000},
    {"fromCity": "–ù–æ–≤—ã–π —Å–≤–µ—Ç", "toCity": "–†–æ—Å—Ç–æ–≤", "price": 8000},
    {"fromCity": "–î–æ–Ω–µ—Ü–∫", "toCity": "–ù–æ–≤–æ–∞–∑–æ–≤—Å–∫", "price": 7000},
    {"fromCity": "–î–æ–Ω–µ—Ü–∫", "toCity": "–°–µ–¥–æ–≤–æ", "price": 7000},
    {"fromCity": "–î–æ–Ω–µ—Ü–∫", "toCity": "–ú–∞—Ä–∏—É–ø–æ–ª—å", "price": 7000},
    {"fromCity": "–î–æ–Ω–µ—Ü–∫", "toCity": "–ú–µ–ª–µ–∫–∏–Ω–æ", "price": 8000},
    {"fromCity": "–î–æ–Ω–µ—Ü–∫", "toCity": "–Æ—Ä—å–µ–≤–∫–∞", "price": 8500},
    {"fromCity": "–î–æ–Ω–µ—Ü–∫", "toCity": "—É—Ä–∑—É—Ñ", "price": 8500},
    {"fromCity": "–î–æ–Ω–µ—Ü–∫", "toCity": "–ë–µ—Ä–¥—è–Ω—Å–∫", "price": 12000},
    {"fromCity": "–î–æ–Ω–µ—Ü–∫", "toCity": "–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ö—Ä—ã–º", "price": 45000},
    {"fromCity": "–î–æ–Ω–µ—Ü–∫", "toCity": "–°–∏–º—Ñ–µ—Ä–æ–ø–æ–ª—å", "price": 45000},
    {"fromCity": "–î–æ–Ω–µ—Ü–∫", "toCity": "–Ø–ª—Ç–∞", "price": 45000},
    {"fromCity": "–î–æ–Ω–µ—Ü–∫", "toCity": "–°–µ–≤–∞—Å—Ç–æ–ø–æ–ª—å", "price": 45000},
    {"fromCity": "–î–æ–Ω–µ—Ü–∫", "toCity": "–ï–≤–ø–∞—Ç–æ—Ä–∏—è", "price": 45000},
    {"fromCity": "–î–æ–Ω–µ—Ü–∫", "toCity": "–§–µ–æ–¥–æ—Å–∏—è", "price": 45000},
    {"fromCity": "–î–æ–Ω–µ—Ü–∫", "toCity": "–ö–µ—Ä—á—å", "price": 45000},
    {"fromCity": "–î–æ–Ω–µ—Ü–∫", "toCity": "–ê–ª—É—à—Ç–∞", "price": 45000},
    {"fromCity": "–î–æ–Ω–µ—Ü–∫", "toCity": "–°—É–¥–∞–∫", "price": 45000},
    {"fromCity": "–î–æ–Ω–µ—Ü–∫", "toCity": "–ë–∞–ª–∞–∫–ª–∞–≤–∞", "price": 45000},
    {"fromCity": "–î–æ–Ω–µ—Ü–∫", "toCity": "–ë–µ–ª–æ–≥–æ—Ä—Å–∫", "price": 45000},
    {"fromCity": "–î–æ–Ω–µ—Ü–∫", "toCity": "–°–∞–∫–∏", "price": 45000},
    {"fromCity": "–î–æ–Ω–µ—Ü–∫", "toCity": "–î–∂–∞–Ω–∫–æ–π", "price": 45000},
    {"fromCity": "–î–æ–Ω–µ—Ü–∫", "toCity": "–ö—Ä–∞—Å–Ω–æ–ø–µ—Ä–µ–∫–æ–ø—Å–∫", "price": 45000},
    {"fromCity": "–í–æ–ª–Ω–æ–≤–∞—Ö–∞", "toCity": "–†–æ—Å—Ç–æ–≤", "price": 13000},
    {"fromCity": "–ï–ª–µ–Ω–æ–≤–∫–∞", "toCity": "–†–æ—Å—Ç–æ–≤", "price": 10000},
    {"fromCity": "–ú–∞—Ä–∏—É–ø–æ–ª—å", "toCity": "–†–æ—Å—Ç–æ–≤", "price": 10000},
    {"fromCity": "–î–æ–Ω–µ—Ü–∫", "toCity": "–í–æ–ª–≥–æ–≥—Ä–∞–¥", "price": 40000},
    {"fromCity": "–î–æ–Ω–µ—Ü–∫", "toCity": "–º–∏–Ω–≤–æ–¥—ã", "price": 40000},
    {"fromCity": "–•–∞—Ä—Ü—ã–∑—Å–∫", "toCity": "–í–æ–ª–≥–æ–≥—Ä–∞–¥", "price": 40000},
    {"fromCity": "–•–∞—Ä—Ü—ã–∑—Å–∫", "toCity": "–º–∏–Ω–≤–æ–¥—ã", "price": 40000},
    {"fromCity": "–î–æ–Ω–µ—Ü–∫", "toCity": "–ê–Ω–∞–ø–∞", "price": 40000},
    {"fromCity": "–î–æ–Ω–µ—Ü–∫", "toCity": "–°–æ—á–∏", "price": 50000},
    {"fromCity": "–î–æ–Ω–µ—Ü–∫", "toCity": "–°–æ—á–∏ –∞—ç—Ä–æ–ø–æ—Ä—Ç", "price": 55000},
    {"fromCity": "–î–æ–Ω–µ—Ü–∫", "toCity": "–ë–∞—Ç–∞–π—Å–∫", "price": 10000},
    {"fromCity": "–î–æ–Ω–µ—Ü–∫", "toCity": "–ê–∫—Å–∞–π", "price": 10000},
    {"fromCity": "–î–æ–∫—É—á–∞–µ–≤—Å–∫", "toCity": "–†–æ—Å—Ç–æ–≤", "price": 12000},
    {"fromCity": "–î–æ–Ω–µ—Ü–∫", "toCity": "–ì–µ–ª–µ–Ω–¥–∂–∏–∫", "price": 40000},
    {"fromCity": "–î–æ–Ω–µ—Ü–∫", "toCity": "–¥–∏–≤–Ω–æ–º—Ä—Å–∫–æ–µ", "price": 40000},
    {"fromCity": "–ú–∞–∫–µ–µ–≤–∫–∞", "toCity": "–í–æ–ª–≥–æ–≥—Ä–∞–¥", "price": 40000},
    {"fromCity": "–ú–∞–∫–µ–µ–≤–∫–∞", "toCity": "–º–∏–Ω–≤–æ–¥—ã", "price": 40000},
    {"fromCity": "–î–æ–Ω–µ—Ü–∫", "toCity": "–ï–π—Å–∫", "price": 22000},
    {"fromCity": "–ú–∞–∫–µ–µ–≤–∫–∞", "toCity": "–ï–π—Å–∫", "price": 22000},
    {"fromCity": "–ï–Ω–∞–∫–∏–µ–≤–æ", "toCity": "–ï–π—Å–∫", "price": 24000},
    {"fromCity": "–î–æ–Ω–µ—Ü–∫", "toCity": "–ú–æ—Å–∫–≤–∞", "price": 77000},
    {"fromCity": "–Ø—Å–∏–Ω–æ–≤–∞—Ç–∞—è", "toCity": "–†–æ—Å—Ç–æ–≤", "price": 12000},
    {"fromCity": "–î–æ–Ω–µ—Ü–∫", "toCity": "–í–æ—Ä–æ–Ω–µ–∂", "price": 50000},
    {"fromCity": "–î–æ–Ω–µ—Ü–∫", "toCity": "–†–û–°–¢–û–í", "price": 8000},
    {"fromCity": "–î–æ–Ω–µ—Ü–∫", "toCity": "–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä", "price": 30000},
    {"fromCity": "–ú–∞–∫–µ–µ–≤–∫–∞", "toCity": "–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä", "price": 30000},
    {"fromCity": "–•–∞—Ä—Ü—ã–∑—Å–∫", "toCity": "–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä", "price": 30000},
    {"fromCity": "–ò–ª–æ–≤–∞–π—Å–∫", "toCity": "–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä", "price": 30000},
    {"fromCity": "–ê–º–≤—Ä–æ—Å–∏–µ–≤–∫–∞", "toCity": "–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä", "price": 30000},
    {"fromCity": "–ü—É–Ω–∫—Ç –ø—Ä–æ–ø—É—Å–∫–∞ –ê–≤–∏–ª–æ –£—Å–ø–µ–Ω–∫–∞", "toCity": "–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä", "price": 30000},
    {"fromCity": "–ü—É–Ω–∫—Ç –ø—Ä–æ–ø—É—Å–∫–∞ –ê–≤–∏–ª–æ-–£—Å–ø–µ–Ω–∫–∞", "toCity": "–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä", "price": 30000},
    {"fromCity": "–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä", "toCity": "–î–æ–Ω–µ—Ü–∫", "price": 30000},
    {"fromCity": "–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä", "toCity": "–ú–∞–∫–µ–µ–≤–∫–∞", "price": 30000},
    {"fromCity": "–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä", "toCity": "–•–∞—Ä—Ü—ã–∑—Å–∫", "price": 30000},
    {"fromCity": "–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä", "toCity": "–ò–ª–æ–≤–∞–π—Å–∫", "price": 30000},
    {"fromCity": "–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä", "toCity": "–ê–º–≤—Ä–æ—Å–∏–µ–≤–∫–∞", "price": 30000},
    {"fromCity": "–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä", "toCity": "–ü—É–Ω–∫—Ç –ø—Ä–æ–ø—É—Å–∫–∞ –ê–≤–∏–ª–æ-–£—Å–ø–µ–Ω–∫–∞", "price": 30000},
    {"fromCity": "–î–æ–Ω–µ—Ü–∫", "toCity": "–†–æ—Å—Ç–æ–≤", "price": 8000},
    {"fromCity": "–ú–∞–∫–µ–µ–≤–∫–∞", "toCity": "–†–æ—Å—Ç–æ–≤", "price": 8000}
  ]
}
EOF
)

echo "üì¶ –ó–∞–≥—Ä—É–∂–∞–µ–º 70 –º–∞—Ä—à—Ä—É—Ç–æ–≤..."
echo ""

# –í—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å
RESPONSE=$(curl -s -X POST "$API_URL/admin/predefined/batch" \
  -H "Authorization: Bearer $ADMIN_TOKEN" \
  -H "Content-Type: application/json" \
  -d "$ROUTES_JSON")

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
if echo "$RESPONSE" | grep -q '"error"'; then
    echo "‚ùå –û–®–ò–ë–ö–ê:"
    echo "$RESPONSE" | python3 -m json.tool 2>/dev/null || echo "$RESPONSE"
    exit 1
fi

echo "‚úÖ –£–°–ü–ï–•! –†–µ–∑—É–ª—å—Ç–∞—Ç:"
echo "$RESPONSE" | python3 -m json.tool 2>/dev/null || echo "$RESPONSE"
echo ""
echo "==================================================="
echo "üìä –ú–ê–†–®–†–£–¢–´ –ó–ê–ì–†–£–ñ–ï–ù–´ –í POSTGRESQL!"
echo "==================================================="
