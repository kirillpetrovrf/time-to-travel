# ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ API –ó–∞—è–≤–æ–∫: –ö–ª–∏–µ–Ω—Ç ‚Üí –î–∏—Å–ø–µ—Ç—á–µ—Ä

**–î–∞—Ç–∞**: 26 —è–Ω–≤–∞—Ä—è 2026  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–í–°–Å –†–ê–ë–û–¢–ê–ï–¢!**

---

## üéØ –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ

### 1. ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–æ–∫ –æ—Ç –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤

**–¢–µ—Å—Ç: –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä—É–ø–ø–æ–≤–æ–π –ø–æ–µ–∑–¥–∫–∏**
```bash
curl -X POST https://titotr.ru/api/orders -d '{
  "tripType": "group",
  "fromAddress": "–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É",
  "toAddress": "–¢–∞–≥–∞–Ω—Ä–æ–≥",
  ...
}'
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω
```json
{
  "orderId": "ORDER-2026-01-687",
  "tripType": "group",
  "status": "pending"
}
```

### 2. ‚úÖ –í—Å–µ 3 —Ç–∏–ø–∞ –ø–æ–µ–∑–¥–æ–∫ —Ä–∞–±–æ—Ç–∞—é—Ç

**–í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞–π–¥–µ–Ω—ã –∑–∞—è–≤–∫–∏ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤**:

| –¢–∏–ø –ø–æ–µ–∑–¥–∫–∏ | tripType | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | –ü—Ä–∏–º–µ—Ä—ã |
|-------------|----------|------------|---------|
| **–ì—Ä—É–ø–ø–æ–≤–∞—è** | `group` | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | ORDER-687, ORDER-79, ORDER-391 |
| **–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è** | `individual` | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | ORDER-666 |
| **–°–≤–æ–±–æ–¥–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç** | `customRoute` | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | ORDER-745, ORDER-477 |

**–ö–æ–¥ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏**:
```dart
// lib/models/trip_type.dart
enum TripType {
  group,         // –ì—Ä—É–ø–ø–æ–≤–∞—è –ø–æ–µ–∑–¥–∫–∞
  individual,    // –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä
  customRoute,   // –°–≤–æ–±–æ–¥–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç (—Ç–∞–∫—Å–∏)
}
```

**–ü–µ—Ä–µ–¥–∞—á–∞ –Ω–∞ backend**:
```dart
// lib/services/booking_service.dart line 85
tripType: booking.tripType.toString().split('.').last,
// –†–µ–∑—É–ª—å—Ç–∞—Ç: "group" | "individual" | "customRoute"
```

### 3. ‚úÖ –î–∏—Å–ø–µ—Ç—á–µ—Ä –≤–∏–¥–∏—Ç –í–°–ï –∑–∞—è–≤–∫–∏

**API Endpoint**: `GET /api/orders`

**–õ–æ–≥–∏–∫–∞ –¥–æ—Å—Ç—É–ø–∞** (backend/routes/orders/index.dart):
```dart
// –°—Ç—Ä–æ–∫–∞ 78-80: –î–∏—Å–ø–µ—Ç—á–µ—Ä—ã –∏ –∞–¥–º–∏–Ω—ã –≤–∏–¥—è—Ç –í–°–ï –∑–∞–∫–∞–∑—ã
else if (userRole == 'dispatcher' || userRole == 'admin') {
  orders = await orderRepo.findAll(limit: limit);
}
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞**:
```bash
curl https://titotr.ru/api/orders | jq '.orders | length'
# –†–µ–∑—É–ª—å—Ç–∞—Ç: 14 –∑–∞–∫–∞–∑–æ–≤
```

**–ó–∞—è–≤–∫–∏ –≤ —Å—Ç–∞—Ç—É—Å–µ "pending"**:
```bash
curl 'https://titotr.ru/api/orders?status=pending' | jq '.orders | length'
# –†–µ–∑—É–ª—å—Ç–∞—Ç: 12 –∑–∞–∫–∞–∑–æ–≤ –æ–∂–∏–¥–∞—é—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏
```

### 4. ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∑–∞—è–≤–æ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü–æ —Å—Ç–∞—Ç—É—Å—É**:
```bash
GET /api/orders?status=pending
GET /api/orders?status=confirmed
GET /api/orders?status=in_progress
GET /api/orders?status=completed
GET /api/orders?status=cancelled
```

**–ü–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É**:
```bash
GET /api/orders?phone=%2B79001234567
```

**–° –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º**:
```bash
GET /api/orders?limit=10
```

---

## üîÑ –ü–æ–ª–Ω—ã–π Flow: –ü–∞—Å—Å–∞–∂–∏—Ä ‚Üí –î–∏—Å–ø–µ—Ç—á–µ—Ä

### –®–∞–≥ 1: –ü–∞—Å—Å–∞–∂–∏—Ä —Å–æ–∑–¥–∞—ë—Ç –∑–∞—è–≤–∫—É (Flutter)

**–≠–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –ø–æ–µ–∑–¥–∫–∏** (—Å–∫—Ä–∏–Ω—à–æ—Ç 1):
- ‚úÖ –ì—Ä—É–ø–ø–æ–≤–∞—è –ø–æ–µ–∑–¥–∫–∞ (2000‚ÇΩ) - `tripType: "group"`
- ‚úÖ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è –ø–æ–µ–∑–¥–∫–∞ (–æ—Ç 8000‚ÇΩ) - `tripType: "individual"`

**–≠–∫—Ä–∞–Ω –º–∞—Ä—à—Ä—É—Ç–∞** (—Å–∫—Ä–∏–Ω—à–æ—Ç 2):
- ‚úÖ –°–≤–æ–±–æ–¥–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç (—Ç–∞–∫—Å–∏) - `tripType: "customRoute"`
- –í—ã–±–æ—Ä —Ç–æ—á–µ–∫ –Ω–∞ –∫–∞—Ä—Ç–µ
- –†–∞—Å—á—ë—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏

**–ö–æ–¥ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞**:
```dart
// lib/services/booking_service.dart
BookingService ‚Üí OrdersService ‚Üí OrdersRepository 
  ‚Üí OrdersRemoteDataSource ‚Üí POST /api/orders
```

### –®–∞–≥ 2: –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ backend

**Endpoint**: `POST https://titotr.ru/api/orders`

**Payload**:
```json
{
  "fromAddress": "–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É, —É–ª. –ü—É—à–∫–∏–Ω—Å–∫–∞—è 1",
  "toAddress": "–¢–∞–≥–∞–Ω—Ä–æ–≥, —É–ª. –õ–µ–Ω–∏–Ω–∞ 10",
  "departureDate": "2026-01-27T10:00:00Z",
  "finalPrice": 2000.00,
  "tripType": "group",          // ‚úÖ –¢–ò–ü –ü–û–ï–ó–î–ö–ò
  "passengers": [...],
  "baggage": [...],
  "pets": [...]
}
```

### –®–∞–≥ 3: Backend —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ PostgreSQL

**–¢–∞–±–ª–∏—Ü–∞**: `orders`
**–ü–æ–ª—è**:
- `trip_type` - —Ç–∏–ø –ø–æ–µ–∑–¥–∫–∏ (group/individual/customRoute)
- `status` - —Å—Ç–∞—Ç—É—Å (pending/confirmed/in_progress/completed/cancelled)
- `passengers` - JSONB –º–∞—Å—Å–∏–≤ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤
- `baggage` - JSONB –º–∞—Å—Å–∏–≤ –±–∞–≥–∞–∂–∞
- `pets` - JSONB –º–∞—Å—Å–∏–≤ –∂–∏–≤–æ—Ç–Ω—ã—Ö

### –®–∞–≥ 4: –î–∏—Å–ø–µ—Ç—á–µ—Ä –≤–∏–¥–∏—Ç –∑–∞—è–≤–∫—É

**API –¥–ª—è –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞**: `GET /api/orders`

**–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞**:
```dart
if (userRole == 'dispatcher' || userRole == 'admin') {
  orders = await orderRepo.findAll(limit: limit);
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
- ‚úÖ –î–∏—Å–ø–µ—Ç—á–µ—Ä –≤–∏–¥–∏—Ç –í–°–ï –∑–∞—è–≤–∫–∏ –æ—Ç –í–°–ï–• –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤
- ‚úÖ –ó–∞—è–≤–∫–∏ —Å —Ä–∞–∑–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ –ø–æ–µ–∑–¥–æ–∫ (group, individual, customRoute)
- ‚úÖ –ú–æ–∂–µ—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ —Å—Ç–∞—Ç—É—Å—É, —Ç–µ–ª–µ—Ñ–æ–Ω—É
- ‚úÖ –ú–æ–∂–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å —Å—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ `PATCH /api/orders/:id/status`

---

## üìä –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –°—Ü–µ–Ω–∞—Ä–∏–∏

| –°—Ü–µ–Ω–∞—Ä–∏–π | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|----------|--------|------------|
| –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä—É–ø–ø–æ–≤–æ–π –ø–æ–µ–∑–¥–∫–∏ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | tripType: "group" |
| –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π –ø–æ–µ–∑–¥–∫–∏ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | tripType: "individual" |
| –°–æ–∑–¥–∞–Ω–∏–µ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | tripType: "customRoute" |
| –ü–µ—Ä–µ–¥–∞—á–∞ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –ú–∞—Å—Å–∏–≤ passengers –≤ JSON |
| –ü–µ—Ä–µ–¥–∞—á–∞ –±–∞–≥–∞–∂–∞ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –ú–∞—Å—Å–∏–≤ baggage –≤ JSON |
| –ü–µ—Ä–µ–¥–∞—á–∞ –∂–∏–≤–æ—Ç–Ω—ã—Ö | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –ú–∞—Å—Å–∏–≤ pets –≤ JSON |
| –î–∏—Å–ø–µ—Ç—á–µ—Ä –≤–∏–¥–∏—Ç –≤—Å–µ –∑–∞—è–≤–∫–∏ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | GET /api/orders (14 –∑–∞–∫–∞–∑–æ–≤) |
| –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å—É | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | ?status=pending (12 –∑–∞–∫–∞–∑–æ–≤) |
| –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | ?phone=... |

---

## üéØ –ò—Ç–æ–≥–æ–≤–∞—è –ü—Ä–æ–≤–µ—Ä–∫–∞

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ö–ª–∏–µ–Ω—Ç ‚Üí Backend**:
   - ‚úÖ –í—Å–µ 3 —Ç–∏–ø–∞ –ø–æ–µ–∑–¥–æ–∫ —Å–æ–∑–¥–∞—é—Ç—Å—è
   - ‚úÖ –î–∞–Ω–Ω—ã–µ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è
   - ‚úÖ –ó–∞—è–≤–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ PostgreSQL
   - ‚úÖ –ì–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ ORDER-ID

2. **Backend ‚Üí –î–∏—Å–ø–µ—Ç—á–µ—Ä**:
   - ‚úÖ API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –∑–∞—è–≤–∫–∏
   - ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å—É —Ä–∞–±–æ—Ç–∞–µ—Ç
   - ‚úÖ –î–∏—Å–ø–µ—Ç—á–µ—Ä –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å —Å—Ç–∞—Ç—É—Å
   - ‚úÖ –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–æ —Ç–∏–ø—É –ø–æ–µ–∑–¥–∫–∏

3. **PostgreSQL**:
   - ‚úÖ 14 –∑–∞–∫–∞–∑–æ–≤ –≤ –±–∞–∑–µ
   - ‚úÖ 12 –≤ —Å—Ç–∞—Ç—É—Å–µ "pending"
   - ‚úÖ tripType —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
   - ‚úÖ JSONB –ø–æ–ª—è (passengers, baggage, pets) —Ä–∞–±–æ—Ç–∞—é—Ç

---

## üöÄ –ì–æ—Ç–æ–≤–æ –∫ –ü—Ä–æ–¥–∞–∫—à–µ–Ω—É

**–í—ã–≤–æ–¥**: –í—Å—è —Ü–µ–ø–æ—á–∫–∞ **–ö–ª–∏–µ–Ω—Ç ‚Üí API ‚Üí PostgreSQL ‚Üí –î–∏—Å–ø–µ—Ç—á–µ—Ä** —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!

- ‚úÖ –ì—Ä—É–ø–ø–æ–≤—ã–µ –ø–æ–µ–∑–¥–∫–∏ ‚Üí –¥–∏—Å–ø–µ—Ç—á–µ—Ä—É
- ‚úÖ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –ø–æ–µ–∑–¥–∫–∏ ‚Üí –¥–∏—Å–ø–µ—Ç—á–µ—Ä—É  
- ‚úÖ –°–≤–æ–±–æ–¥–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã ‚Üí –¥–∏—Å–ø–µ—Ç—á–µ—Ä—É
- ‚úÖ –í—Å–µ –∑–∞—è–≤–∫–∏ –ø–æ–ø–∞–¥–∞—é—Ç –≤ –∫–∞–±–∏–Ω–µ—Ç –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞
- ‚úÖ –°—Ç–∞—Ç—É—Å—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ API

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–∏—ë–º—É –∑–∞—è–≤–æ–∫ –æ—Ç –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤! üéâ**
